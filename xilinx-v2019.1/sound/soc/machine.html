

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ASoC Machine Driver &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../../index.html"/>
        <link rel="up" title="ALSA SoC Layer" href="index.html"/>
        <link rel="next" title="Audio Pops and Clicks" href="pops-clicks.html"/>
        <link rel="prev" title="ASoC Platform Driver" href="platform.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Sound Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../kernel-api/index.html">ALSA Kernel API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../designs/index.html">Designs and Implementations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">ALSA SoC Layer</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">ALSA SoC Layer Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="codec.html">ASoC Codec Class Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="dai.html">ASoC Digital Audio Interface (DAI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="dapm.html">Dynamic Audio Power Management for Portable Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform.html">ASoC Platform Driver</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">ASoC Machine Driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#probe-remove">probe()/remove()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suspend-resume">suspend()/resume()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#machine-dai-configuration">Machine DAI Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#machine-power-map">Machine Power Map</a></li>
<li class="toctree-l4"><a class="reference internal" href="#machine-controls">Machine Controls</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pops-clicks.html">Audio Pops and Clicks</a></li>
<li class="toctree-l3"><a class="reference internal" href="clocking.html">Audio Clocking</a></li>
<li class="toctree-l3"><a class="reference internal" href="jack.html">ASoC jack detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="dpcm.html">Dynamic PCM</a></li>
<li class="toctree-l3"><a class="reference internal" href="codec-to-codec.html">Creating codec to codec dai link for ALSA dapm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../alsa-configuration.html">Advanced Linux Sound Architecture - Driver Configuration guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hd-audio/index.html">HD-Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cards/index.html">Card-Specific Information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Linux Sound Subsystem Documentation</a> &raquo;</li>
      
          <li><a href="index.html">ALSA SoC Layer</a> &raquo;</li>
      
    <li>ASoC Machine Driver</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/sound/soc/machine.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="asoc-machine-driver">
<h1>ASoC Machine Driver<a class="headerlink" href="#asoc-machine-driver" title="Permalink to this headline">Â¶</a></h1>
<p>The ASoC machine (or board) driver is the code that glues together all the
component drivers (e.g. codecs, platforms and DAIs). It also describes the
relationships between each component which include audio paths, GPIOs,
interrupts, clocking, jacks and voltage regulators.</p>
<p>The machine driver can contain codec and platform specific code. It registers
the audio subsystem with the kernel as a platform device and is represented by
the following struct:-</p>
<div class="highlight-none"><div class="highlight"><pre>/* SoC machine */
struct snd_soc_card {
      char *name;

      ...

      int (*probe)(struct platform_device *pdev);
      int (*remove)(struct platform_device *pdev);

      /* the pre and post PM functions are used to do any PM work before and
       * after the codec and DAIs do any PM work. */
      int (*suspend_pre)(struct platform_device *pdev, pm_message_t state);
      int (*suspend_post)(struct platform_device *pdev, pm_message_t state);
      int (*resume_pre)(struct platform_device *pdev);
      int (*resume_post)(struct platform_device *pdev);

      ...

      /* CPU &lt;--&gt; Codec DAI links  */
      struct snd_soc_dai_link *dai_link;
      int num_links;

      ...
};
</pre></div>
</div>
<div class="section" id="probe-remove">
<h2>probe()/remove()<a class="headerlink" href="#probe-remove" title="Permalink to this headline">Â¶</a></h2>
<p>probe/remove are optional. Do any machine specific probe here.</p>
</div>
<div class="section" id="suspend-resume">
<h2>suspend()/resume()<a class="headerlink" href="#suspend-resume" title="Permalink to this headline">Â¶</a></h2>
<p>The machine driver has pre and post versions of suspend and resume to take care
of any machine audio tasks that have to be done before or after the codec, DAIs
and DMA is suspended and resumed. Optional.</p>
</div>
<div class="section" id="machine-dai-configuration">
<h2>Machine DAI Configuration<a class="headerlink" href="#machine-dai-configuration" title="Permalink to this headline">Â¶</a></h2>
<p>The machine DAI configuration glues all the codec and CPU DAIs together. It can
also be used to set up the DAI system clock and for any machine related DAI
initialisation e.g. the machine audio map can be connected to the codec audio
map, unconnected codec pins can be set as such.</p>
<p>struct snd_soc_dai_link is used to set up each DAI in your machine. e.g.</p>
<div class="highlight-none"><div class="highlight"><pre>/* corgi digital audio interface glue - connects codec &lt;--&gt; CPU */
static struct snd_soc_dai_link corgi_dai = {
      .name = &quot;WM8731&quot;,
      .stream_name = &quot;WM8731&quot;,
      .cpu_dai_name = &quot;pxa-is2-dai&quot;,
      .codec_dai_name = &quot;wm8731-hifi&quot;,
      .platform_name = &quot;pxa-pcm-audio&quot;,
      .codec_name = &quot;wm8713-codec.0-001a&quot;,
      .init = corgi_wm8731_init,
      .ops = &amp;corgi_ops,
};
</pre></div>
</div>
<p>struct snd_soc_card then sets up the machine with its DAIs. e.g.</p>
<div class="highlight-none"><div class="highlight"><pre>/* corgi audio machine driver */
static struct snd_soc_card snd_soc_corgi = {
      .name = &quot;Corgi&quot;,
      .dai_link = &amp;corgi_dai,
      .num_links = 1,
};
</pre></div>
</div>
</div>
<div class="section" id="machine-power-map">
<h2>Machine Power Map<a class="headerlink" href="#machine-power-map" title="Permalink to this headline">Â¶</a></h2>
<p>The machine driver can optionally extend the codec power map and to become an
audio power map of the audio subsystem. This allows for automatic power up/down
of speaker/HP amplifiers, etc. Codec pins can be connected to the machines jack
sockets in the machine init function.</p>
</div>
<div class="section" id="machine-controls">
<h2>Machine Controls<a class="headerlink" href="#machine-controls" title="Permalink to this headline">Â¶</a></h2>
<p>Machine specific audio mixer controls can be added in the DAI init function.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pops-clicks.html" class="btn btn-neutral float-right" title="Audio Pops and Clicks" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="platform.html" class="btn btn-neutral" title="ASoC Platform Driver" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>