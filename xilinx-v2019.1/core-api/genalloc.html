

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The genalloc/genpool subsystem &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html"/>
        <link rel="up" title="Core API Documentation" href="index.html"/>
        <link rel="next" title="The errseq_t datatype" href="errseq.html"/>
        <link rel="prev" title="Reed-Solomon Library Programming Interface" href="librs.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Core API Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#core-utilities">Core utilities</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="kernel-api.html">The Linux Kernel API</a></li>
<li class="toctree-l3"><a class="reference internal" href="assoc_array.html">Generic Associative Array Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="atomic_ops.html">Semantics and Behavior of Atomic and Bitmask Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="cachetlb.html">Cache and TLB Flushing Under Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="refcount-vs-atomic.html">refcount_t API compared to atomic_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpu_hotplug.html">CPU hotplug in the Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="idr.html">ID Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_ops.html">Semantics and Behavior of Local Atomic Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="workqueue.html">Concurrency Managed Workqueue (cmwq)</a></li>
<li class="toctree-l3"><a class="reference internal" href="genericirq.html">Linux generic IRQ handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="flexible-arrays.html">Using flexible arrays in the kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="librs.html">Reed-Solomon Library Programming Interface</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">The genalloc/genpool subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="errseq.html">The errseq_t datatype</a></li>
<li class="toctree-l3"><a class="reference internal" href="printk-formats.html">How to get printk format specifiers right</a></li>
<li class="toctree-l3"><a class="reference internal" href="circular-buffers.html">Circular Buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="mm-api.html">Memory Management APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="gfp_mask-from-fs-io.html">GFP masks used from FS/IO context</a></li>
<li class="toctree-l3"><a class="reference internal" href="timekeeping.html">ktime accessors</a></li>
<li class="toctree-l3"><a class="reference internal" href="boot-time-mm.html">Boot time memory management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interfaces-for-kernel-debugging">Interfaces for kernel debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Core API Documentation</a> &raquo;</li>
      
    <li>The genalloc/genpool subsystem</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/core-api/genalloc.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-genalloc-genpool-subsystem">
<h1>The genalloc/genpool subsystem<a class="headerlink" href="#the-genalloc-genpool-subsystem" title="Permalink to this headline">Â¶</a></h1>
<p>There are a number of memory-allocation subsystems in the kernel, each
aimed at a specific need.  Sometimes, however, a kernel developer needs to
implement a new allocator for a specific range of special-purpose memory;
often that memory is located on a device somewhere.  The author of the
driver for that device can certainly write a little allocator to get the
job done, but that is the way to fill the kernel with dozens of poorly
tested allocators.  Back in 2005, Jes Sorensen lifted one of those
allocators from the sym53c8xx_2 driver and <a class="reference external" href="https://lwn.net/Articles/125842/">posted</a> it as a generic module
for the creation of ad hoc memory allocators.  This code was merged
for the 2.6.13 release; it has been modified considerably since then.</p>
<p>Code using this allocator should include &lt;linux/genalloc.h&gt;.  The action
begins with the creation of a pool using one of:</p>
<dl class="function">
<dt id="c.gen_pool_create">
struct gen_pool * <code class="descname">gen_pool_create</code><span class="sig-paren">(</span>int<em>&nbsp;min_alloc_order</em>, int<em>&nbsp;nid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_create" title="Permalink to this definition">Â¶</a></dt>
<dd><p>create a new special memory pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">min_alloc_order</span></code></dt>
<dd>log base 2 of number of bytes each bitmap bit represents</dd>
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">nid</span></code></dt>
<dd>node id of the node the pool structure should be allocated on, or -1</dd>
</dl>
<p><strong>Description</strong></p>
<p>Create a new special memory pool that can be used to manage special purpose
memory not managed by the regular kmalloc/kfree interface.</p>
<dl class="function">
<dt id="c.devm_gen_pool_create">
struct gen_pool * <code class="descname">devm_gen_pool_create</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em>, int<em>&nbsp;min_alloc_order</em>, int<em>&nbsp;nid</em>, const char *<em>&nbsp;name</em><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_gen_pool_create" title="Permalink to this definition">Â¶</a></dt>
<dd><p>managed gen_pool_create</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>device that provides the gen_pool</dd>
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">min_alloc_order</span></code></dt>
<dd>log base 2 of number of bytes each bitmap bit represents</dd>
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">nid</span></code></dt>
<dd>node selector for allocated gen_pool, <code class="docutils literal"><span class="pre">NUMA_NO_NODE</span></code> for all nodes</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">name</span></code></dt>
<dd>name of a gen_pool or NULL, identifies a particular gen_pool on device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Create a new special memory pool that can be used to manage special purpose
memory not managed by the regular kmalloc/kfree interface. The pool will be
automatically destroyed by the device management code.</p>
<p>A call to <a class="reference internal" href="#c.gen_pool_create" title="gen_pool_create"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_create()</span></code></a> will create a pool.  The granularity of
allocations is set with min_alloc_order; it is a log-base-2 number like
those used by the page allocator, but it refers to bytes rather than pages.
So, if min_alloc_order is passed as 3, then all allocations will be a
multiple of eight bytes.  Increasing min_alloc_order decreases the memory
required to track the memory in the pool.  The nid parameter specifies
which NUMA node should be used for the allocation of the housekeeping
structures; it can be -1 if the caller doesn&#8217;t care.</p>
<p>The &#8220;managed&#8221; interface <a class="reference internal" href="#c.devm_gen_pool_create" title="devm_gen_pool_create"><code class="xref c c-func docutils literal"><span class="pre">devm_gen_pool_create()</span></code></a> ties the pool to a
specific device.  Among other things, it will automatically clean up the
pool when the given device is destroyed.</p>
<p>A pool is shut down with:</p>
<dl class="function">
<dt id="c.gen_pool_destroy">
void <code class="descname">gen_pool_destroy</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_destroy" title="Permalink to this definition">Â¶</a></dt>
<dd><p>destroy a special memory pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to destroy</dd>
</dl>
<p><strong>Description</strong></p>
<p>Destroy the specified special memory pool. Verifies that there are no
outstanding allocations.</p>
<p>It&#8217;s worth noting that, if there are still allocations outstanding from the
given pool, this function will take the rather extreme step of invoking
BUG(), crashing the entire system.  You have been warned.</p>
<p>A freshly created pool has no memory to allocate.  It is fairly useless in
that state, so one of the first orders of business is usually to add memory
to the pool.  That can be done with one of:</p>
<dl class="function">
<dt id="c.gen_pool_add">
int <code class="descname">gen_pool_add</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, unsigned long<em>&nbsp;addr</em>, size_t<em>&nbsp;size</em>, int<em>&nbsp;nid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_add" title="Permalink to this definition">Â¶</a></dt>
<dd><p>add a new chunk of special memory to the pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to add new memory chunk to</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">addr</span></code></dt>
<dd>starting address of memory chunk to add to pool</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>size in bytes of the memory chunk to add to pool</dd>
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">nid</span></code></dt>
<dd>node id of the node the chunk structure and bitmap should be
allocated on, or -1</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a new chunk of special memory to the specified pool.</p>
<p>Returns 0 on success or a -ve errno on failure.</p>
<dl class="function">
<dt id="c.gen_pool_add_virt">
int <code class="descname">gen_pool_add_virt</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, unsigned long<em>&nbsp;virt</em>, phys_addr_t<em>&nbsp;phys</em>, size_t<em>&nbsp;size</em>, int<em>&nbsp;nid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_add_virt" title="Permalink to this definition">Â¶</a></dt>
<dd><p>add a new chunk of special memory to the pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to add new memory chunk to</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">virt</span></code></dt>
<dd>virtual starting address of memory chunk to add to pool</dd>
<dt><code class="docutils literal"><span class="pre">phys_addr_t</span> <span class="pre">phys</span></code></dt>
<dd>physical starting address of memory chunk to add to pool</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>size in bytes of the memory chunk to add to pool</dd>
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">nid</span></code></dt>
<dd>node id of the node the chunk structure and bitmap should be
allocated on, or -1</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a new chunk of special memory to the specified pool.</p>
<p>Returns 0 on success or a -ve errno on failure.</p>
<p>A call to <a class="reference internal" href="#c.gen_pool_add" title="gen_pool_add"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_add()</span></code></a> will place the size bytes of memory
starting at addr (in the kernel&#8217;s virtual address space) into the given
pool, once again using nid as the node ID for ancillary memory allocations.
The <a class="reference internal" href="#c.gen_pool_add_virt" title="gen_pool_add_virt"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_add_virt()</span></code></a> variant associates an explicit physical
address with the memory; this is only necessary if the pool will be used
for DMA allocations.</p>
<p>The functions for allocating memory from the pool (and putting it back)
are:</p>
<dl class="function">
<dt id="c.gen_pool_alloc">
unsigned long <code class="descname">gen_pool_alloc</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_alloc" title="Permalink to this definition">Â¶</a></dt>
<dd><p>allocate special memory from the pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to allocate from</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>number of bytes to allocate from the pool</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocate the requested number of bytes from the specified pool.
Uses the pool allocation function (with first-fit algorithm by default).
Can not be used in NMI handler on architectures without
NMI-safe cmpxchg implementation.</p>
<dl class="function">
<dt id="c.gen_pool_dma_alloc">
void * <code class="descname">gen_pool_dma_alloc</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, size_t<em>&nbsp;size</em>, dma_addr_t *<em>&nbsp;dma</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_dma_alloc" title="Permalink to this definition">Â¶</a></dt>
<dd><p>allocate special memory from the pool for DMA usage</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to allocate from</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>number of bytes to allocate from the pool</dd>
<dt><code class="docutils literal"><span class="pre">dma_addr_t</span> <span class="pre">*</span> <span class="pre">dma</span></code></dt>
<dd>dma-view physical address return value.  Use NULL if unneeded.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocate the requested number of bytes from the specified pool.
Uses the pool allocation function (with first-fit algorithm by default).
Can not be used in NMI handler on architectures without
NMI-safe cmpxchg implementation.</p>
<dl class="function">
<dt id="c.gen_pool_free">
void <code class="descname">gen_pool_free</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, unsigned long<em>&nbsp;addr</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_free" title="Permalink to this definition">Â¶</a></dt>
<dd><p>free allocated special memory back to the pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to free to</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">addr</span></code></dt>
<dd>starting address of memory to free back to pool</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>size in bytes of memory to free</dd>
</dl>
<p><strong>Description</strong></p>
<p>Free previously allocated special memory back to the specified
pool.  Can not be used in NMI handler on architectures without
NMI-safe cmpxchg implementation.</p>
<p>As one would expect, <a class="reference internal" href="#c.gen_pool_alloc" title="gen_pool_alloc"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_alloc()</span></code></a> will allocate size&lt; bytes
from the given pool.  The <a class="reference internal" href="#c.gen_pool_dma_alloc" title="gen_pool_dma_alloc"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_dma_alloc()</span></code></a> variant allocates
memory for use with DMA operations, returning the associated physical
address in the space pointed to by dma.  This will only work if the memory
was added with <a class="reference internal" href="#c.gen_pool_add_virt" title="gen_pool_add_virt"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_add_virt()</span></code></a>.  Note that this function
departs from the usual genpool pattern of using unsigned long values to
represent kernel addresses; it returns a void * instead.</p>
<p>That all seems relatively simple; indeed, some developers clearly found it
to be too simple.  After all, the interface above provides no control over
how the allocation functions choose which specific piece of memory to
return.  If that sort of control is needed, the following functions will be
of interest:</p>
<dl class="function">
<dt id="c.gen_pool_alloc_algo">
unsigned long <code class="descname">gen_pool_alloc_algo</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, size_t<em>&nbsp;size</em>, genpool_algo_t<em>&nbsp;algo</em>, void *<em>&nbsp;data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_alloc_algo" title="Permalink to this definition">Â¶</a></dt>
<dd><p>allocate special memory from the pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to allocate from</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>number of bytes to allocate from the pool</dd>
<dt><code class="docutils literal"><span class="pre">genpool_algo_t</span> <span class="pre">algo</span></code></dt>
<dd>algorithm passed from caller</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">data</span></code></dt>
<dd>data passed to algorithm</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocate the requested number of bytes from the specified pool.
Uses the pool allocation function (with first-fit algorithm by default).
Can not be used in NMI handler on architectures without
NMI-safe cmpxchg implementation.</p>
<dl class="function">
<dt id="c.gen_pool_set_algo">
void <code class="descname">gen_pool_set_algo</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, genpool_algo_t<em>&nbsp;algo</em>, void *<em>&nbsp;data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_set_algo" title="Permalink to this definition">Â¶</a></dt>
<dd><p>set the allocation algorithm</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to change allocation algorithm</dd>
<dt><code class="docutils literal"><span class="pre">genpool_algo_t</span> <span class="pre">algo</span></code></dt>
<dd>custom algorithm function</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">data</span></code></dt>
<dd>additional data used by <strong>algo</strong></dd>
</dl>
<p><strong>Description</strong></p>
<p>Call <strong>algo</strong> for each memory allocation in the pool.
If <strong>algo</strong> is NULL use gen_pool_first_fit as default
memory allocation function.</p>
<p>Allocations with <a class="reference internal" href="#c.gen_pool_alloc_algo" title="gen_pool_alloc_algo"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_alloc_algo()</span></code></a> specify an algorithm to be
used to choose the memory to be allocated; the default algorithm can be set
with <a class="reference internal" href="#c.gen_pool_set_algo" title="gen_pool_set_algo"><code class="xref c c-func docutils literal"><span class="pre">gen_pool_set_algo()</span></code></a>.  The data value is passed to the
algorithm; most ignore it, but it is occasionally needed.  One can,
naturally, write a special-purpose algorithm, but there is a fair set
already available:</p>
<ul class="simple">
<li>gen_pool_first_fit is a simple first-fit allocator; this is the default
algorithm if none other has been specified.</li>
<li>gen_pool_first_fit_align forces the allocation to have a specific
alignment (passed via data in a genpool_data_align structure).</li>
<li>gen_pool_first_fit_order_align aligns the allocation to the order of the
size.  A 60-byte allocation will thus be 64-byte aligned, for example.</li>
<li>gen_pool_best_fit, as one would expect, is a simple best-fit allocator.</li>
<li>gen_pool_fixed_alloc allocates at a specific offset (passed in a
genpool_data_fixed structure via the data parameter) within the pool.
If the indicated memory is not available the allocation fails.</li>
</ul>
<p>There is a handful of other functions, mostly for purposes like querying
the space available in the pool or iterating through chunks of memory.
Most users, however, should not need much beyond what has been described
above.  With luck, wider awareness of this module will help to prevent the
writing of special-purpose memory allocators in the future.</p>
<dl class="function">
<dt id="c.gen_pool_virt_to_phys">
phys_addr_t <code class="descname">gen_pool_virt_to_phys</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, unsigned long<em>&nbsp;addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_virt_to_phys" title="Permalink to this definition">Â¶</a></dt>
<dd><p>return the physical address of memory</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to allocate from</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">addr</span></code></dt>
<dd>starting address of memory</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns the physical address on success, or -1 on error.</p>
<dl class="function">
<dt id="c.gen_pool_for_each_chunk">
void <code class="descname">gen_pool_for_each_chunk</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, void (*func) (struct gen_pool<em>&nbsp;*pool</em>, struct gen_pool_chunk<em>&nbsp;*chunk</em>, void<em>&nbsp;*data</em>, void *<em>&nbsp;data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_for_each_chunk" title="Permalink to this definition">Â¶</a></dt>
<dd><p>call func for every chunk of generic memory pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>the generic memory pool</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">(*)(struct</span> <span class="pre">gen_pool</span> <span class="pre">*pool,</span> <span class="pre">struct</span> <span class="pre">gen_pool_chunk</span> <span class="pre">*chunk,</span> <span class="pre">void</span> <span class="pre">*data)</span> <span class="pre">func</span></code></dt>
<dd>func to call</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">data</span></code></dt>
<dd>additional data used by <strong>func</strong></dd>
</dl>
<p><strong>Description</strong></p>
<p>Call <strong>func</strong> for every chunk of generic memory pool.  The <strong>func</strong> is
called with rcu_read_lock held.</p>
<dl class="function">
<dt id="c.addr_in_gen_pool">
bool <code class="descname">addr_in_gen_pool</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em>, unsigned long<em>&nbsp;start</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.addr_in_gen_pool" title="Permalink to this definition">Â¶</a></dt>
<dd><p>checks if an address falls within the range of a pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>the generic memory pool</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">start</span></code></dt>
<dd>start address</dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>size of the region</dd>
</dl>
<p><strong>Description</strong></p>
<p>Check if the range of addresses falls within the specified pool. Returns
true if the entire range is contained in the pool and false otherwise.</p>
<dl class="function">
<dt id="c.gen_pool_avail">
size_t <code class="descname">gen_pool_avail</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_avail" title="Permalink to this definition">Â¶</a></dt>
<dd><p>get available free space of the pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to get available free space</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return available free space of the specified pool.</p>
<dl class="function">
<dt id="c.gen_pool_size">
size_t <code class="descname">gen_pool_size</code><span class="sig-paren">(</span>struct gen_pool *<em>&nbsp;pool</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_size" title="Permalink to this definition">Â¶</a></dt>
<dd><p>get size in bytes of memory managed by the pool</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">gen_pool</span> <span class="pre">*</span> <span class="pre">pool</span></code></dt>
<dd>pool to get size</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return size in bytes of memory managed by the pool.</p>
<dl class="function">
<dt id="c.gen_pool_get">
struct gen_pool * <code class="descname">gen_pool_get</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em>, const char *<em>&nbsp;name</em><span class="sig-paren">)</span><a class="headerlink" href="#c.gen_pool_get" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Obtain the gen_pool (if any) for a device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>device to retrieve the gen_pool from</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">name</span></code></dt>
<dd>name of a gen_pool or NULL, identifies a particular gen_pool on device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns the gen_pool for the device if one is present, or NULL.</p>
<dl class="function">
<dt id="c.of_gen_pool_get">
struct gen_pool * <code class="descname">of_gen_pool_get</code><span class="sig-paren">(</span>struct device_node *<em>&nbsp;np</em>, const char *<em>&nbsp;propname</em>, int<em>&nbsp;index</em><span class="sig-paren">)</span><a class="headerlink" href="#c.of_gen_pool_get" title="Permalink to this definition">Â¶</a></dt>
<dd><p>find a pool by phandle property</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device_node</span> <span class="pre">*</span> <span class="pre">np</span></code></dt>
<dd>device node</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">propname</span></code></dt>
<dd>property name containing phandle(s)</dd>
<dt><code class="docutils literal"><span class="pre">int</span> <span class="pre">index</span></code></dt>
<dd>index into the phandle array</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns the pool that contains the chunk starting at the physical
address of the device tree node pointed at by the phandle property,
or NULL if not found.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="errseq.html" class="btn btn-neutral float-right" title="The errseq_t datatype" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="librs.html" class="btn btn-neutral" title="Reed-Solomon Library Programming Interface" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>