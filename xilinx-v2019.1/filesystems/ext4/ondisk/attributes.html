

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extended Attributes &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
    <li>Extended Attributes</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/filesystems/ext4/ondisk/attributes.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extended-attributes">
<h1>Extended Attributes<a class="headerlink" href="#extended-attributes" title="Permalink to this headline">¶</a></h1>
<p>Extended attributes (xattrs) are typically stored in a separate data
block on the disk and referenced from inodes via <code class="docutils literal"><span class="pre">inode.i_file_acl*</span></code>.
The first use of extended attributes seems to have been for storing file
ACLs and other security data (selinux). With the <code class="docutils literal"><span class="pre">user_xattr</span></code> mount
option it is possible for users to store extended attributes so long as
all attribute names begin with “user”; this restriction seems to have
disappeared as of Linux 3.0.</p>
<p>There are two places where extended attributes can be found. The first
place is between the end of each inode entry and the beginning of the
next inode entry. For example, if inode.i_extra_isize = 28 and
sb.inode_size = 256, then there are 256 - (128 + 28) = 100 bytes
available for in-inode extended attribute storage. The second place
where extended attributes can be found is in the block pointed to by
<code class="docutils literal"><span class="pre">inode.i_file_acl</span></code>. As of Linux 3.11, it is not possible for this
block to contain a pointer to a second extended attribute block (or even
the remaining blocks of a cluster). In theory it is possible for each
attribute&#8217;s value to be stored in a separate data block, though as of
Linux 3.11 the code does not permit this.</p>
<p>Keys are generally assumed to be ASCIIZ strings, whereas values can be
strings or binary data.</p>
<p>Extended attributes, when stored after the inode, have a header
<code class="docutils literal"><span class="pre">ext4_xattr_ibody_header</span></code> that is 4 bytes long:</p>
<table border="1" class="docutils">
<colgroup>
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="96%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Type</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le32</td>
<td>h_magic</td>
<td>Magic number for identification, 0xEA020000. This value is set by the
Linux driver, though e2fsprogs doesn&#8217;t seem to check it(?)</td>
</tr>
</tbody>
</table>
<p>The beginning of an extended attribute block is in
<code class="docutils literal"><span class="pre">struct</span> <span class="pre">ext4_xattr_header</span></code>, which is 32 bytes long:</p>
<table border="1" class="docutils">
<colgroup>
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="96%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Type</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__le32</td>
<td>h_magic</td>
<td>Magic number for identification, 0xEA020000.</td>
</tr>
<tr class="row-odd"><td>0x4</td>
<td>__le32</td>
<td>h_refcount</td>
<td>Reference count.</td>
</tr>
<tr class="row-even"><td>0x8</td>
<td>__le32</td>
<td>h_blocks</td>
<td>Number of disk blocks used.</td>
</tr>
<tr class="row-odd"><td>0xC</td>
<td>__le32</td>
<td>h_hash</td>
<td>Hash value of all attributes.</td>
</tr>
<tr class="row-even"><td>0x10</td>
<td>__le32</td>
<td>h_checksum</td>
<td>Checksum of the extended attribute block.</td>
</tr>
<tr class="row-odd"><td>0x14</td>
<td>__u32</td>
<td>h_reserved[2]</td>
<td>Zero.</td>
</tr>
</tbody>
</table>
<p>The checksum is calculated against the FS UUID, the 64-bit block number
of the extended attribute block, and the entire block (header +
entries).</p>
<p>Following the <code class="docutils literal"><span class="pre">struct</span> <span class="pre">ext4_xattr_header</span></code> or
<code class="docutils literal"><span class="pre">struct</span> <span class="pre">ext4_xattr_ibody_header</span></code> is an array of
<code class="docutils literal"><span class="pre">struct</span> <span class="pre">ext4_xattr_entry</span></code>; each of these entries is at least 16 bytes
long. When stored in an external block, the <code class="docutils literal"><span class="pre">struct</span> <span class="pre">ext4_xattr_entry</span></code>
entries must be stored in sorted order. The sort order is
<code class="docutils literal"><span class="pre">e_name_index</span></code>, then <code class="docutils literal"><span class="pre">e_name_len</span></code>, and finally <code class="docutils literal"><span class="pre">e_name</span></code>.
Attributes stored inside an inode do not need be stored in sorted order.</p>
<table border="1" class="docutils">
<colgroup>
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="96%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Offset</th>
<th class="head">Type</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x0</td>
<td>__u8</td>
<td>e_name_len</td>
<td>Length of name.</td>
</tr>
<tr class="row-odd"><td>0x1</td>
<td>__u8</td>
<td>e_name_index</td>
<td>Attribute name index. There is a discussion of this below.</td>
</tr>
<tr class="row-even"><td>0x2</td>
<td>__le16</td>
<td>e_value_offs</td>
<td>Location of this attribute&#8217;s value on the disk block where it is stored.
Multiple attributes can share the same value. For an inode attribute
this value is relative to the start of the first entry; for a block this
value is relative to the start of the block (i.e. the header).</td>
</tr>
<tr class="row-odd"><td>0x4</td>
<td>__le32</td>
<td>e_value_inum</td>
<td>The inode where the value is stored. Zero indicates the value is in the
same block as this entry. This field is only used if the
INCOMPAT_EA_INODE feature is enabled.</td>
</tr>
<tr class="row-even"><td>0x8</td>
<td>__le32</td>
<td>e_value_size</td>
<td>Length of attribute value.</td>
</tr>
<tr class="row-odd"><td>0xC</td>
<td>__le32</td>
<td>e_hash</td>
<td>Hash value of attribute name and attribute value. The kernel doesn&#8217;t
update the hash for in-inode attributes, so for that case this value
must be zero, because e2fsck validates any non-zero hash regardless of
where the xattr lives.</td>
</tr>
<tr class="row-even"><td>0x10</td>
<td>char</td>
<td>e_name[e_name_len]</td>
<td>Attribute name. Does not include trailing NULL.</td>
</tr>
</tbody>
</table>
<p>Attribute values can follow the end of the entry table. There appears to
be a requirement that they be aligned to 4-byte boundaries. The values
are stored starting at the end of the block and grow towards the
xattr_header/xattr_entry table. When the two collide, the overflow is
put into a separate disk block. If the disk block fills up, the
filesystem returns -ENOSPC.</p>
<p>The first four fields of the <code class="docutils literal"><span class="pre">ext4_xattr_entry</span></code> are set to zero to
mark the end of the key list.</p>
<div class="section" id="attribute-name-indices">
<h2>Attribute Name Indices<a class="headerlink" href="#attribute-name-indices" title="Permalink to this headline">¶</a></h2>
<p>Logically speaking, extended attributes are a series of key=value pairs.
The keys are assumed to be NULL-terminated strings. To reduce the amount
of on-disk space that the keys consume, the beginning of the key string
is matched against the attribute name index. If a match is found, the
attribute name index field is set, and matching string is removed from
the key name. Here is a map of name index values to key prefixes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="1%" />
<col width="99%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name Index</th>
<th class="head">Key Prefix</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>(no prefix)</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>“user.”</td>
</tr>
<tr class="row-even"><td>2</td>
<td>“system.posix_acl_access”</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>“system.posix_acl_default”</td>
</tr>
<tr class="row-even"><td>4</td>
<td>“trusted.”</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>“security.”</td>
</tr>
<tr class="row-even"><td>7</td>
<td>“system.” (inline_data only?)</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>“system.richacl” (SuSE kernels only?)</td>
</tr>
</tbody>
</table>
<p>For example, if the attribute key is “user.fubar”, the attribute name
index is set to 1 and the “fubar” name is recorded on disk.</p>
</div>
<div class="section" id="posix-acls">
<h2>POSIX ACLs<a class="headerlink" href="#posix-acls" title="Permalink to this headline">¶</a></h2>
<p>POSIX ACLs are stored in a reduced version of the Linux kernel (and
libacl&#8217;s) internal ACL format. The key difference is that the version
number is different (1) and the <code class="docutils literal"><span class="pre">e_id</span></code> field is only stored for named
user and group ACLs.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>