

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.5. V4L2 device instance &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../../index.html"/>
        <link rel="up" title="1. Video4Linux devices" href="v4l2-core.html"/>
        <link rel="next" title="1.6. V4L2 File handlers" href="v4l2-fh.html"/>
        <link rel="prev" title="1.4. Video deviceâ€™ s internal representation" href="v4l2-dev.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="v4l2-core.html">1. Video4Linux devices</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html">1.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-a-v4l-driver">1.2. Structure of a V4L driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-the-v4l2-framework">1.3. Structure of the V4L2 framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dev.html">1.4. Video device&#8217; s internal representation</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">1.5. V4L2 device instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-fh.html">1.6. V4L2 File handlers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html">1.7. V4L2 sub-devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-userspace-api">1.8. V4L2 sub-device userspace API</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#i2c-sub-device-drivers">1.9. I2C sub-device drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-functions-and-data-structures">1.10. V4L2 sub-device functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-event.html">1.11. V4L2 events</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-controls.html">1.12. V4L2 Controls</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf.html">1.13. Videobuf Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf2.html">1.14. V4L2 videobuf2 functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-clocks.html">1.15. V4L2 clocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dv-timings.html">1.16. V4L2 DV Timings functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-flash-led-class.html">1.17. V4L2 flash functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mc.html">1.18. V4L2 Media Controller functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mediabus.html">1.19. V4L2 Media Bus functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mem2mem.html">1.20. V4L2 Memory to Memory functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-async.html">1.21. V4L2 async kAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-fwnode.html">1.22. V4L2 fwnode kAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-rect.html">1.23. V4L2 rect helper functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tuner.html">1.24. Tuner functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-common.html">1.25. V4L2 common functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tveeprom.html">1.26. Hauppauge TV EEPROM functions and data structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dtv-core.html">2. Digital TV (DVB) devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="rc-core.html">3. Remote Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc-core.html">4. Media Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="cec-core.html">5. CEC Kernel Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="csi2.html">6. MIPI CSI-2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
      
          <li><a href="../media_kapi.html">Media subsystem kernel internal API</a> &raquo;</li>
      
          <li><a href="v4l2-core.html">1. Video4Linux devices</a> &raquo;</li>
      
    <li>1.5. V4L2 device instance</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/media/kapi/v4l2-device.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="v4l2-device-instance">
<h1>1.5. V4L2 device instance<a class="headerlink" href="#v4l2-device-instance" title="Permalink to this headline">Â¶</a></h1>
<p>Each device instance is represented by a struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a>.
Very simple devices can just allocate this struct, but most of the time you
would embed this struct inside a larger struct.</p>
<p>You must register the device instance by calling:</p>
<blockquote>
<div><a class="reference internal" href="#c.v4l2_device_register" title="v4l2_device_register"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_register</span></code></a>
(dev, <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>).</div></blockquote>
<p>Registration will initialize the <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> struct. If the
dev-&gt;driver_data field is <code class="docutils literal"><span class="pre">NULL</span></code>, it will be linked to
<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a> argument.</p>
<p>Drivers that want integration with the media device framework need to set
dev-&gt;driver_data manually to point to the driver-specific device structure
that embed the struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> instance. This is achieved by a
<code class="docutils literal"><span class="pre">dev_set_drvdata()</span></code> call before registering the V4L2 device instance.
They must also set the struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> mdev field to point to a
properly initialized and registered <a class="reference internal" href="mc-core.html#c.media_device" title="media_device"><code class="xref c c-type docutils literal"><span class="pre">media_device</span></code></a> instance.</p>
<p>If <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>-&gt;name is empty then it will be set to a
value derived from dev (driver name followed by the bus_id, to be precise).
If you set it up before  calling <a class="reference internal" href="#c.v4l2_device_register" title="v4l2_device_register"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_register()</span></code></a> then it will
be untouched. If dev is <code class="docutils literal"><span class="pre">NULL</span></code>, then you <strong>must</strong> setup
<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>-&gt;name before calling
<a class="reference internal" href="#c.v4l2_device_register" title="v4l2_device_register"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_register()</span></code></a>.</p>
<p>You can use <a class="reference internal" href="#c.v4l2_device_set_name" title="v4l2_device_set_name"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_set_name()</span></code></a> to set the name based on a driver
name and a driver-global atomic_t instance. This will generate names like
<code class="docutils literal"><span class="pre">ivtv0</span></code>, <code class="docutils literal"><span class="pre">ivtv1</span></code>, etc. If the name ends with a digit, then it will insert
a dash: <code class="docutils literal"><span class="pre">cx18-0</span></code>, <code class="docutils literal"><span class="pre">cx18-1</span></code>, etc. This function returns the instance number.</p>
<p>The first <code class="docutils literal"><span class="pre">dev</span></code> argument is normally the <code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span></code> pointer of a
<code class="docutils literal"><span class="pre">pci_dev</span></code>, <code class="docutils literal"><span class="pre">usb_interface</span></code> or <code class="docutils literal"><span class="pre">platform_device</span></code>. It is rare for dev to
be <code class="docutils literal"><span class="pre">NULL</span></code>, but it happens with ISA devices or when one device creates
multiple PCI devices, thus making it impossible to associate
<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a> with a particular parent.</p>
<p>You can also supply a <code class="docutils literal"><span class="pre">notify()</span></code> callback that can be called by sub-devices
to notify you of events. Whether you need to set this depends on the
sub-device. Any notifications a sub-device supports must be defined in a header
in <code class="docutils literal"><span class="pre">include/media/subdevice.h</span></code>.</p>
<p>V4L2 devices are unregistered by calling:</p>
<blockquote>
<div><a class="reference internal" href="#c.v4l2_device_unregister" title="v4l2_device_unregister"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_unregister()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>).</div></blockquote>
<p>If the dev-&gt;driver_data field points to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>,
it will be reset to <code class="docutils literal"><span class="pre">NULL</span></code>. Unregistering will also automatically unregister
all subdevs from the device.</p>
<p>If you have a hotpluggable device (e.g. a USB device), then when a disconnect
happens the parent device becomes invalid. Since <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> has a
pointer to that parent device it has to be cleared as well to mark that the
parent is gone. To do this call:</p>
<blockquote>
<div><a class="reference internal" href="#c.v4l2_device_disconnect" title="v4l2_device_disconnect"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_disconnect()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>).</div></blockquote>
<p>This does <em>not</em> unregister the subdevs, so you still need to call the
<a class="reference internal" href="#c.v4l2_device_unregister" title="v4l2_device_unregister"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_unregister()</span></code></a> function for that. If your driver is not
hotpluggable, then there is no need to call <a class="reference internal" href="#c.v4l2_device_disconnect" title="v4l2_device_disconnect"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_disconnect()</span></code></a>.</p>
<p>Sometimes you need to iterate over all devices registered by a specific
driver. This is usually the case if multiple device drivers use the same
hardware. E.g. the ivtvfb driver is a framebuffer driver that uses the ivtv
hardware. The same is true for alsa drivers for example.</p>
<p>You can iterate over all registered devices as follows:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">static</span> <span class="kt">int</span> <span class="nf">callback</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">struct</span> <span class="n">v4l2_device</span> <span class="o">*</span><span class="n">v4l2_dev</span> <span class="o">=</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

        <span class="cm">/* test if this device was inited */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v4l2_dev</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">...</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">iterate</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">struct</span> <span class="n">device_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

        <span class="cm">/* Find driver &#39;ivtv&#39; on the PCI bus.</span>
<span class="cm">        pci_bus_type is a global. For USB busses use usb_bus_type. */</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="n">driver_find</span><span class="p">(</span><span class="s">&quot;ivtv&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pci_bus_type</span><span class="p">);</span>
        <span class="cm">/* iterate over all ivtv device instances */</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">driver_for_each_device</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
        <span class="n">put_driver</span><span class="p">(</span><span class="n">drv</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sometimes you need to keep a running counter of the device instance. This is
commonly used to map a device instance to an index of a module option array.</p>
<p>The recommended approach is as follows:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">static</span> <span class="n">atomic_t</span> <span class="n">drv_instance</span> <span class="o">=</span> <span class="n">ATOMIC_INIT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">drv_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pci_device_id</span> <span class="o">*</span><span class="n">pci_id</span><span class="p">)</span>
<span class="p">{</span>
        <span class="p">...</span>
        <span class="n">state</span><span class="o">-&gt;</span><span class="n">instance</span> <span class="o">=</span> <span class="n">atomic_inc_return</span><span class="p">(</span><span class="o">&amp;</span><span class="n">drv_instance</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you have multiple device nodes then it can be difficult to know when it is
safe to unregister <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> for hotpluggable devices. For this
purpose <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> has refcounting support. The refcount is
increased whenever <a class="reference internal" href="v4l2-dev.html#c.video_register_device" title="video_register_device"><code class="xref c c-func docutils literal"><span class="pre">video_register_device()</span></code></a> is called and it is
decreased whenever that device node is released. When the refcount reaches
zero, then the <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> release() callback is called. You can
do your final cleanup there.</p>
<p>If other device nodes (e.g. ALSA) are created, then you can increase and
decrease the refcount manually as well by calling:</p>
<blockquote>
<div><a class="reference internal" href="#c.v4l2_device_get" title="v4l2_device_get"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_get()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>).</div></blockquote>
<p>or:</p>
<blockquote>
<div><a class="reference internal" href="#c.v4l2_device_put" title="v4l2_device_put"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_put()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_dev</span></code></a>).</div></blockquote>
<p>Since the initial refcount is 1 you also need to call
<a class="reference internal" href="#c.v4l2_device_put" title="v4l2_device_put"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_put()</span></code></a> in the <code class="docutils literal"><span class="pre">disconnect()</span></code> callback (for USB devices)
or in the <code class="docutils literal"><span class="pre">remove()</span></code> callback (for e.g. PCI devices), otherwise the refcount
will never reach 0.</p>
<div class="section" id="v4l2-device-functions-and-data-structures">
<h2>1.5.1. v4l2_device functions and data structures<a class="headerlink" href="#v4l2-device-functions-and-data-structures" title="Permalink to this headline">Â¶</a></h2>
<dl class="type">
<dt id="c.v4l2_device">
struct <code class="descname">v4l2_device</code><a class="headerlink" href="#c.v4l2_device" title="Permalink to this definition">Â¶</a></dt>
<dd><p>main struct to for V4L2 device drivers</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct v4l2_device {
  struct device *dev;
  struct media_device *mdev;
  struct list_head subdevs;
  spinlock_t lock;
  char name[V4L2_DEVICE_NAME_SIZE];
  void (*notify)(struct v4l2_subdev *sd, unsigned int notification, void *arg);
  struct v4l2_ctrl_handler *ctrl_handler;
  struct v4l2_prio_state prio;
  struct kref ref;
  void (*release)(struct v4l2_device *v4l2_dev);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">dev</span></code></dt>
<dd>pointer to struct device.</dd>
<dt><code class="docutils literal"><span class="pre">mdev</span></code></dt>
<dd>pointer to struct media_device, may be NULL.</dd>
<dt><code class="docutils literal"><span class="pre">subdevs</span></code></dt>
<dd>used to keep track of the registered subdevs</dd>
<dt><code class="docutils literal"><span class="pre">lock</span></code></dt>
<dd>lock this struct; can be used by the driver as well
if this struct is embedded into a larger struct.</dd>
<dt><code class="docutils literal"><span class="pre">name</span></code></dt>
<dd>unique device name, by default the driver name + bus ID</dd>
<dt><code class="docutils literal"><span class="pre">notify</span></code></dt>
<dd>notify operation called by some sub-devices.</dd>
<dt><code class="docutils literal"><span class="pre">ctrl_handler</span></code></dt>
<dd>The control handler. May be <code class="docutils literal"><span class="pre">NULL</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">prio</span></code></dt>
<dd>Device&#8217;s priority state</dd>
<dt><code class="docutils literal"><span class="pre">ref</span></code></dt>
<dd>Keep track of the references to this struct.</dd>
<dt><code class="docutils literal"><span class="pre">release</span></code></dt>
<dd>Release function that is called when the ref count
goes to 0.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Each instance of a V4L2 device should create the v4l2_device struct,
either stand-alone or embedded in a larger struct.</p>
<p>It allows easy access to sub-devices (see v4l2-subdev.h) and provides
basic V4L2 device-level support.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li><strong>dev</strong>-&gt;driver_data points to this struct.</li>
<li><strong>dev</strong> might be <code class="docutils literal"><span class="pre">NULL</span></code> if there is no parent device</li>
</ol>
</div>
<dl class="function">
<dt id="c.v4l2_device_get">
void <code class="descname">v4l2_device_get</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_get" title="Permalink to this definition">Â¶</a></dt>
<dd><p>gets a V4L2 device reference</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>This is an ancillary routine meant to increment the usage for the
struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> pointed by <strong>v4l2_dev</strong>.</p>
<dl class="function">
<dt id="c.v4l2_device_put">
int <code class="descname">v4l2_device_put</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_put" title="Permalink to this definition">Â¶</a></dt>
<dd><p>putss a V4L2 device reference</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>This is an ancillary routine meant to decrement the usage for the
struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a> pointed by <strong>v4l2_dev</strong>.</p>
<dl class="function">
<dt id="c.v4l2_device_register">
int <code class="descname">v4l2_device_register</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em>, struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_register" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Initialize v4l2_dev and make <strong>dev</strong>-&gt;driver_data point to <strong>v4l2_dev</strong>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-type docutils literal"><span class="pre">device</span></code></a></dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>dev</strong> may be <code class="docutils literal"><span class="pre">NULL</span></code> in rare cases (ISA devices).
In such case the caller must fill in the <strong>v4l2_dev</strong>-&gt;name field
before calling this function.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_set_name">
int <code class="descname">v4l2_device_set_name</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em>, const char *<em>&nbsp;basename</em>, atomic_t *<em>&nbsp;instance</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_set_name" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Optional function to initialize the name field of struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a></p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a></dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">basename</span></code></dt>
<dd>base name for the device name</dd>
<dt><code class="docutils literal"><span class="pre">atomic_t</span> <span class="pre">*</span> <span class="pre">instance</span></code></dt>
<dd>pointer to a static atomic_t var with the instance usage for
the device driver.</dd>
</dl>
<p><strong>Description</strong></p>
<p><a class="reference internal" href="#c.v4l2_device_set_name" title="v4l2_device_set_name"><code class="xref c c-func docutils literal"><span class="pre">v4l2_device_set_name()</span></code></a> initializes the name field of struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a>
using the driver name and a driver-global atomic_t instance.</p>
<p>This function will increment the instance counter and returns the
instance value used in the name.</p>
<p><strong>Example</strong></p>
<blockquote>
<div><p>static atomic_t drv_instance = ATOMIC_INIT(0);</p>
<p>...</p>
<p>instance = v4l2_device_set_name(&amp;v4l2_dev, &#8220;foo&#8221;, &amp;drv_instance);</p>
</div></blockquote>
<p>The first time this is called the name field will be set to foo0 and
this function returns 0. If the name ends with a digit (e.g. cx18),
then the name will be set to cx18-0 since cx180 would look really odd.</p>
<dl class="function">
<dt id="c.v4l2_device_disconnect">
void <code class="descname">v4l2_device_disconnect</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_disconnect" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Change V4L2 device state to disconnected.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct v4l2_device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Should be called when the USB parent disconnects.
Since the parent disappears, this ensures that <strong>v4l2_dev</strong> doesn&#8217;t have
an invalid parent pointer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This function sets <strong>v4l2_dev</strong>-&gt;dev to NULL.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_unregister">
void <code class="descname">v4l2_device_unregister</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_unregister" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Unregister all sub-devices and any other resources related to <strong>v4l2_dev</strong>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct v4l2_device</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_device_register_subdev">
int <code class="descname">v4l2_device_register_subdev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em>, struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a> *<em>&nbsp;sd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_register_subdev" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Registers a subdev with a v4l2 device.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a></dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*</span> <span class="pre">sd</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>While registered, the subdev module is marked as in-use.</p>
<p>An error is returned if the module is no longer loaded on any attempts
to register it.</p>
<dl class="function">
<dt id="c.v4l2_device_unregister_subdev">
void <code class="descname">v4l2_device_unregister_subdev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a> *<em>&nbsp;sd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_unregister_subdev" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Unregisters a subdev with a v4l2 device.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*</span> <span class="pre">sd</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Can also be called if the subdev wasn&#8217;t registered. In such
case, it will do nothing.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_register_subdev_nodes">
int <code class="descname">v4l2_device_register_subdev_nodes</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a> *<em>&nbsp;v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_register_subdev_nodes" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Registers device nodes for all subdevs of the v4l2 device that are marked with the <code class="docutils literal"><span class="pre">V4L2_SUBDEV_FL_HAS_DEVNODE</span></code> flag.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*</span> <span class="pre">v4l2_dev</span></code></dt>
<dd>pointer to struct v4l2_device</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_subdev_notify">
void <code class="descname">v4l2_subdev_notify</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a> *<em>&nbsp;sd</em>, unsigned int<em>&nbsp;notification</em>, void *<em>&nbsp;arg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_subdev_notify" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Sends a notification to v4l2_device.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*</span> <span class="pre">sd</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">notification</span></code></dt>
<dd>type of notification. Please notice that the notification
type is driver-specific.</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">arg</span></code></dt>
<dd>arguments for the notification. Those are specific to each
notification type.</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_device_for_each_subdev">
<code class="descname">v4l2_device_for_each_subdev</code><span class="sig-paren">(</span><em>sd</em>, <em>v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_for_each_subdev" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Helper macro that interates over all sub-devices of a given <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">v4l2_device</span></code></a>.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">sd</span></code></dt>
<dd>pointer that will be filled by the macro with all
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a> pointer used as an iterator by the loop.</dd>
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This macro iterates over all sub-devices owned by the <strong>v4l2_dev</strong> device.
It acts as a for loop iterator and executes the next statement with
the <strong>sd</strong> variable pointing to each sub-device in turn.</p>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs_p">
<code class="descname">__v4l2_device_call_subdevs_p</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>sd</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs_p" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">sd</span></code></dt>
<dd>pointer that will be filled by the macro with all
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a> pointer used as an iterator by the loop.</dd>
<dt><code class="docutils literal"><span class="pre">cond</span></code></dt>
<dd>condition to be match</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs">
<code class="descname">__v4l2_device_call_subdevs</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">cond</span></code></dt>
<dd>condition to be match</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs_until_err_p">
<code class="descname">__v4l2_device_call_subdevs_until_err_p</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>sd</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs_until_err_p" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">sd</span></code></dt>
<dd>pointer that will be filled by the macro with all
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a> sub-devices associated with <strong>v4l2_dev</strong>.</dd>
<dt><code class="docutils literal"><span class="pre">cond</span></code></dt>
<dd>condition to be match</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Return</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code, zero
otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs_until_err">
<code class="descname">__v4l2_device_call_subdevs_until_err</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs_until_err" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">cond</span></code></dt>
<dd>condition to be match</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Return</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code,
zero otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.v4l2_device_call_all">
<code class="descname">v4l2_device_call_all</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpid</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_call_all" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">v4l2_subdev.grp_id</span></code></a>, as assigned by the bridge driver.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">grpid</span></code></dt>
<dd><a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id group ID to match.
Use 0 to match them all.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.v4l2_device_call_until_err">
<code class="descname">v4l2_device_call_until_err</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpid</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_call_until_err" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">v4l2_subdev.grp_id</span></code></a>, as assigned by the bridge driver, until an error occurs.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">grpid</span></code></dt>
<dd><a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id group ID to match.
Use 0 to match them all.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Return</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code,
zero otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.v4l2_device_mask_call_all">
<code class="descname">v4l2_device_mask_call_all</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpmsk</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_mask_call_all" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevices where a group ID matches a specified bitmask.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">grpmsk</span></code></dt>
<dd>bitmask to be checked against <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id
group ID to be matched. Use 0 to match them all.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.v4l2_device_mask_call_until_err">
<code class="descname">v4l2_device_mask_call_until_err</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpmsk</em>, <em>o</em>, <em>f</em>, <em>args...</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_mask_call_until_err" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calls the specified operation for all subdevices where a group ID matches a specified bitmask.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">grpmsk</span></code></dt>
<dd>bitmask to be checked against <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id
group ID to be matched. Use 0 to match them all.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">args...</span></code></dt>
<dd>arguments for <strong>f</strong>.</dd>
</dl>
<p><strong>Return</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code,
zero otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
<dl class="function">
<dt id="c.v4l2_device_has_op">
<code class="descname">v4l2_device_has_op</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpid</em>, <em>o</em>, <em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_has_op" title="Permalink to this definition">Â¶</a></dt>
<dd><p>checks if any subdev with matching grpid has a given ops.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">grpid</span></code></dt>
<dd><a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id group ID to match.
Use 0 to match them all.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_device_mask_has_op">
<code class="descname">v4l2_device_mask_has_op</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpmsk</em>, <em>o</em>, <em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_mask_has_op" title="Permalink to this definition">Â¶</a></dt>
<dd><p>checks if any subdev with matching group mask has a given ops.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">v4l2_dev</span></code></dt>
<dd><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</dd>
<dt><code class="docutils literal"><span class="pre">grpmsk</span></code></dt>
<dd>bitmask to be checked against <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id
group ID to be matched. Use 0 to match them all.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code></dt>
<dd>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code></dt>
<dd>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</dd>
</dl>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="v4l2-fh.html" class="btn btn-neutral float-right" title="1.6. V4L2 File handlers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="v4l2-dev.html" class="btn btn-neutral" title="1.4. Video deviceâ€™ s internal representation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>