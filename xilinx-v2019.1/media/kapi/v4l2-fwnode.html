

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.22. V4L2 fwnode kAPI &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../../index.html"/>
        <link rel="up" title="1. Video4Linux devices" href="v4l2-core.html"/>
        <link rel="next" title="1.23. V4L2 rect helper functions" href="v4l2-rect.html"/>
        <link rel="prev" title="1.21. V4L2 async kAPI" href="v4l2-async.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="v4l2-core.html">1. Video4Linux devices</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html">1.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-a-v4l-driver">1.2. Structure of a V4L driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-the-v4l2-framework">1.3. Structure of the V4L2 framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dev.html">1.4. Video device&#8217; s internal representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-device.html">1.5. V4L2 device instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-fh.html">1.6. V4L2 File handlers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html">1.7. V4L2 sub-devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-userspace-api">1.8. V4L2 sub-device userspace API</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#i2c-sub-device-drivers">1.9. I2C sub-device drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-functions-and-data-structures">1.10. V4L2 sub-device functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-event.html">1.11. V4L2 events</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-controls.html">1.12. V4L2 Controls</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf.html">1.13. Videobuf Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf2.html">1.14. V4L2 videobuf2 functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-clocks.html">1.15. V4L2 clocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dv-timings.html">1.16. V4L2 DV Timings functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-flash-led-class.html">1.17. V4L2 flash functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mc.html">1.18. V4L2 Media Controller functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mediabus.html">1.19. V4L2 Media Bus functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mem2mem.html">1.20. V4L2 Memory to Memory functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-async.html">1.21. V4L2 async kAPI</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">1.22. V4L2 fwnode kAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-rect.html">1.23. V4L2 rect helper functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tuner.html">1.24. Tuner functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-common.html">1.25. V4L2 common functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tveeprom.html">1.26. Hauppauge TV EEPROM functions and data structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dtv-core.html">2. Digital TV (DVB) devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="rc-core.html">3. Remote Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc-core.html">4. Media Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="cec-core.html">5. CEC Kernel Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="csi2.html">6. MIPI CSI-2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
      
          <li><a href="../media_kapi.html">Media subsystem kernel internal API</a> &raquo;</li>
      
          <li><a href="v4l2-core.html">1. Video4Linux devices</a> &raquo;</li>
      
    <li>1.22. V4L2 fwnode kAPI</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/media/kapi/v4l2-fwnode.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="v4l2-fwnode-kapi">
<h1>1.22. V4L2 fwnode kAPI<a class="headerlink" href="#v4l2-fwnode-kapi" title="Permalink to this headline">¶</a></h1>
<dl class="type">
<dt id="c.v4l2_fwnode_bus_mipi_csi2">
struct <code class="descname">v4l2_fwnode_bus_mipi_csi2</code><a class="headerlink" href="#c.v4l2_fwnode_bus_mipi_csi2" title="Permalink to this definition">¶</a></dt>
<dd><p>MIPI CSI-2 bus data structure</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct v4l2_fwnode_bus_mipi_csi2 {
  unsigned int flags;
  unsigned char data_lanes[V4L2_FWNODE_CSI2_MAX_DATA_LANES];
  unsigned char clock_lane;
  unsigned short num_data_lanes;
  bool lane_polarities[1 + V4L2_FWNODE_CSI2_MAX_DATA_LANES];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">flags</span></code></dt>
<dd>media bus (V4L2_MBUS_*) flags</dd>
<dt><code class="docutils literal"><span class="pre">data_lanes</span></code></dt>
<dd>an array of physical data lane indexes</dd>
<dt><code class="docutils literal"><span class="pre">clock_lane</span></code></dt>
<dd>physical lane index of the clock lane</dd>
<dt><code class="docutils literal"><span class="pre">num_data_lanes</span></code></dt>
<dd>number of data lanes</dd>
<dt><code class="docutils literal"><span class="pre">lane_polarities</span></code></dt>
<dd>polarity of the lanes. The order is the same of
the physical lanes.</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_fwnode_bus_parallel">
struct <code class="descname">v4l2_fwnode_bus_parallel</code><a class="headerlink" href="#c.v4l2_fwnode_bus_parallel" title="Permalink to this definition">¶</a></dt>
<dd><p>parallel data bus data structure</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct v4l2_fwnode_bus_parallel {
  unsigned int flags;
  unsigned char bus_width;
  unsigned char data_shift;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">flags</span></code></dt>
<dd>media bus (V4L2_MBUS_*) flags</dd>
<dt><code class="docutils literal"><span class="pre">bus_width</span></code></dt>
<dd>bus width in bits</dd>
<dt><code class="docutils literal"><span class="pre">data_shift</span></code></dt>
<dd>data shift in bits</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_fwnode_bus_mipi_csi1">
struct <code class="descname">v4l2_fwnode_bus_mipi_csi1</code><a class="headerlink" href="#c.v4l2_fwnode_bus_mipi_csi1" title="Permalink to this definition">¶</a></dt>
<dd><p>CSI-1/CCP2 data bus structure</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct v4l2_fwnode_bus_mipi_csi1 {
  bool clock_inv;
  bool strobe;
  bool lane_polarity[2];
  unsigned char data_lane;
  unsigned char clock_lane;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">clock_inv</span></code></dt>
<dd>polarity of clock/strobe signal
false - not inverted, true - inverted</dd>
<dt><code class="docutils literal"><span class="pre">strobe</span></code></dt>
<dd>false - data/clock, true - data/strobe</dd>
<dt><code class="docutils literal"><span class="pre">lane_polarity</span></code></dt>
<dd>the polarities of the clock (index 0) and data lanes
index (1)</dd>
<dt><code class="docutils literal"><span class="pre">data_lane</span></code></dt>
<dd>the number of the data lane</dd>
<dt><code class="docutils literal"><span class="pre">clock_lane</span></code></dt>
<dd>the number of the clock lane</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_fwnode_endpoint">
struct <code class="descname">v4l2_fwnode_endpoint</code><a class="headerlink" href="#c.v4l2_fwnode_endpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>the endpoint data structure</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct v4l2_fwnode_endpoint {
  struct fwnode_endpoint base;
  enum v4l2_mbus_type bus_type;
  union {
    struct v4l2_fwnode_bus_parallel parallel;
    struct v4l2_fwnode_bus_mipi_csi1 mipi_csi1;
    struct v4l2_fwnode_bus_mipi_csi2 mipi_csi2;
  } bus;
  u64 *link_frequencies;
  unsigned int nr_of_link_frequencies;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">base</span></code></dt>
<dd>fwnode endpoint of the v4l2_fwnode</dd>
<dt><code class="docutils literal"><span class="pre">bus_type</span></code></dt>
<dd>bus type</dd>
<dt><code class="docutils literal"><span class="pre">bus</span></code></dt>
<dd>union with bus configuration data structure</dd>
<dt><code class="docutils literal"><span class="pre">bus.parallel</span></code></dt>
<dd>embedded <a class="reference internal" href="#c.v4l2_fwnode_bus_parallel" title="v4l2_fwnode_bus_parallel"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_bus_parallel</span></code></a>.
Used if the bus is parallel.</dd>
<dt><code class="docutils literal"><span class="pre">bus.mipi_csi1</span></code></dt>
<dd>embedded <a class="reference internal" href="#c.v4l2_fwnode_bus_mipi_csi1" title="v4l2_fwnode_bus_mipi_csi1"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_bus_mipi_csi1</span></code></a>.
Used if the bus is MIPI Alliance&#8217;s Camera Serial
Interface version 1 (MIPI CSI1) or Standard
Mobile Imaging Architecture&#8217;s Compact Camera Port 2
(SMIA CCP2).</dd>
<dt><code class="docutils literal"><span class="pre">bus.mipi_csi2</span></code></dt>
<dd>embedded <a class="reference internal" href="#c.v4l2_fwnode_bus_mipi_csi2" title="v4l2_fwnode_bus_mipi_csi2"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_bus_mipi_csi2</span></code></a>.
Used if the bus is MIPI Alliance&#8217;s Camera Serial
Interface version 2 (MIPI CSI2).</dd>
<dt><code class="docutils literal"><span class="pre">link_frequencies</span></code></dt>
<dd>array of supported link frequencies</dd>
<dt><code class="docutils literal"><span class="pre">nr_of_link_frequencies</span></code></dt>
<dd>number of elements in link_frequenccies array</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_fwnode_link">
struct <code class="descname">v4l2_fwnode_link</code><a class="headerlink" href="#c.v4l2_fwnode_link" title="Permalink to this definition">¶</a></dt>
<dd><p>a link between two endpoints</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct v4l2_fwnode_link {
  struct fwnode_handle *local_node;
  unsigned int local_port;
  struct fwnode_handle *remote_node;
  unsigned int remote_port;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">local_node</span></code></dt>
<dd>pointer to device_node of this endpoint</dd>
<dt><code class="docutils literal"><span class="pre">local_port</span></code></dt>
<dd>identifier of the port this endpoint belongs to</dd>
<dt><code class="docutils literal"><span class="pre">remote_node</span></code></dt>
<dd>pointer to device_node of the remote endpoint</dd>
<dt><code class="docutils literal"><span class="pre">remote_port</span></code></dt>
<dd>identifier of the port the remote endpoint belongs to</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_fwnode_endpoint_parse">
int <code class="descname">v4l2_fwnode_endpoint_parse</code><span class="sig-paren">(</span>struct fwnode_handle *<em>&nbsp;fwnode</em>, struct <a class="reference internal" href="#c.v4l2_fwnode_endpoint" title="v4l2_fwnode_endpoint">v4l2_fwnode_endpoint</a> *<em>&nbsp;vep</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_fwnode_endpoint_parse" title="Permalink to this definition">¶</a></dt>
<dd><p>parse all fwnode node properties</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">fwnode_handle</span> <span class="pre">*</span> <span class="pre">fwnode</span></code></dt>
<dd>pointer to the endpoint&#8217;s fwnode handle</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_endpoint</span> <span class="pre">*</span> <span class="pre">vep</span></code></dt>
<dd>pointer to the V4L2 fwnode data structure</dd>
</dl>
<p><strong>Description</strong></p>
<p>All properties are optional. If none are found, we don&#8217;t set any flags. This
means the port has a static configuration and no properties have to be
specified explicitly. If any properties that identify the bus as parallel
are found and slave-mode isn&#8217;t set, we set V4L2_MBUS_MASTER. Similarly, if
we recognise the bus as serial CSI-2 and clock-noncontinuous isn&#8217;t set, we
set the V4L2_MBUS_CSI2_CONTINUOUS_CLOCK flag. The caller should hold a
reference to <strong>fwnode</strong>.</p>
<p><strong>NOTE</strong></p>
<p>This function does not parse properties the size of which is variable
without a low fixed limit. Please use <a class="reference internal" href="#c.v4l2_fwnode_endpoint_alloc_parse" title="v4l2_fwnode_endpoint_alloc_parse"><code class="xref c c-func docutils literal"><span class="pre">v4l2_fwnode_endpoint_alloc_parse()</span></code></a> in
new drivers instead.</p>
<p><strong>Return</strong></p>
<p>0 on success or a negative error code on failure.</p>
<dl class="function">
<dt id="c.v4l2_fwnode_endpoint_free">
void <code class="descname">v4l2_fwnode_endpoint_free</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_fwnode_endpoint" title="v4l2_fwnode_endpoint">v4l2_fwnode_endpoint</a> *<em>&nbsp;vep</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_fwnode_endpoint_free" title="Permalink to this definition">¶</a></dt>
<dd><p>free the V4L2 fwnode acquired by <a class="reference internal" href="#c.v4l2_fwnode_endpoint_alloc_parse" title="v4l2_fwnode_endpoint_alloc_parse"><code class="xref c c-func docutils literal"><span class="pre">v4l2_fwnode_endpoint_alloc_parse()</span></code></a></p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_endpoint</span> <span class="pre">*</span> <span class="pre">vep</span></code></dt>
<dd>the V4L2 fwnode the resources of which are to be released</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is safe to call this function with NULL argument or on a V4L2 fwnode the
parsing of which failed.</p>
<dl class="function">
<dt id="c.v4l2_fwnode_endpoint_alloc_parse">
struct <a class="reference internal" href="#c.v4l2_fwnode_endpoint" title="v4l2_fwnode_endpoint">v4l2_fwnode_endpoint</a> * <code class="descname">v4l2_fwnode_endpoint_alloc_parse</code><span class="sig-paren">(</span>struct fwnode_handle *<em>&nbsp;fwnode</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_fwnode_endpoint_alloc_parse" title="Permalink to this definition">¶</a></dt>
<dd><p>parse all fwnode node properties</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">fwnode_handle</span> <span class="pre">*</span> <span class="pre">fwnode</span></code></dt>
<dd>pointer to the endpoint&#8217;s fwnode handle</dd>
</dl>
<p><strong>Description</strong></p>
<p>All properties are optional. If none are found, we don&#8217;t set any flags. This
means the port has a static configuration and no properties have to be
specified explicitly. If any properties that identify the bus as parallel
are found and slave-mode isn&#8217;t set, we set V4L2_MBUS_MASTER. Similarly, if
we recognise the bus as serial CSI-2 and clock-noncontinuous isn&#8217;t set, we
set the V4L2_MBUS_CSI2_CONTINUOUS_CLOCK flag. The caller should hold a
reference to <strong>fwnode</strong>.</p>
<p><a class="reference internal" href="#c.v4l2_fwnode_endpoint_alloc_parse" title="v4l2_fwnode_endpoint_alloc_parse"><code class="xref c c-func docutils literal"><span class="pre">v4l2_fwnode_endpoint_alloc_parse()</span></code></a> has two important differences to
<a class="reference internal" href="#c.v4l2_fwnode_endpoint_parse" title="v4l2_fwnode_endpoint_parse"><code class="xref c c-func docutils literal"><span class="pre">v4l2_fwnode_endpoint_parse()</span></code></a>:</p>
<ol class="arabic simple">
<li>It also parses variable size data.</li>
<li>The memory it has allocated to store the variable size data must be freed
using <a class="reference internal" href="#c.v4l2_fwnode_endpoint_free" title="v4l2_fwnode_endpoint_free"><code class="xref c c-func docutils literal"><span class="pre">v4l2_fwnode_endpoint_free()</span></code></a> when no longer needed.</li>
</ol>
<p><strong>Return</strong></p>
<p>Pointer to v4l2_fwnode_endpoint if successful, on an error pointer
on error.</p>
<dl class="function">
<dt id="c.v4l2_fwnode_parse_link">
int <code class="descname">v4l2_fwnode_parse_link</code><span class="sig-paren">(</span>struct fwnode_handle *<em>&nbsp;fwnode</em>, struct <a class="reference internal" href="#c.v4l2_fwnode_link" title="v4l2_fwnode_link">v4l2_fwnode_link</a> *<em>&nbsp;link</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_fwnode_parse_link" title="Permalink to this definition">¶</a></dt>
<dd><p>parse a link between two endpoints</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">fwnode_handle</span> <span class="pre">*</span> <span class="pre">fwnode</span></code></dt>
<dd>pointer to the endpoint&#8217;s fwnode at the local end of the link</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_link</span> <span class="pre">*</span> <span class="pre">link</span></code></dt>
<dd>pointer to the V4L2 fwnode link data structure</dd>
</dl>
<p><strong>Description</strong></p>
<p>Fill the link structure with the local and remote nodes and port numbers.
The local_node and remote_node fields are set to point to the local and
remote port&#8217;s parent nodes respectively (the port parent node being the
parent node of the port node if that node isn&#8217;t a &#8216;ports&#8217; node, or the
grand-parent node of the port node otherwise).</p>
<p>A reference is taken to both the local and remote nodes, the caller must use
<a class="reference internal" href="#c.v4l2_fwnode_put_link" title="v4l2_fwnode_put_link"><code class="xref c c-func docutils literal"><span class="pre">v4l2_fwnode_put_link()</span></code></a> to drop the references when done with the
link.</p>
<p><strong>Return</strong></p>
<p>0 on success, or -ENOLINK if the remote endpoint fwnode can&#8217;t be
found.</p>
<dl class="function">
<dt id="c.v4l2_fwnode_put_link">
void <code class="descname">v4l2_fwnode_put_link</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_fwnode_link" title="v4l2_fwnode_link">v4l2_fwnode_link</a> *<em>&nbsp;link</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_fwnode_put_link" title="Permalink to this definition">¶</a></dt>
<dd><p>drop references to nodes in a link</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_link</span> <span class="pre">*</span> <span class="pre">link</span></code></dt>
<dd>pointer to the V4L2 fwnode link data structure</dd>
</dl>
<p><strong>Description</strong></p>
<p>Drop references to the local and remote nodes in the link. This function
must be called on every link parsed with <a class="reference internal" href="#c.v4l2_fwnode_parse_link" title="v4l2_fwnode_parse_link"><code class="xref c c-func docutils literal"><span class="pre">v4l2_fwnode_parse_link()</span></code></a>.</p>
<dl class="type">
<dt id="c.parse_endpoint_func">
<code class="descname">parse_endpoint_func</code><a class="headerlink" href="#c.parse_endpoint_func" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Typedef</strong>: Driver&#8217;s callback function to be called on each V4L2 fwnode endpoint.</p>
</dd></dl>

<p><strong>Syntax</strong></p>
<blockquote>
<div><code class="docutils literal"><span class="pre">int</span> <span class="pre">parse_endpoint_func</span> <span class="pre">(struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev,</span> <span class="pre">struct</span> <span class="pre">v4l2_fwnode_endpoint</span> <span class="pre">*</span> <span class="pre">vep,</span> <span class="pre">struct</span> <span class="pre">v4l2_async_subdev</span> <span class="pre">*</span> <span class="pre">asd);</span></code></div></blockquote>
<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>pointer to <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">device</span></code></a></dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_endpoint</span> <span class="pre">*</span> <span class="pre">vep</span></code></dt>
<dd>pointer to <a class="reference internal" href="#c.v4l2_fwnode_endpoint" title="v4l2_fwnode_endpoint"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_endpoint</span></code></a></dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_async_subdev</span> <span class="pre">*</span> <span class="pre">asd</span></code></dt>
<dd>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_subdev" title="v4l2_async_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_async_subdev</span></code></a></dd>
</dl>
<p><strong>Return</strong></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">0</span></code> on success</li>
<li><code class="docutils literal"><span class="pre">-ENOTCONN</span></code> if the endpoint is to be skipped but this
should not be considered as an error</li>
<li><code class="docutils literal"><span class="pre">-EINVAL</span></code> if the endpoint configuration is invalid</li>
</ul>
<dl class="function">
<dt id="c.v4l2_async_notifier_parse_fwnode_endpoints">
int <code class="descname">v4l2_async_notifier_parse_fwnode_endpoints</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em>, struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_notifier" title="v4l2_async_notifier">v4l2_async_notifier</a> *<em>&nbsp;notifier</em>, size_t<em>&nbsp;asd_struct_size</em>, <a class="reference internal" href="#c.parse_endpoint_func" title="parse_endpoint_func">parse_endpoint_func</a><em>&nbsp;parse_endpoint</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_async_notifier_parse_fwnode_endpoints" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse V4L2 fwnode endpoints in a device node</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>the device the endpoints of which are to be parsed</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_async_notifier</span> <span class="pre">*</span> <span class="pre">notifier</span></code></dt>
<dd>notifier for <strong>dev</strong></dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">asd_struct_size</span></code></dt>
<dd>size of the driver&#8217;s async sub-device struct, including
sizeof(struct v4l2_async_subdev). The <a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_subdev" title="v4l2_async_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span>
<span class="pre">v4l2_async_subdev</span></code></a> shall be the first member of
the driver&#8217;s async sub-device struct, i.e. both
begin at the same memory address.</dd>
<dt><code class="docutils literal"><span class="pre">parse_endpoint_func</span> <span class="pre">parse_endpoint</span></code></dt>
<dd>Driver&#8217;s callback function called on each V4L2 fwnode
endpoint. Optional.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Parse the fwnode endpoints of the <strong>dev</strong> device and populate the async sub-
devices array of the notifier. The <strong>parse_endpoint</strong> callback function is
called for each endpoint with the corresponding async sub-device pointer to
let the caller initialize the driver-specific part of the async sub-device
structure.</p>
<p>The notifier memory shall be zeroed before this function is called on the
notifier.</p>
<p>This function may not be called on a registered notifier and may be called on
a notifier only once.</p>
<p>Do not change the notifier&#8217;s subdevs array, take references to the subdevs
array itself or change the notifier&#8217;s num_subdevs field. This is because this
function allocates and reallocates the subdevs array based on parsing
endpoints.</p>
<p>The <a class="reference internal" href="#c.v4l2_fwnode_endpoint" title="v4l2_fwnode_endpoint"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_endpoint</span></code></a> passed to the callback function
<strong>parse_endpoint</strong> is released once the function is finished. If there is a need
to retain that configuration, the user needs to allocate memory for it.</p>
<p>Any notifier populated using this function must be released with a call to
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_notifier_cleanup" title="v4l2_async_notifier_cleanup"><code class="xref c c-func docutils literal"><span class="pre">v4l2_async_notifier_cleanup()</span></code></a> after it has been unregistered and the async
sub-devices are no longer in use, even if the function returned an error.</p>
<p><strong>Return</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">0</span></code> on success, including when no async sub-devices are found</dt>
<dd><code class="docutils literal"><span class="pre">-ENOMEM</span></code> if memory allocation failed
<code class="docutils literal"><span class="pre">-EINVAL</span></code> if graph or endpoint parsing failed
Other error codes as returned by <strong>parse_endpoint</strong></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_async_notifier_parse_fwnode_endpoints_by_port">
int <code class="descname">v4l2_async_notifier_parse_fwnode_endpoints_by_port</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em>, struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_notifier" title="v4l2_async_notifier">v4l2_async_notifier</a> *<em>&nbsp;notifier</em>, size_t<em>&nbsp;asd_struct_size</em>, unsigned int<em>&nbsp;port</em>, <a class="reference internal" href="#c.parse_endpoint_func" title="parse_endpoint_func">parse_endpoint_func</a><em>&nbsp;parse_endpoint</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_async_notifier_parse_fwnode_endpoints_by_port" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse V4L2 fwnode endpoints of a port in a device node</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>the device the endpoints of which are to be parsed</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_async_notifier</span> <span class="pre">*</span> <span class="pre">notifier</span></code></dt>
<dd>notifier for <strong>dev</strong></dd>
<dt><code class="docutils literal"><span class="pre">size_t</span> <span class="pre">asd_struct_size</span></code></dt>
<dd>size of the driver&#8217;s async sub-device struct, including
sizeof(struct v4l2_async_subdev). The <a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_subdev" title="v4l2_async_subdev"><code class="xref c c-type docutils literal"><span class="pre">struct</span>
<span class="pre">v4l2_async_subdev</span></code></a> shall be the first member of
the driver&#8217;s async sub-device struct, i.e. both
begin at the same memory address.</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">port</span></code></dt>
<dd>port number where endpoints are to be parsed</dd>
<dt><code class="docutils literal"><span class="pre">parse_endpoint_func</span> <span class="pre">parse_endpoint</span></code></dt>
<dd>Driver&#8217;s callback function called on each V4L2 fwnode
endpoint. Optional.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is just like <a class="reference internal" href="#c.v4l2_async_notifier_parse_fwnode_endpoints" title="v4l2_async_notifier_parse_fwnode_endpoints"><code class="xref c c-func docutils literal"><span class="pre">v4l2_async_notifier_parse_fwnode_endpoints()</span></code></a> with
the exception that it only parses endpoints in a given port. This is useful
on devices that have both sinks and sources: the async sub-devices connected
to sources have already been configured by another driver (on capture
devices). In this case the driver must know which ports to parse.</p>
<p>Parse the fwnode endpoints of the <strong>dev</strong> device on a given <strong>port</strong> and populate
the async sub-devices array of the notifier. The <strong>parse_endpoint</strong> callback
function is called for each endpoint with the corresponding async sub-device
pointer to let the caller initialize the driver-specific part of the async
sub-device structure.</p>
<p>The notifier memory shall be zeroed before this function is called on the
notifier the first time.</p>
<p>This function may not be called on a registered notifier and may be called on
a notifier only once per port.</p>
<p>Do not change the notifier&#8217;s subdevs array, take references to the subdevs
array itself or change the notifier&#8217;s num_subdevs field. This is because this
function allocates and reallocates the subdevs array based on parsing
endpoints.</p>
<p>The <a class="reference internal" href="#c.v4l2_fwnode_endpoint" title="v4l2_fwnode_endpoint"><code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_fwnode_endpoint</span></code></a> passed to the callback function
<strong>parse_endpoint</strong> is released once the function is finished. If there is a need
to retain that configuration, the user needs to allocate memory for it.</p>
<p>Any notifier populated using this function must be released with a call to
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_notifier_cleanup" title="v4l2_async_notifier_cleanup"><code class="xref c c-func docutils literal"><span class="pre">v4l2_async_notifier_cleanup()</span></code></a> after it has been unregistered and the async
sub-devices are no longer in use, even if the function returned an error.</p>
<p><strong>Return</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">0</span></code> on success, including when no async sub-devices are found</dt>
<dd><code class="docutils literal"><span class="pre">-ENOMEM</span></code> if memory allocation failed
<code class="docutils literal"><span class="pre">-EINVAL</span></code> if graph or endpoint parsing failed
Other error codes as returned by <strong>parse_endpoint</strong></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_async_notifier_parse_fwnode_sensor_common">
int <code class="descname">v4l2_async_notifier_parse_fwnode_sensor_common</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device">device</a> *<em>&nbsp;dev</em>, struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_async_notifier" title="v4l2_async_notifier">v4l2_async_notifier</a> *<em>&nbsp;notifier</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_async_notifier_parse_fwnode_sensor_common" title="Permalink to this definition">¶</a></dt>
<dd><p>parse common references on sensors for async sub-devices</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>the device node the properties of which are parsed for references</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">v4l2_async_notifier</span> <span class="pre">*</span> <span class="pre">notifier</span></code></dt>
<dd>the async notifier where the async subdevs will be added</dd>
</dl>
<p><strong>Description</strong></p>
<p>Parse common sensor properties for remote devices related to the
sensor and set up async sub-devices for them.</p>
<p>Any notifier populated using this function must be released with a call to
<code class="xref c c-func docutils literal"><span class="pre">v4l2_async_notifier_release()</span></code> after it has been unregistered and the async
sub-devices are no longer in use, even in the case the function returned an
error.</p>
<p><strong>Return</strong></p>
<dl class="docutils">
<dt>0 on success</dt>
<dd>-ENOMEM if memory allocation failed
-EINVAL if property parsing failed</dd>
</dl>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="v4l2-rect.html" class="btn btn-neutral float-right" title="1.23. V4L2 rect helper functions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="v4l2-async.html" class="btn btn-neutral" title="1.21. V4L2 async kAPI" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>