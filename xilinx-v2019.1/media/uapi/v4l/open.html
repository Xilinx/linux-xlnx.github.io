

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.1. Opening and Closing Devices &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../../../index.html"/>
        <link rel="up" title="1. Common API Elements" href="common.html"/>
        <link rel="next" title="1.2. Querying Capabilities" href="querycap.html"/>
        <link rel="prev" title="1. Common API Elements" href="common.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../media_uapi.html">Linux Media Infrastructure userspace API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="v4l2.html">Part I - Video for Linux API</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="common.html">1. Common API Elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="pixfmt.html">2. Image Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html">3. Input/Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="devices.html">4. Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="libv4l.html">5. Libv4l Userspace Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="compat.html">6. Changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="user-func.html">7. Function Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-defs.html">8. Common definitions for V4L2 and V4L2 subdev interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="videodev.html">9. Video For Linux Two Header File</a></li>
<li class="toctree-l4"><a class="reference internal" href="capture-example.html">10. Video Capture Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2grab-example.html">11. Video Grabber example using libv4l</a></li>
<li class="toctree-l4"><a class="reference internal" href="biblio.html">12. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2.html#revision-and-copyright">Revision and Copyright</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2.html#revision-history">Revision History</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dvb/dvbapi.html">Part II - Digital TV API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rc/remote_controllers.html">Part III - Remote Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mediactl/media-controller.html">Part IV - Media Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cec/cec-api.html">Part V - Consumer Electronics Control API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gen-errors.html">Generic Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fdl-appendix.html">GNU Free Documentation License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
      
          <li><a href="../../media_uapi.html">Linux Media Infrastructure userspace API</a> &raquo;</li>
      
          <li><a href="v4l2.html">Part I - Video for Linux API</a> &raquo;</li>
      
          <li><a href="common.html">1. Common API Elements</a> &raquo;</li>
      
    <li>1.1. Opening and Closing Devices</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/media/uapi/v4l/open.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="opening-and-closing-devices">
<span id="open"></span><h1>1.1. Opening and Closing Devices<a class="headerlink" href="#opening-and-closing-devices" title="Permalink to this headline">¶</a></h1>
<div class="section" id="device-naming">
<h2>1.1.1. Device Naming<a class="headerlink" href="#device-naming" title="Permalink to this headline">¶</a></h2>
<p>V4L2 drivers are implemented as kernel modules, loaded manually by the
system administrator or automatically when a device is first discovered.
The driver modules plug into the &#8220;videodev&#8221; kernel module. It provides
helper functions and a common application interface specified in this
document.</p>
<p>Each driver thus loaded registers one or more device nodes with major
number 81 and a minor number between 0 and 255. Minor numbers are
allocated dynamically unless the kernel is compiled with the kernel
option CONFIG_VIDEO_FIXED_MINOR_RANGES. In that case minor numbers
are allocated in ranges depending on the device node type (video, radio,
etc.).</p>
<p>Many drivers support &#8220;video_nr&#8221;, &#8220;radio_nr&#8221; or &#8220;vbi_nr&#8221; module
options to select specific video/radio/vbi node numbers. This allows the
user to request that the device node is named e.g. /dev/video5 instead
of leaving it to chance. When the driver supports multiple devices of
the same type more than one device node number can be assigned,
separated by commas:</p>
<div class="highlight-none"><div class="highlight"><pre># modprobe mydriver video_nr=0,1 radio_nr=0,1
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">/etc/modules.conf</span></code> this may be written as:</p>
<div class="highlight-none"><div class="highlight"><pre>options mydriver video_nr=0,1 radio_nr=0,1
</pre></div>
</div>
<p>When no device node number is given as module option the driver supplies
a default.</p>
<p>Normally udev will create the device nodes in /dev automatically for
you. If udev is not installed, then you need to enable the
CONFIG_VIDEO_FIXED_MINOR_RANGES kernel option in order to be able to
correctly relate a minor number to a device node number. I.e., you need
to be certain that minor number 5 maps to device node name video5. With
this kernel option different device types have different minor number
ranges. These ranges are listed in <a class="reference internal" href="devices.html#devices"><span>Interfaces</span></a>.</p>
<p>The creation of character special files (with mknod) is a privileged
operation and devices cannot be opened by major and minor number. That
means applications cannot <em>reliable</em> scan for loaded or installed
drivers. The user must enter a device name, or the application can try
the conventional device names.</p>
</div>
<div class="section" id="related-devices">
<span id="related"></span><h2>1.1.2. Related Devices<a class="headerlink" href="#related-devices" title="Permalink to this headline">¶</a></h2>
<p>Devices can support several functions. For example video capturing, VBI
capturing and radio support.</p>
<p>The V4L2 API creates different nodes for each of these functions.</p>
<p>The V4L2 API was designed with the idea that one device node could
support all functions. However, in practice this never worked: this
&#8216;feature&#8217; was never used by applications and many drivers did not
support it and if they did it was certainly never tested. In addition,
switching a device node between different functions only works when
using the streaming I/O API, not with the
<a class="reference internal" href="func-read.html#func-read"><span>read()</span></a>/<a class="reference internal" href="func-write.html#func-write"><span>write()</span></a> API.</p>
<p>Today each device node supports just one function.</p>
<p>Besides video input or output the hardware may also support audio
sampling or playback. If so, these functions are implemented as ALSA PCM
devices with optional ALSA audio mixer devices.</p>
<p>One problem with all these devices is that the V4L2 API makes no
provisions to find these related devices. Some really complex devices
use the Media Controller (see <a class="reference internal" href="../mediactl/media-controller.html#media-controller"><span>Part IV - Media Controller API</span></a>) which can be
used for this purpose. But most drivers do not use it, and while some
code exists that uses sysfs to discover related devices (see
libmedia_dev in the
<a class="reference external" href="http://git.linuxtv.org/cgit.cgi/v4l-utils.git/">v4l-utils</a> git
repository), there is no library yet that can provide a single API
towards both Media Controller-based devices and devices that do not use
the Media Controller. If you want to work on this please write to the
linux-media mailing list:
<a class="reference external" href="https://linuxtv.org/lists.php">https://linuxtv.org/lists.php</a>.</p>
</div>
<div class="section" id="multiple-opens">
<h2>1.1.3. Multiple Opens<a class="headerlink" href="#multiple-opens" title="Permalink to this headline">¶</a></h2>
<p>V4L2 devices can be opened more than once. <a class="footnote-reference" href="#f1" id="id1">[1]</a> When this is supported
by the driver, users can for example start a &#8220;panel&#8221; application to
change controls like brightness or audio volume, while another
application captures video and audio. In other words, panel applications
are comparable to an ALSA audio mixer application. Just opening a V4L2
device should not change the state of the device. <a class="footnote-reference" href="#f2" id="id2">[2]</a></p>
<p>Once an application has allocated the memory buffers needed for
streaming data (by calling the <a class="reference internal" href="vidioc-reqbufs.html#vidioc-reqbufs"><span>ioctl VIDIOC_REQBUFS</span></a>
or <a class="reference internal" href="vidioc-create-bufs.html#vidioc-create-bufs"><span>ioctl VIDIOC_CREATE_BUFS</span></a> ioctls, or
implicitly by calling the <a class="reference internal" href="func-read.html#func-read"><span>read()</span></a> or
<a class="reference internal" href="func-write.html#func-write"><span>write()</span></a> functions) that application (filehandle)
becomes the owner of the device. It is no longer allowed to make changes
that would affect the buffer sizes (e.g. by calling the
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span>VIDIOC_S_FMT</span></a> ioctl) and other applications are
no longer allowed to allocate buffers or start or stop streaming. The
EBUSY error code will be returned instead.</p>
<p>Merely opening a V4L2 device does not grant exclusive access. <a class="footnote-reference" href="#f3" id="id3">[3]</a>
Initiating data exchange however assigns the right to read or write the
requested type of data, and to change related properties, to this file
descriptor. Applications can request additional access privileges using
the priority mechanism described in <a class="reference internal" href="app-pri.html#app-pri"><span>Application Priority</span></a>.</p>
</div>
<div class="section" id="shared-data-streams">
<h2>1.1.4. Shared Data Streams<a class="headerlink" href="#shared-data-streams" title="Permalink to this headline">¶</a></h2>
<p>V4L2 drivers should not support multiple applications reading or writing
the same data stream on a device by copying buffers, time multiplexing
or similar means. This is better handled by a proxy application in user
space.</p>
</div>
<div class="section" id="functions">
<h2>1.1.5. Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>To open and close V4L2 devices applications use the
<a class="reference internal" href="func-open.html#func-open"><span>open()</span></a> and <a class="reference internal" href="func-close.html#func-close"><span>close()</span></a> function,
respectively. Devices are programmed using the
<a class="reference internal" href="func-ioctl.html#func-ioctl"><span>ioctl()</span></a> function as explained in the following
sections.</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>There are still some old and obscure drivers that have not been
updated to allow for multiple opens. This implies that for such
drivers <a class="reference internal" href="func-open.html#func-open"><span>open()</span></a> can return an <code class="docutils literal"><span class="pre">EBUSY</span></code> error code
when the device is already in use.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Unfortunately, opening a radio device often switches the state of the
device to radio mode in many drivers. This behavior should be fixed
eventually as it violates the V4L2 specification.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Drivers could recognize the <code class="docutils literal"><span class="pre">O_EXCL</span></code> open flag. Presently this is
not required, so applications cannot know if it really works.</td></tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="querycap.html" class="btn btn-neutral float-right" title="1.2. Querying Capabilities" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="common.html" class="btn btn-neutral" title="1. Common API Elements" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>