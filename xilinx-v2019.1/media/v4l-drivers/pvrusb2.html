

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>22. The pvrusb2 driver &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../../index.html"/>
        <link rel="up" title="Video4Linux (V4L) driver-specific documentation" href="index.html"/>
        <link rel="next" title="23. PXA-Camera Host Driver" href="pxa_camera.html"/>
        <link rel="prev" title="21. Philips webcams (pwc driver)" href="philips.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Video4Linux (V4L)  driver-specific documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fourcc.html">1. Guidelines for Video4Linux pixel format 4CCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html">2. Infrared remote control support in video4linux drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-with-lircd">3. Using with lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-without-lircd">4. Using without lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="tuners.html">5. Tuner drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cardlist.html">6. Cards List</a></li>
<li class="toctree-l3"><a class="reference internal" href="bttv.html">7. The bttv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cafe_ccic.html">8. The cafe_ccic driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpia2.html">9. The cpia2 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx18.html">10. The cx18 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx2341x.html">11. The cx2341x driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx88.html">12. The cx88 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="davinci-vpbe.html">13. The VPBE V4L2 driver design</a></li>
<li class="toctree-l3"><a class="reference internal" href="fimc.html">14. The Samsung S5P/EXYNOS4 FIMC driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="imx.html">15. i.MX Video Capture Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ivtv.html">16. The ivtv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="max2175.html">17. Maxim Integrated MAX2175 RF to bits tuner driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="meye.html">18. Vaio Picturebook Motion Eye Camera Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="omap3isp.html">19. OMAP 3 Image Signal Processor (ISP) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="omap4_camera.html">20. OMAP4 ISS Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="philips.html">21. Philips webcams (pwc driver)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">22. The pvrusb2 driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#background">22.1. Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building">22.2. Building</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-file-list-functional-overview">22.3. Source file list / functional overview</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pxa_camera.html">23. PXA-Camera Host Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="qcom_camss.html">24. Qualcomm Camera Subsystem driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="radiotrack.html">25. The Radiotrack radio driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="rcar-fdp1.html">26. Renesas R-Car Fine Display Processor (FDP1) Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="saa7134.html">27. The saa7134 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sh_mobile_ceu_camera.html">28. Cropping and Scaling algorithm, used in the sh_mobile_ceu_camera driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si470x.html">29. The Silicon Labs Si470x FM Radio Receivers driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si4713.html">30. The Silicon Labs Si4713 FM Radio Transmitter Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si476x.html">31. The SI476x Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="soc-camera.html">32. The Soc-Camera Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="uvcvideo.html">33. The Linux USB Video Class (UVC) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="vivid.html">34. The Virtual Video Test Driver (vivid)</a></li>
<li class="toctree-l3"><a class="reference internal" href="zoran.html">35. The Zoran driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="zr364xx.html">36. Zoran 364xx based USB webcam module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
      
          <li><a href="index.html">Video4Linux (V4L)  driver-specific documentation</a> &raquo;</li>
      
    <li>22. The pvrusb2 driver</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/media/v4l-drivers/pvrusb2.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-pvrusb2-driver">
<h1>22. The pvrusb2 driver<a class="headerlink" href="#the-pvrusb2-driver" title="Permalink to this headline">¶</a></h1>
<p>Author: Mike Isely &lt;<a class="reference external" href="mailto:isely&#37;&#52;&#48;pobox&#46;com">isely<span>&#64;</span>pobox<span>&#46;</span>com</a>&gt;</p>
<div class="section" id="background">
<h2>22.1. Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>This driver is intended for the &#8220;Hauppauge WinTV PVR USB 2.0&#8221;, which
is a USB 2.0 hosted TV Tuner.  This driver is a work in progress.
Its history started with the reverse-engineering effort by Björn
Danielsson &lt;<a class="reference external" href="mailto:pvrusb2&#37;&#52;&#48;dax&#46;nu">pvrusb2<span>&#64;</span>dax<span>&#46;</span>nu</a>&gt; whose web page can be found here:
<a class="reference external" href="http://pvrusb2.dax.nu/">http://pvrusb2.dax.nu/</a></p>
<p>From there Aurelien Alleaume &lt;<a class="reference external" href="mailto:slts&#37;&#52;&#48;free&#46;fr">slts<span>&#64;</span>free<span>&#46;</span>fr</a>&gt; began an effort to
create a video4linux compatible driver.  I began with Aurelien&#8217;s
last known snapshot and evolved the driver to the state it is in
here.</p>
<p>More information on this driver can be found at:
<a class="reference external" href="http://www.isely.net/pvrusb2.html">http://www.isely.net/pvrusb2.html</a></p>
<p>This driver has a strong separation of layers.  They are very
roughly:</p>
<ol class="arabic simple">
<li>Low level wire-protocol implementation with the device.</li>
<li>I2C adaptor implementation and corresponding I2C client drivers
implemented elsewhere in V4L.</li>
<li>High level hardware driver implementation which coordinates all
activities that ensure correct operation of the device.</li>
<li>A &#8220;context&#8221; layer which manages instancing of driver, setup,
tear-down, arbitration, and interaction with high level
interfaces appropriately as devices are hotplugged in the
system.</li>
<li>High level interfaces which glue the driver to various published
Linux APIs (V4L, sysfs, maybe DVB in the future).</li>
</ol>
<p>The most important shearing layer is between the top 2 layers.  A
lot of work went into the driver to ensure that any kind of
conceivable API can be laid on top of the core driver.  (Yes, the
driver internally leverages V4L to do its work but that really has
nothing to do with the API published by the driver to the outside
world.)  The architecture allows for different APIs to
simultaneously access the driver.  I have a strong sense of fairness
about APIs and also feel that it is a good design principle to keep
implementation and interface isolated from each other.  Thus while
right now the V4L high level interface is the most complete, the
sysfs high level interface will work equally well for similar
functions, and there&#8217;s no reason I see right now why it shouldn&#8217;t be
possible to produce a DVB high level interface that can sit right
alongside V4L.</p>
</div>
<div class="section" id="building">
<h2>22.2. Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h2>
<p>To build these modules essentially amounts to just running &#8220;Make&#8221;,
but you need the kernel source tree nearby and you will likely also
want to set a few controlling environment variables first in order
to link things up with that source tree.  Please see the Makefile
here for comments that explain how to do that.</p>
</div>
<div class="section" id="source-file-list-functional-overview">
<h2>22.3. Source file list / functional overview<a class="headerlink" href="#source-file-list-functional-overview" title="Permalink to this headline">¶</a></h2>
<p>(Note: The term &#8220;module&#8221; used below generally refers to loosely
defined functional units within the pvrusb2 driver and bears no
relation to the Linux kernel&#8217;s concept of a loadable module.)</p>
<dl class="docutils">
<dt>pvrusb2-audio.[ch] - This is glue logic that resides between this</dt>
<dd>driver and the msp3400.ko I2C client driver (which is found
elsewhere in V4L).</dd>
<dt>pvrusb2-context.[ch] - This module implements the context for an</dt>
<dd>instance of the driver.  Everything else eventually ties back to
or is otherwise instanced within the data structures implemented
here.  Hotplugging is ultimately coordinated here.  All high level
interfaces tie into the driver through this module.  This module
helps arbitrate each interface&#8217;s access to the actual driver core,
and is designed to allow concurrent access through multiple
instances of multiple interfaces (thus you can for example change
the tuner&#8217;s frequency through sysfs while simultaneously streaming
video through V4L out to an instance of mplayer).</dd>
<dt>pvrusb2-debug.h - This header defines a printk() wrapper and a mask</dt>
<dd>of debugging bit definitions for the various kinds of debug
messages that can be enabled within the driver.</dd>
<dt>pvrusb2-debugifc.[ch] - This module implements a crude command line</dt>
<dd>oriented debug interface into the driver.  Aside from being part
of the process for implementing manual firmware extraction (see
the pvrusb2 web site mentioned earlier), probably I&#8217;m the only one
who has ever used this.  It is mainly a debugging aid.</dd>
<dt>pvrusb2-eeprom.[ch] - This is glue logic that resides between this</dt>
<dd>driver the tveeprom.ko module, which is itself implemented
elsewhere in V4L.</dd>
<dt>pvrusb2-encoder.[ch] - This module implements all protocol needed to</dt>
<dd>interact with the Conexant mpeg2 encoder chip within the pvrusb2
device.  It is a crude echo of corresponding logic in ivtv,
however the design goals (strict isolation) and physical layer
(proxy through USB instead of PCI) are enough different that this
implementation had to be completely different.</dd>
<dt>pvrusb2-hdw-internal.h - This header defines the core data structure</dt>
<dd>in the driver used to track ALL internal state related to control
of the hardware.  Nobody outside of the core hardware-handling
modules should have any business using this header.  All external
access to the driver should be through one of the high level
interfaces (e.g. V4L, sysfs, etc), and in fact even those high
level interfaces are restricted to the API defined in
pvrusb2-hdw.h and NOT this header.</dd>
<dt>pvrusb2-hdw.h - This header defines the full internal API for</dt>
<dd>controlling the hardware.  High level interfaces (e.g. V4L, sysfs)
will work through here.</dd>
<dt>pvrusb2-hdw.c - This module implements all the various bits of logic</dt>
<dd>that handle overall control of a specific pvrusb2 device.
(Policy, instantiation, and arbitration of pvrusb2 devices fall
within the jurisdiction of pvrusb-context not here).</dd>
<dt>pvrusb2-i2c-chips-*.c - These modules implement the glue logic to</dt>
<dd>tie together and configure various I2C modules as they attach to
the I2C bus.  There are two versions of this file.  The &#8220;v4l2&#8221;
version is intended to be used in-tree alongside V4L, where we
implement just the logic that makes sense for a pure V4L
environment.  The &#8220;all&#8221; version is intended for use outside of
V4L, where we might encounter other possibly &#8220;challenging&#8221; modules
from ivtv or older kernel snapshots (or even the support modules
in the standalone snapshot).</dd>
<dt>pvrusb2-i2c-cmd-v4l1.[ch] - This module implements generic V4L1</dt>
<dd>compatible commands to the I2C modules.  It is here where state
changes inside the pvrusb2 driver are translated into V4L1
commands that are in turn send to the various I2C modules.</dd>
<dt>pvrusb2-i2c-cmd-v4l2.[ch] - This module implements generic V4L2</dt>
<dd>compatible commands to the I2C modules.  It is here where state
changes inside the pvrusb2 driver are translated into V4L2
commands that are in turn send to the various I2C modules.</dd>
<dt>pvrusb2-i2c-core.[ch] - This module provides an implementation of a</dt>
<dd>kernel-friendly I2C adaptor driver, through which other external
I2C client drivers (e.g. msp3400, tuner, lirc) may connect and
operate corresponding chips within the pvrusb2 device.  It is
through here that other V4L modules can reach into this driver to
operate specific pieces (and those modules are in turn driven by
glue logic which is coordinated by pvrusb2-hdw, doled out by
pvrusb2-context, and then ultimately made available to users
through one of the high level interfaces).</dd>
<dt>pvrusb2-io.[ch] - This module implements a very low level ring of</dt>
<dd>transfer buffers, required in order to stream data from the
device.  This module is <em>very</em> low level.  It only operates the
buffers and makes no attempt to define any policy or mechanism for
how such buffers might be used.</dd>
<dt>pvrusb2-ioread.[ch] - This module layers on top of pvrusb2-io.[ch]</dt>
<dd>to provide a streaming API usable by a read() system call style of
I/O.  Right now this is the only layer on top of pvrusb2-io.[ch],
however the underlying architecture here was intended to allow for
other styles of I/O to be implemented with additional modules, like
mmap()&#8217;ed buffers or something even more exotic.</dd>
<dt>pvrusb2-main.c - This is the top level of the driver.  Module level</dt>
<dd>and USB core entry points are here.  This is our &#8220;main&#8221;.</dd>
<dt>pvrusb2-sysfs.[ch] - This is the high level interface which ties the</dt>
<dd>pvrusb2 driver into sysfs.  Through this interface you can do
everything with the driver except actually stream data.</dd>
<dt>pvrusb2-tuner.[ch] - This is glue logic that resides between this</dt>
<dd>driver and the tuner.ko I2C client driver (which is found
elsewhere in V4L).</dd>
<dt>pvrusb2-util.h - This header defines some common macros used</dt>
<dd>throughout the driver.  These macros are not really specific to
the driver, but they had to go somewhere.</dd>
<dt>pvrusb2-v4l2.[ch] - This is the high level interface which ties the</dt>
<dd>pvrusb2 driver into video4linux.  It is through here that V4L
applications can open and operate the driver in the usual V4L
ways.  Note that <strong>ALL</strong> V4L functionality is published only
through here and nowhere else.</dd>
<dt>pvrusb2-video-*.[ch] - This is glue logic that resides between this</dt>
<dd>driver and the saa711x.ko I2C client driver (which is found
elsewhere in V4L).  Note that saa711x.ko used to be known as
saa7115.ko in ivtv.  There are two versions of this; one is
selected depending on the particular saa711[5x].ko that is found.</dd>
<dt>pvrusb2.h - This header contains compile time tunable parameters</dt>
<dd>(and at the moment the driver has very little that needs to be
tuned).</dd>
</dl>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pxa_camera.html" class="btn btn-neutral float-right" title="23. PXA-Camera Host Driver" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="philips.html" class="btn btn-neutral" title="21. Philips webcams (pwc driver)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>