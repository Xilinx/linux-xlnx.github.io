

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. The userio Protocol &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html"/>
        <link rel="up" title="Linux Input Subsystem userspace API" href="input_uapi.html"/>
        <link rel="next" title="Linux Input Subsystem kernel API" href="input_kapi.html"/>
        <link rel="prev" title="7. uinput module" href="uinput.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Linux Input Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="input_uapi.html">Linux Input Subsystem userspace API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="input.html">1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="event-codes.html">2. Input event codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="multi-touch-protocol.html">3. Multi-touch (MT) Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="gamepad.html">4. Linux Gamepad Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="ff.html">5. Force feedback for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="joydev/index.html">6. Linux Joystick support</a></li>
<li class="toctree-l3"><a class="reference internal" href="uinput.html">7. uinput module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">8. The userio Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">8.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-overview">8.2. Usage overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#command-structure">8.3. Command Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commands">8.4. Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#userspace-tools">8.5. Userspace tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="input_kapi.html">Linux Input Subsystem kernel API</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices/index.html">Driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">The Linux Input Documentation</a> &raquo;</li>
      
          <li><a href="input_uapi.html">Linux Input Subsystem userspace API</a> &raquo;</li>
      
    <li>8. The userio Protocol</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/input/userio.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-userio-protocol">
<h1>8. The userio Protocol<a class="headerlink" href="#the-userio-protocol" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Copyright:</th><td class="field-body">© 2015 Stephen Chandler Paul &lt;<a class="reference external" href="mailto:thatslyude&#37;&#52;&#48;gmail&#46;com">thatslyude<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</td>
</tr>
</tbody>
</table>
<p>Sponsored by Red Hat</p>
<div class="section" id="introduction">
<h2>8.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This module is intended to try to make the lives of input driver developers
easier by allowing them to test various serio devices (mainly the various
touchpads found on laptops) without having to have the physical device in front
of them. userio accomplishes this by allowing any privileged userspace program
to directly interact with the kernel&#8217;s serio driver and control a virtual serio
port from there.</p>
</div>
<div class="section" id="usage-overview">
<h2>8.2. Usage overview<a class="headerlink" href="#usage-overview" title="Permalink to this headline">¶</a></h2>
<p>In order to interact with the userio kernel module, one simply opens the
/dev/userio character device in their applications. Commands are sent to the
kernel module by writing to the device, and any data received from the serio
driver is read as-is from the /dev/userio device. All of the structures and
macros you need to interact with the device are defined in &lt;linux/userio.h&gt; and
&lt;linux/serio.h&gt;.</p>
</div>
<div class="section" id="command-structure">
<h2>8.3. Command Structure<a class="headerlink" href="#command-structure" title="Permalink to this headline">¶</a></h2>
<p>The struct used for sending commands to /dev/userio is as follows:</p>
<div class="highlight-none"><div class="highlight"><pre>struct userio_cmd {
        __u8 type;
        __u8 data;
};
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">type</span></code> describes the type of command that is being sent. This can be any one
of the USERIO_CMD macros defined in &lt;linux/userio.h&gt;. <code class="docutils literal"><span class="pre">data</span></code> is the argument
that goes along with the command. In the event that the command doesn&#8217;t have an
argument, this field can be left untouched and will be ignored by the kernel.
Each command should be sent by writing the struct directly to the character
device. In the event that the command you send is invalid, an error will be
returned by the character device and a more descriptive error will be printed
to the kernel log. Only one command can be sent at a time, any additional data
written to the character device after the initial command will be ignored.</p>
<p>To close the virtual serio port, just close /dev/userio.</p>
</div>
<div class="section" id="commands">
<h2>8.4. Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="userio-cmd-register">
<h3>8.4.1. USERIO_CMD_REGISTER<a class="headerlink" href="#userio-cmd-register" title="Permalink to this headline">¶</a></h3>
<p>Registers the port with the serio driver and begins transmitting data back and
forth. Registration can only be performed once a port type is set with
USERIO_CMD_SET_PORT_TYPE. Has no argument.</p>
</div>
<div class="section" id="userio-cmd-set-port-type">
<h3>8.4.2. USERIO_CMD_SET_PORT_TYPE<a class="headerlink" href="#userio-cmd-set-port-type" title="Permalink to this headline">¶</a></h3>
<p>Sets the type of port we&#8217;re emulating, where <code class="docutils literal"><span class="pre">data</span></code> is the port type being
set. Can be any of the macros from &lt;linux/serio.h&gt;. For example: SERIO_8042
would set the port type to be a normal PS/2 port.</p>
</div>
<div class="section" id="userio-cmd-send-interrupt">
<h3>8.4.3. USERIO_CMD_SEND_INTERRUPT<a class="headerlink" href="#userio-cmd-send-interrupt" title="Permalink to this headline">¶</a></h3>
<p>Sends an interrupt through the virtual serio port to the serio driver, where
<code class="docutils literal"><span class="pre">data</span></code> is the interrupt data being sent.</p>
</div>
</div>
<div class="section" id="userspace-tools">
<h2>8.5. Userspace tools<a class="headerlink" href="#userspace-tools" title="Permalink to this headline">¶</a></h2>
<p>The userio userspace tools are able to record PS/2 devices using some of the
debugging information from i8042, and play back the devices on /dev/userio. The
latest version of these tools can be found at:</p>
<blockquote>
<div><a class="reference external" href="https://github.com/Lyude/ps2emu">https://github.com/Lyude/ps2emu</a></div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="input_kapi.html" class="btn btn-neutral float-right" title="Linux Input Subsystem kernel API" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="uinput.html" class="btn btn-neutral" title="7. uinput module" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>