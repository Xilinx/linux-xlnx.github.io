

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Key-agreement Protocol Primitives (KPP) Cipher Algorithm Definitions &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html"/>
        <link rel="up" title="Programming Interface" href="api.html"/>
        <link rel="next" title="Code Examples" href="api-samples.html"/>
        <link rel="prev" title="Asymmetric Cipher Algorithm Definitions" href="api-akcipher.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux Kernel Crypto API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Kernel Crypto API Interface Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Kernel Crypto API Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="devel-algos.html">Developing Cipher Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="userspace-if.html">User Space Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="crypto_engine.html">CRYPTO ENGINE</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="api.html">Programming Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="api-skcipher.html">Block Cipher Algorithm Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-skcipher.html#symmetric-key-cipher-api">Symmetric Key Cipher API</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-skcipher.html#symmetric-key-cipher-request-handle">Symmetric Key Cipher Request Handle</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-skcipher.html#single-block-cipher-api">Single Block Cipher API</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-skcipher.html#asynchronous-block-cipher-api-deprecated">Asynchronous Block Cipher API - Deprecated</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-skcipher.html#asynchronous-cipher-request-handle-deprecated">Asynchronous Cipher Request Handle - Deprecated</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-skcipher.html#synchronous-block-cipher-api-deprecated">Synchronous Block Cipher API - Deprecated</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-aead.html">Authenticated Encryption With Associated Data (AEAD) Algorithm Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-aead.html#authenticated-encryption-with-associated-data-aead-cipher-api">Authenticated Encryption With Associated Data (AEAD) Cipher API</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-aead.html#asynchronous-aead-request-handle">Asynchronous AEAD Request Handle</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-digest.html">Message Digest Algorithm Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-digest.html#asynchronous-message-digest-api">Asynchronous Message Digest API</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-digest.html#asynchronous-hash-request-handle">Asynchronous Hash Request Handle</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-digest.html#synchronous-message-digest-api">Synchronous Message Digest API</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-rng.html">Random Number Algorithm Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-rng.html#crypto-api-random-number-api">Crypto API Random Number API</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-akcipher.html">Asymmetric Cipher Algorithm Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-akcipher.html#asymmetric-cipher-api">Asymmetric Cipher API</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-akcipher.html#asymmetric-cipher-request-handle">Asymmetric Cipher Request Handle</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Key-agreement Protocol Primitives (KPP) Cipher Algorithm Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-agreement-protocol-primitives-kpp-cipher-api">Key-agreement Protocol Primitives (KPP) Cipher API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-agreement-protocol-primitives-kpp-cipher-request-handle">Key-agreement Protocol Primitives (KPP) Cipher Request Handle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ecdh-helper-functions">ECDH Helper Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dh-helper-functions">DH Helper Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-samples.html">Code Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Linux Kernel Crypto API</a> &raquo;</li>
      
          <li><a href="api.html">Programming Interface</a> &raquo;</li>
      
    <li>Key-agreement Protocol Primitives (KPP) Cipher Algorithm Definitions</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/crypto/api-kpp.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="key-agreement-protocol-primitives-kpp-cipher-algorithm-definitions">
<h1>Key-agreement Protocol Primitives (KPP) Cipher Algorithm Definitions<a class="headerlink" href="#key-agreement-protocol-primitives-kpp-cipher-algorithm-definitions" title="Permalink to this headline">¶</a></h1>
<dl class="type">
<dt id="c.kpp_request">
struct <code class="descname">kpp_request</code><a class="headerlink" href="#c.kpp_request" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct kpp_request {
  struct crypto_async_request base;
  struct scatterlist *src;
  struct scatterlist *dst;
  unsigned int src_len;
  unsigned int dst_len;
  void *__ctx[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">base</span></code></dt>
<dd>Common attributes for async crypto requests</dd>
<dt><code class="docutils literal"><span class="pre">src</span></code></dt>
<dd>Source data</dd>
<dt><code class="docutils literal"><span class="pre">dst</span></code></dt>
<dd>Destination data</dd>
<dt><code class="docutils literal"><span class="pre">src_len</span></code></dt>
<dd>Size of the input buffer</dd>
<dt><code class="docutils literal"><span class="pre">dst_len</span></code></dt>
<dd>Size of the output buffer. It needs to be at least
as big as the expected result depending on the operation
After operation it will be updated with the actual size of the
result. In case of error where the dst sgl size was insufficient,
it will be updated to the size required for the operation.</dd>
<dt><code class="docutils literal"><span class="pre">__ctx</span></code></dt>
<dd>Start of private context data</dd>
</dl>
<dl class="type">
<dt id="c.crypto_kpp">
struct <code class="descname">crypto_kpp</code><a class="headerlink" href="#c.crypto_kpp" title="Permalink to this definition">¶</a></dt>
<dd><p>user-instantiated object which encapsulate algorithms and core processing logic</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct crypto_kpp {
  struct crypto_tfm base;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">base</span></code></dt>
<dd>Common crypto API algorithm data structure</dd>
</dl>
<dl class="type">
<dt id="c.kpp_alg">
struct <code class="descname">kpp_alg</code><a class="headerlink" href="#c.kpp_alg" title="Permalink to this definition">¶</a></dt>
<dd><p>generic key-agreement protocol primitives</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct kpp_alg {
  int (*set_secret)(struct crypto_kpp *tfm, const void *buffer, unsigned int len);
  int (*generate_public_key)(struct kpp_request *req);
  int (*compute_shared_secret)(struct kpp_request *req);
  unsigned int (*max_size)(struct crypto_kpp *tfm);
  int (*init)(struct crypto_kpp *tfm);
  void (*exit)(struct crypto_kpp *tfm);
  unsigned int reqsize;
  struct crypto_alg base;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">set_secret</span></code></dt>
<dd>Function invokes the protocol specific function to
store the secret private key along with parameters.
The implementation knows how to decode the buffer</dd>
<dt><code class="docutils literal"><span class="pre">generate_public_key</span></code></dt>
<dd>Function generate the public key to be sent to the
counterpart. In case of error, where output is not big
enough req-&gt;dst_len will be updated to the size
required</dd>
<dt><code class="docutils literal"><span class="pre">compute_shared_secret</span></code></dt>
<dd>Function compute the shared secret as defined by
the algorithm. The result is given back to the user.
In case of error, where output is not big enough,
req-&gt;dst_len will be updated to the size required</dd>
<dt><code class="docutils literal"><span class="pre">max_size</span></code></dt>
<dd>Function returns the size of the output buffer</dd>
<dt><code class="docutils literal"><span class="pre">init</span></code></dt>
<dd>Initialize the object. This is called only once at
instantiation time. In case the cryptographic hardware
needs to be initialized. Software fallback should be
put in place here.</dd>
<dt><code class="docutils literal"><span class="pre">exit</span></code></dt>
<dd>Undo everything <strong>init</strong> did.</dd>
<dt><code class="docutils literal"><span class="pre">reqsize</span></code></dt>
<dd>Request context size required by algorithm
implementation</dd>
<dt><code class="docutils literal"><span class="pre">base</span></code></dt>
<dd>Common crypto API algorithm data structure</dd>
</dl>
<dl class="type">
<dt id="c.kpp_secret">
struct <code class="descname">kpp_secret</code><a class="headerlink" href="#c.kpp_secret" title="Permalink to this definition">¶</a></dt>
<dd><p>small header for packing secret buffer</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct kpp_secret {
  unsigned short type;
  unsigned short len;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">type</span></code></dt>
<dd>define type of secret. Each kpp type will define its own</dd>
<dt><code class="docutils literal"><span class="pre">len</span></code></dt>
<dd>specify the len of the secret, include the header, that
follows the struct</dd>
</dl>
</div>
<div class="section" id="key-agreement-protocol-primitives-kpp-cipher-api">
<h1>Key-agreement Protocol Primitives (KPP) Cipher API<a class="headerlink" href="#key-agreement-protocol-primitives-kpp-cipher-api" title="Permalink to this headline">¶</a></h1>
<p>The KPP API is used with the algorithm type
CRYPTO_ALG_TYPE_KPP (listed as type &#8220;kpp&#8221; in /proc/crypto)</p>
<dl class="function">
<dt id="c.crypto_alloc_kpp">
struct <a class="reference internal" href="#c.crypto_kpp" title="crypto_kpp">crypto_kpp</a> * <code class="descname">crypto_alloc_kpp</code><span class="sig-paren">(</span>const char *<em>&nbsp;alg_name</em>, u32<em>&nbsp;type</em>, u32<em>&nbsp;mask</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_alloc_kpp" title="Permalink to this definition">¶</a></dt>
<dd><p>allocate KPP tfm handle</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">alg_name</span></code></dt>
<dd>is the name of the kpp algorithm (e.g. &#8220;dh&#8221;, &#8220;ecdh&#8221;)</dd>
<dt><code class="docutils literal"><span class="pre">u32</span> <span class="pre">type</span></code></dt>
<dd>specifies the type of the algorithm</dd>
<dt><code class="docutils literal"><span class="pre">u32</span> <span class="pre">mask</span></code></dt>
<dd>specifies the mask for the algorithm</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocate a handle for kpp algorithm. The returned struct crypto_kpp
is required for any following API invocation</p>
<p><strong>Return</strong></p>
<dl class="docutils">
<dt>allocated handle in case of success; <code class="xref c c-func docutils literal"><span class="pre">IS_ERR()</span></code> is true in case of</dt>
<dd>an error, <code class="xref c c-func docutils literal"><span class="pre">PTR_ERR()</span></code> returns the error code.</dd>
</dl>
<dl class="function">
<dt id="c.crypto_free_kpp">
void <code class="descname">crypto_free_kpp</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.crypto_kpp" title="crypto_kpp">crypto_kpp</a> *<em>&nbsp;tfm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_free_kpp" title="Permalink to this definition">¶</a></dt>
<dd><p>free KPP tfm handle</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">crypto_kpp</span> <span class="pre">*</span> <span class="pre">tfm</span></code></dt>
<dd>KPP tfm handle allocated with <a class="reference internal" href="#c.crypto_alloc_kpp" title="crypto_alloc_kpp"><code class="xref c c-func docutils literal"><span class="pre">crypto_alloc_kpp()</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.crypto_kpp_set_secret">
int <code class="descname">crypto_kpp_set_secret</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.crypto_kpp" title="crypto_kpp">crypto_kpp</a> *<em>&nbsp;tfm</em>, const void *<em>&nbsp;buffer</em>, unsigned int<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_kpp_set_secret" title="Permalink to this definition">¶</a></dt>
<dd><p>Invoke kpp operation</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">crypto_kpp</span> <span class="pre">*</span> <span class="pre">tfm</span></code></dt>
<dd>tfm handle</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">void</span> <span class="pre">*</span> <span class="pre">buffer</span></code></dt>
<dd>Buffer holding the packet representation of the private
key. The structure of the packet key depends on the particular
KPP implementation. Packing and unpacking helpers are provided
for ECDH and DH (see the respective header files for those
implementations).</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">len</span></code></dt>
<dd>Length of the packet private key buffer.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Function invokes the specific kpp operation for a given alg.</p>
<p><strong>Return</strong></p>
<p>zero on success; error code in case of error</p>
<dl class="function">
<dt id="c.crypto_kpp_generate_public_key">
int <code class="descname">crypto_kpp_generate_public_key</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.kpp_request" title="kpp_request">kpp_request</a> *<em>&nbsp;req</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_kpp_generate_public_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Invoke kpp operation</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">kpp_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>kpp key request</dd>
</dl>
<p><strong>Description</strong></p>
<p>Function invokes the specific kpp operation for generating the public part
for a given kpp algorithm.</p>
<p>To generate a private key, the caller should use a random number generator.
The output of the requested length serves as the private key.</p>
<p><strong>Return</strong></p>
<p>zero on success; error code in case of error</p>
<dl class="function">
<dt id="c.crypto_kpp_compute_shared_secret">
int <code class="descname">crypto_kpp_compute_shared_secret</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.kpp_request" title="kpp_request">kpp_request</a> *<em>&nbsp;req</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_kpp_compute_shared_secret" title="Permalink to this definition">¶</a></dt>
<dd><p>Invoke kpp operation</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">kpp_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>kpp key request</dd>
</dl>
<p><strong>Description</strong></p>
<p>Function invokes the specific kpp operation for computing the shared secret
for a given kpp algorithm.</p>
<p><strong>Return</strong></p>
<p>zero on success; error code in case of error</p>
<dl class="function">
<dt id="c.crypto_kpp_maxsize">
unsigned int <code class="descname">crypto_kpp_maxsize</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.crypto_kpp" title="crypto_kpp">crypto_kpp</a> *<em>&nbsp;tfm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_kpp_maxsize" title="Permalink to this definition">¶</a></dt>
<dd><p>Get len for output buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">crypto_kpp</span> <span class="pre">*</span> <span class="pre">tfm</span></code></dt>
<dd>KPP tfm handle allocated with <a class="reference internal" href="#c.crypto_alloc_kpp" title="crypto_alloc_kpp"><code class="xref c c-func docutils literal"><span class="pre">crypto_alloc_kpp()</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>Function returns the output buffer size required for a given key.
Function assumes that the key is already set in the transformation. If this
function is called without a setkey or with a failed setkey, you will end up
in a NULL dereference.</p>
</div>
<div class="section" id="key-agreement-protocol-primitives-kpp-cipher-request-handle">
<h1>Key-agreement Protocol Primitives (KPP) Cipher Request Handle<a class="headerlink" href="#key-agreement-protocol-primitives-kpp-cipher-request-handle" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="c.kpp_request_alloc">
struct <a class="reference internal" href="#c.kpp_request" title="kpp_request">kpp_request</a> * <code class="descname">kpp_request_alloc</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.crypto_kpp" title="crypto_kpp">crypto_kpp</a> *<em>&nbsp;tfm</em>, gfp_t<em>&nbsp;gfp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.kpp_request_alloc" title="Permalink to this definition">¶</a></dt>
<dd><p>allocates kpp request</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">crypto_kpp</span> <span class="pre">*</span> <span class="pre">tfm</span></code></dt>
<dd>KPP tfm handle allocated with <a class="reference internal" href="#c.crypto_alloc_kpp" title="crypto_alloc_kpp"><code class="xref c c-func docutils literal"><span class="pre">crypto_alloc_kpp()</span></code></a></dd>
<dt><code class="docutils literal"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt>
<dd>allocation flags</dd>
</dl>
<p><strong>Return</strong></p>
<p>allocated handle in case of success or NULL in case of an error.</p>
<dl class="function">
<dt id="c.kpp_request_free">
void <code class="descname">kpp_request_free</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.kpp_request" title="kpp_request">kpp_request</a> *<em>&nbsp;req</em><span class="sig-paren">)</span><a class="headerlink" href="#c.kpp_request_free" title="Permalink to this definition">¶</a></dt>
<dd><p>zeroize and free kpp request</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">kpp_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>request to free</dd>
</dl>
<dl class="function">
<dt id="c.kpp_request_set_callback">
void <code class="descname">kpp_request_set_callback</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.kpp_request" title="kpp_request">kpp_request</a> *<em>&nbsp;req</em>, u32<em>&nbsp;flgs</em>, crypto_completion_t<em>&nbsp;cmpl</em>, void *<em>&nbsp;data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.kpp_request_set_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets an asynchronous callback.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">kpp_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>request that the callback will be set for</dd>
<dt><code class="docutils literal"><span class="pre">u32</span> <span class="pre">flgs</span></code></dt>
<dd>specify for instance if the operation may backlog</dd>
<dt><code class="docutils literal"><span class="pre">crypto_completion_t</span> <span class="pre">cmpl</span></code></dt>
<dd>callback which will be called</dd>
<dt><code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">data</span></code></dt>
<dd>private data used by the caller</dd>
</dl>
<p><strong>Description</strong></p>
<p>Callback will be called when an asynchronous operation on a given
request is finished.</p>
<dl class="function">
<dt id="c.kpp_request_set_input">
void <code class="descname">kpp_request_set_input</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.kpp_request" title="kpp_request">kpp_request</a> *<em>&nbsp;req</em>, struct scatterlist *<em>&nbsp;input</em>, unsigned int<em>&nbsp;input_len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.kpp_request_set_input" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets input buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">kpp_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>kpp request</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">scatterlist</span> <span class="pre">*</span> <span class="pre">input</span></code></dt>
<dd>ptr to input scatter list</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">input_len</span></code></dt>
<dd>size of the input scatter list</dd>
</dl>
<p><strong>Description</strong></p>
<p>Sets parameters required by generate_public_key</p>
<dl class="function">
<dt id="c.kpp_request_set_output">
void <code class="descname">kpp_request_set_output</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.kpp_request" title="kpp_request">kpp_request</a> *<em>&nbsp;req</em>, struct scatterlist *<em>&nbsp;output</em>, unsigned int<em>&nbsp;output_len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.kpp_request_set_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets output buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">kpp_request</span> <span class="pre">*</span> <span class="pre">req</span></code></dt>
<dd>kpp request</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">scatterlist</span> <span class="pre">*</span> <span class="pre">output</span></code></dt>
<dd>ptr to output scatter list</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">output_len</span></code></dt>
<dd>size of the output scatter list</dd>
</dl>
<p><strong>Description</strong></p>
<p>Sets parameters required by kpp operation</p>
</div>
<div class="section" id="ecdh-helper-functions">
<h1>ECDH Helper Functions<a class="headerlink" href="#ecdh-helper-functions" title="Permalink to this headline">¶</a></h1>
<p>To use ECDH with the KPP cipher API, the following data structure and
functions should be used.</p>
<p>The ECC curves known to the ECDH implementation are specified in this
header file.</p>
<p>To use ECDH with KPP, the following functions should be used to operate on
an ECDH private key. The packet private key that can be set with
the KPP API function call of crypto_kpp_set_secret.</p>
<dl class="type">
<dt id="c.ecdh">
struct <code class="descname">ecdh</code><a class="headerlink" href="#c.ecdh" title="Permalink to this definition">¶</a></dt>
<dd><p>define an ECDH private key</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct ecdh {
  unsigned short curve_id;
  char *key;
  unsigned short key_size;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">curve_id</span></code></dt>
<dd>ECC curve the key is based on.</dd>
<dt><code class="docutils literal"><span class="pre">key</span></code></dt>
<dd>Private ECDH key</dd>
<dt><code class="docutils literal"><span class="pre">key_size</span></code></dt>
<dd>Size of the private ECDH key</dd>
</dl>
<dl class="function">
<dt id="c.crypto_ecdh_key_len">
unsigned int <code class="descname">crypto_ecdh_key_len</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.ecdh" title="ecdh">ecdh</a> *<em>&nbsp;params</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_ecdh_key_len" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the size of the private ECDH key</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">ecdh</span> <span class="pre">*</span> <span class="pre">params</span></code></dt>
<dd>private ECDH key</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function returns the packet ECDH key size. A caller can use that
with the provided ECDH private key reference to obtain the required
memory size to hold a packet key.</p>
<p><strong>Return</strong></p>
<p>size of the key in bytes</p>
<dl class="function">
<dt id="c.crypto_ecdh_encode_key">
int <code class="descname">crypto_ecdh_encode_key</code><span class="sig-paren">(</span>char *<em>&nbsp;buf</em>, unsigned int<em>&nbsp;len</em>, const struct <a class="reference internal" href="#c.ecdh" title="ecdh">ecdh</a> *<em>&nbsp;p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_ecdh_encode_key" title="Permalink to this definition">¶</a></dt>
<dd><p>encode the private key</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">char</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>Buffer allocated by the caller to hold the packet ECDH
private key. The buffer should be at least crypto_ecdh_key_len
bytes in size.</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">len</span></code></dt>
<dd>Length of the packet private key buffer</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">ecdh</span> <span class="pre">*</span> <span class="pre">p</span></code></dt>
<dd>Buffer with the caller-specified private key</dd>
</dl>
<p><strong>Description</strong></p>
<p>The ECDH implementations operate on a packet representation of the private
key.</p>
<p><strong>Return</strong></p>
<p>-EINVAL if buffer has insufficient size, 0 on success</p>
<dl class="function">
<dt id="c.crypto_ecdh_decode_key">
int <code class="descname">crypto_ecdh_decode_key</code><span class="sig-paren">(</span>const char *<em>&nbsp;buf</em>, unsigned int<em>&nbsp;len</em>, struct <a class="reference internal" href="#c.ecdh" title="ecdh">ecdh</a> *<em>&nbsp;p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_ecdh_decode_key" title="Permalink to this definition">¶</a></dt>
<dd><p>decode a private key</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>Buffer holding a packet key that should be decoded</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">len</span></code></dt>
<dd>Length of the packet private key buffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">ecdh</span> <span class="pre">*</span> <span class="pre">p</span></code></dt>
<dd>Buffer allocated by the caller that is filled with the
unpacked ECDH private key.</dd>
</dl>
<p><strong>Description</strong></p>
<p>The unpacking obtains the private key by pointing <strong>p</strong> to the correct location
in <strong>buf</strong>. Thus, both pointers refer to the same memory.</p>
<p><strong>Return</strong></p>
<p>-EINVAL if buffer has insufficient size, 0 on success</p>
</div>
<div class="section" id="dh-helper-functions">
<h1>DH Helper Functions<a class="headerlink" href="#dh-helper-functions" title="Permalink to this headline">¶</a></h1>
<p>To use DH with the KPP cipher API, the following data structure and
functions should be used.</p>
<p>To use DH with KPP, the following functions should be used to operate on
a DH private key. The packet private key that can be set with
the KPP API function call of crypto_kpp_set_secret.</p>
<dl class="type">
<dt id="c.dh">
struct <code class="descname">dh</code><a class="headerlink" href="#c.dh" title="Permalink to this definition">¶</a></dt>
<dd><p>define a DH private key</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none"><div class="highlight"><pre>struct dh {
  void *key;
  void *p;
  void *q;
  void *g;
  unsigned int key_size;
  unsigned int p_size;
  unsigned int q_size;
  unsigned int g_size;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">key</span></code></dt>
<dd>Private DH key</dd>
<dt><code class="docutils literal"><span class="pre">p</span></code></dt>
<dd>Diffie-Hellman parameter P</dd>
<dt><code class="docutils literal"><span class="pre">q</span></code></dt>
<dd>Diffie-Hellman parameter Q</dd>
<dt><code class="docutils literal"><span class="pre">g</span></code></dt>
<dd>Diffie-Hellman generator G</dd>
<dt><code class="docutils literal"><span class="pre">key_size</span></code></dt>
<dd>Size of the private DH key</dd>
<dt><code class="docutils literal"><span class="pre">p_size</span></code></dt>
<dd>Size of DH parameter P</dd>
<dt><code class="docutils literal"><span class="pre">q_size</span></code></dt>
<dd>Size of DH parameter Q</dd>
<dt><code class="docutils literal"><span class="pre">g_size</span></code></dt>
<dd>Size of DH generator G</dd>
</dl>
<dl class="function">
<dt id="c.crypto_dh_key_len">
unsigned int <code class="descname">crypto_dh_key_len</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.dh" title="dh">dh</a> *<em>&nbsp;params</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_dh_key_len" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the size of the private DH key</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">dh</span> <span class="pre">*</span> <span class="pre">params</span></code></dt>
<dd>private DH key</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function returns the packet DH key size. A caller can use that
with the provided DH private key reference to obtain the required
memory size to hold a packet key.</p>
<p><strong>Return</strong></p>
<p>size of the key in bytes</p>
<dl class="function">
<dt id="c.crypto_dh_encode_key">
int <code class="descname">crypto_dh_encode_key</code><span class="sig-paren">(</span>char *<em>&nbsp;buf</em>, unsigned int<em>&nbsp;len</em>, const struct <a class="reference internal" href="#c.dh" title="dh">dh</a> *<em>&nbsp;params</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_dh_encode_key" title="Permalink to this definition">¶</a></dt>
<dd><p>encode the private key</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">char</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>Buffer allocated by the caller to hold the packet DH
private key. The buffer should be at least crypto_dh_key_len
bytes in size.</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">len</span></code></dt>
<dd>Length of the packet private key buffer</dd>
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">dh</span> <span class="pre">*</span> <span class="pre">params</span></code></dt>
<dd>Buffer with the caller-specified private key</dd>
</dl>
<p><strong>Description</strong></p>
<p>The DH implementations operate on a packet representation of the private
key.</p>
<p><strong>Return</strong></p>
<p>-EINVAL if buffer has insufficient size, 0 on success</p>
<dl class="function">
<dt id="c.crypto_dh_decode_key">
int <code class="descname">crypto_dh_decode_key</code><span class="sig-paren">(</span>const char *<em>&nbsp;buf</em>, unsigned int<em>&nbsp;len</em>, struct <a class="reference internal" href="#c.dh" title="dh">dh</a> *<em>&nbsp;params</em><span class="sig-paren">)</span><a class="headerlink" href="#c.crypto_dh_decode_key" title="Permalink to this definition">¶</a></dt>
<dd><p>decode a private key</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>Buffer holding a packet key that should be decoded</dd>
<dt><code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">len</span></code></dt>
<dd>Length of the packet private key buffer</dd>
<dt><code class="docutils literal"><span class="pre">struct</span> <span class="pre">dh</span> <span class="pre">*</span> <span class="pre">params</span></code></dt>
<dd>Buffer allocated by the caller that is filled with the
unpacked DH private key.</dd>
</dl>
<p><strong>Description</strong></p>
<p>The unpacking obtains the private key by pointing <strong>p</strong> to the correct location
in <strong>buf</strong>. Thus, both pointers refer to the same memory.</p>
<p><strong>Return</strong></p>
<p>-EINVAL if buffer has insufficient size, 0 on success</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api-samples.html" class="btn btn-neutral float-right" title="Code Examples" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api-akcipher.html" class="btn btn-neutral" title="Asymmetric Cipher Algorithm Definitions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>