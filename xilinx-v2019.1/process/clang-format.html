

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>clang-format &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html"/>
        <link rel="up" title="Working with the kernel development community" href="index.html"/>
        <link rel="next" title="Development tools for the kernel" href="../dev-tools/index.html"/>
        <link rel="prev" title="Why the “volatile” type class should not be used" href="volatile-considered-harmful.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Working with the kernel development community</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="howto.html">HOWTO do Linux kernel development</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-of-conduct.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-of-conduct-interpretation.html">Linux Kernel Contributor Covenant Code of Conduct Interpretation</a></li>
<li class="toctree-l2"><a class="reference internal" href="development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="coding-style.html">Linux kernel coding style</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintainer-pgp-guide.html">Kernel Maintainer PGP guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="email-clients.html">Email clients info for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-enforcement-statement.html">Linux Kernel Enforcement Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-driver-statement.html">Kernel Driver Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="changes.html">Minimal requirements to compile the Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="submitting-drivers.html">Submitting Drivers For The Linux Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="stable-api-nonsense.html">The Linux Kernel Driver Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="management-style.html">Linux kernel management style</a></li>
<li class="toctree-l2"><a class="reference internal" href="stable-kernel-rules.html">Everything you ever wanted to know about Linux -stable releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="submit-checklist.html">Linux Kernel patch submission checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-docs.html">Index of Documentation for People Interested in Writing and/or Understanding the Linux Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="applying-patches.html">Applying Patches To The Linux Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding-syscalls.html">Adding a New System Call</a></li>
<li class="toctree-l2"><a class="reference internal" href="magic-number.html">Linux magic numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="volatile-considered-harmful.html">Why the &#8220;volatile&#8221; type class should not be used</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">clang-format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#review-files-and-patches-for-coding-style">Review files and patches for coding style</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reformatting-blocks-of-code">Reformatting blocks of code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#missing-support">Missing support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extra-features-options">Extra features/options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Working with the kernel development community</a> &raquo;</li>
      
    <li>clang-format</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/process/clang-format.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="clang-format">
<span id="clangformat"></span><h1>clang-format<a class="headerlink" href="#clang-format" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal"><span class="pre">clang-format</span></code> is a tool to format C/C++/... code according to
a set of rules and heuristics. Like most tools, it is not perfect
nor covers every single case, but it is good enough to be helpful.</p>
<p><code class="docutils literal"><span class="pre">clang-format</span></code> can be used for several purposes:</p>
<blockquote>
<div><ul class="simple">
<li>Quickly reformat a block of code to the kernel style. Specially useful
when moving code around and aligning/sorting. See <a class="reference internal" href="#clangformatreformat">clangformatreformat</a>.</li>
<li>Spot style mistakes, typos and possible improvements in files
you maintain, patches you review, diffs, etc. See <a class="reference internal" href="#clangformatreview">clangformatreview</a>.</li>
<li>Help you follow the coding style rules, specially useful for those
new to kernel development or working at the same time in several
projects with different coding styles.</li>
</ul>
</div></blockquote>
<p>Its configuration file is <code class="docutils literal"><span class="pre">.clang-format</span></code> in the root of the kernel tree.
The rules contained there try to approximate the most common kernel
coding style. They also try to follow <a class="reference internal" href="coding-style.html#codingstyle"><span>Documentation/process/coding-style.rst</span></a>
as much as possible. Since not all the kernel follows the same style,
it is possible that you may want to tweak the defaults for a particular
subsystem or folder. To do so, you can override the defaults by writing
another <code class="docutils literal"><span class="pre">.clang-format</span></code> file in a subfolder.</p>
<p>The tool itself has already been included in the repositories of popular
Linux distributions for a long time. Search for <code class="docutils literal"><span class="pre">clang-format</span></code> in
your repositories. Otherwise, you can either download pre-built
LLVM/clang binaries or build the source code from:</p>
<blockquote>
<div><a class="reference external" href="http://releases.llvm.org/download.html">http://releases.llvm.org/download.html</a></div></blockquote>
<p>See more information about the tool at:</p>
<blockquote>
<div><p><a class="reference external" href="https://clang.llvm.org/docs/ClangFormat.html">https://clang.llvm.org/docs/ClangFormat.html</a></p>
<p><a class="reference external" href="https://clang.llvm.org/docs/ClangFormatStyleOptions.html">https://clang.llvm.org/docs/ClangFormatStyleOptions.html</a></p>
</div></blockquote>
<div class="section" id="review-files-and-patches-for-coding-style">
<span id="clangformatreview"></span><h2>Review files and patches for coding style<a class="headerlink" href="#review-files-and-patches-for-coding-style" title="Permalink to this headline">¶</a></h2>
<p>By running the tool in its inline mode, you can review full subsystems,
folders or individual files for code style mistakes, typos or improvements.</p>
<p>To do so, you can run something like:</p>
<div class="highlight-none"><div class="highlight"><pre># Make sure your working directory is clean!
clang-format -i kernel/*.[ch]
</pre></div>
</div>
<p>And then take a look at the git diff.</p>
<p>Counting the lines of such a diff is also useful for improving/tweaking
the style options in the configuration file; as well as testing new
<code class="docutils literal"><span class="pre">clang-format</span></code> features/versions.</p>
<p><code class="docutils literal"><span class="pre">clang-format</span></code> also supports reading unified diffs, so you can review
patches and git diffs easily. See the documentation at:</p>
<blockquote>
<div><a class="reference external" href="https://clang.llvm.org/docs/ClangFormat.html#script-for-patch-reformatting">https://clang.llvm.org/docs/ClangFormat.html#script-for-patch-reformatting</a></div></blockquote>
<p>To avoid <code class="docutils literal"><span class="pre">clang-format</span></code> formatting some portion of a file, you can do:</p>
<div class="highlight-none"><div class="highlight"><pre>int formatted_code;
// clang-format off
    void    unformatted_code  ;
// clang-format on
void formatted_code_again;
</pre></div>
</div>
<p>While it might be tempting to use this to keep a file always in sync with
<code class="docutils literal"><span class="pre">clang-format</span></code>, specially if you are writing new files or if you are
a maintainer, please note that people might be running different
<code class="docutils literal"><span class="pre">clang-format</span></code> versions or not have it available at all. Therefore,
you should probably refrain yourself from using this in kernel sources;
at least until we see if <code class="docutils literal"><span class="pre">clang-format</span></code> becomes commonplace.</p>
</div>
<div class="section" id="reformatting-blocks-of-code">
<span id="clangformatreformat"></span><h2>Reformatting blocks of code<a class="headerlink" href="#reformatting-blocks-of-code" title="Permalink to this headline">¶</a></h2>
<p>By using an integration with your text editor, you can reformat arbitrary
blocks (selections) of code with a single keystroke. This is specially
useful when moving code around, for complex code that is deeply intended,
for multi-line macros (and aligning their backslashes), etc.</p>
<p>Remember that you can always tweak the changes afterwards in those cases
where the tool did not do an optimal job. But as a first approximation,
it can be very useful.</p>
<p>There are integrations for many popular text editors. For some of them,
like vim, emacs, BBEdit and Visual Studio you can find support built-in.
For instructions, read the appropiate section at:</p>
<blockquote>
<div><a class="reference external" href="https://clang.llvm.org/docs/ClangFormat.html">https://clang.llvm.org/docs/ClangFormat.html</a></div></blockquote>
<p>For Atom, Eclipse, Sublime Text, Visual Studio Code, XCode and other
editors and IDEs you should be able to find ready-to-use plugins.</p>
<p>For this use case, consider using a secondary <code class="docutils literal"><span class="pre">.clang-format</span></code>
so that you can tweak a few options. See <a class="reference internal" href="#clangformatextra">clangformatextra</a>.</p>
</div>
<div class="section" id="missing-support">
<span id="clangformatmissing"></span><h2>Missing support<a class="headerlink" href="#missing-support" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">clang-format</span></code> is missing support for some things that are common
in kernel code. They are easy to remember, so if you use the tool
regularly, you will quickly learn to avoid/ignore those.</p>
<p>In particular, some very common ones you will notice are:</p>
<blockquote>
<div><ul>
<li><p class="first">Aligned blocks of one-line <code class="docutils literal"><span class="pre">#defines</span></code>, e.g.:</p>
<div class="highlight-none"><div class="highlight"><pre>#define TRACING_MAP_BITS_DEFAULT       11
#define TRACING_MAP_BITS_MAX           17
#define TRACING_MAP_BITS_MIN           7
</pre></div>
</div>
<p>vs.:</p>
<div class="highlight-none"><div class="highlight"><pre>#define TRACING_MAP_BITS_DEFAULT 11
#define TRACING_MAP_BITS_MAX 17
#define TRACING_MAP_BITS_MIN 7
</pre></div>
</div>
</li>
<li><p class="first">Aligned designated initializers, e.g.:</p>
<div class="highlight-none"><div class="highlight"><pre>static const struct file_operations uprobe_events_ops = {
        .owner          = THIS_MODULE,
        .open           = probes_open,
        .read           = seq_read,
        .llseek         = seq_lseek,
        .release        = seq_release,
        .write          = probes_write,
};
</pre></div>
</div>
<p>vs.:</p>
<div class="highlight-none"><div class="highlight"><pre>static const struct file_operations uprobe_events_ops = {
        .owner = THIS_MODULE,
        .open = probes_open,
        .read = seq_read,
        .llseek = seq_lseek,
        .release = seq_release,
        .write = probes_write,
};
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="extra-features-options">
<span id="clangformatextra"></span><h2>Extra features/options<a class="headerlink" href="#extra-features-options" title="Permalink to this headline">¶</a></h2>
<p>Some features/style options are not enabled by default in the configuration
file in order to minimize the differences between the output and the current
code. In other words, to make the difference as small as possible,
which makes reviewing full-file style, as well diffs and patches as easy
as possible.</p>
<p>In other cases (e.g. particular subsystems/folders/files), the kernel style
might be different and enabling some of these options may approximate
better the style there.</p>
<p>For instance:</p>
<blockquote>
<div><ul class="simple">
<li>Aligning assignments (<code class="docutils literal"><span class="pre">AlignConsecutiveAssignments</span></code>).</li>
<li>Aligning declarations (<code class="docutils literal"><span class="pre">AlignConsecutiveDeclarations</span></code>).</li>
<li>Reflowing text in comments (<code class="docutils literal"><span class="pre">ReflowComments</span></code>).</li>
<li>Sorting <code class="docutils literal"><span class="pre">#includes</span></code> (<code class="docutils literal"><span class="pre">SortIncludes</span></code>).</li>
</ul>
</div></blockquote>
<p>They are typically useful for block re-formatting, rather than full-file.
You might want to create another <code class="docutils literal"><span class="pre">.clang-format</span></code> file and use that one
from your editor/IDE instead.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dev-tools/index.html" class="btn btn-neutral float-right" title="Development tools for the kernel" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="volatile-considered-harmful.html" class="btn btn-neutral" title="Why the “volatile” type class should not be used" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>