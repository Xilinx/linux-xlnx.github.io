

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kernel Maintainer PGP guide &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html"/>
        <link rel="up" title="Working with the kernel development community" href="index.html"/>
        <link rel="next" title="Email clients info for Linux" href="email-clients.html"/>
        <link rel="prev" title="Linux kernel coding style" href="coding-style.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Working with the kernel development community</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="howto.html">HOWTO do Linux kernel development</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-of-conduct.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-of-conduct-interpretation.html">Linux Kernel Contributor Covenant Code of Conduct Interpretation</a></li>
<li class="toctree-l2"><a class="reference internal" href="development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="coding-style.html">Linux kernel coding style</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Kernel Maintainer PGP guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-role-of-pgp-in-linux-kernel-development">The role of PGP in Linux Kernel development</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#trusting-the-developers-not-infrastructure">Trusting the developers, not infrastructure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pgp-tools">PGP tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#use-gnupg-v2">Use GnuPG v2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#protect-your-master-pgp-key">Protect your master PGP key</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#master-key-vs-subkeys">Master key vs. Subkeys</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ensure-your-passphrase-is-strong">Ensure your passphrase is strong</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-separate-signing-subkey">Create a separate Signing subkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="#back-up-your-master-key-for-disaster-recovery">Back up your master key for disaster recovery</a></li>
<li class="toctree-l4"><a class="reference internal" href="#back-up-your-whole-gnupg-directory">Back up your whole GnuPG directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remove-the-master-key-from-your-homedir">Remove the master key from  your homedir</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#move-the-subkeys-to-a-dedicated-crypto-device">Move the subkeys to a dedicated crypto device</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-benefits-of-smartcards">The benefits of smartcards</a></li>
<li class="toctree-l4"><a class="reference internal" href="#available-smartcard-devices">Available smartcard devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-your-smartcard-device">Configure your smartcard device</a></li>
<li class="toctree-l4"><a class="reference internal" href="#move-the-subkeys-to-your-smartcard">Move the subkeys to your smartcard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-common-gnupg-operations">Other common GnuPG operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-pgp-with-git">Using PGP with Git</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-git-to-use-your-pgp-key">Configure git to use your PGP key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-work-with-signed-tags">How to work with signed tags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-work-with-signed-commits">How to work with signed commits</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-verify-kernel-developer-identities">How to verify kernel developer identities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-auto-key-retrieval-using-wkd-and-dane">Configure auto-key-retrieval using WKD and DANE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#web-of-trust-wot-vs-trust-on-first-use-tofu">Web of Trust (WOT) vs. Trust on First Use (TOFU)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-use-keyservers-more-safely">How to use keyservers (more) safely</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="email-clients.html">Email clients info for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-enforcement-statement.html">Linux Kernel Enforcement Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-driver-statement.html">Kernel Driver Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="changes.html">Minimal requirements to compile the Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="submitting-drivers.html">Submitting Drivers For The Linux Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="stable-api-nonsense.html">The Linux Kernel Driver Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="management-style.html">Linux kernel management style</a></li>
<li class="toctree-l2"><a class="reference internal" href="stable-kernel-rules.html">Everything you ever wanted to know about Linux -stable releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="submit-checklist.html">Linux Kernel patch submission checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-docs.html">Index of Documentation for People Interested in Writing and/or Understanding the Linux Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="applying-patches.html">Applying Patches To The Linux Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding-syscalls.html">Adding a New System Call</a></li>
<li class="toctree-l2"><a class="reference internal" href="magic-number.html">Linux magic numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="volatile-considered-harmful.html">Why the &#8220;volatile&#8221; type class should not be used</a></li>
<li class="toctree-l2"><a class="reference internal" href="clang-format.html">clang-format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Working with the kernel development community</a> &raquo;</li>
      
    <li>Kernel Maintainer PGP guide</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/process/maintainer-pgp-guide.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kernel-maintainer-pgp-guide">
<span id="pgpguide"></span><h1>Kernel Maintainer PGP guide<a class="headerlink" href="#kernel-maintainer-pgp-guide" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Konstantin Ryabitsev &lt;<a class="reference external" href="mailto:konstantin&#37;&#52;&#48;linuxfoundation&#46;org">konstantin<span>&#64;</span>linuxfoundation<span>&#46;</span>org</a>&gt;</td>
</tr>
</tbody>
</table>
<p>This document is aimed at Linux kernel developers, and especially at
subsystem maintainers. It contains a subset of information discussed in
the more general &#8220;<a class="reference external" href="https://github.com/lfit/itpol/blob/master/protecting-code-integrity.md">Protecting Code Integrity</a>&#8221; guide published by the
Linux Foundation. Please read that document for more in-depth discussion
on some of the topics mentioned in this guide.</p>
<div class="section" id="the-role-of-pgp-in-linux-kernel-development">
<h2>The role of PGP in Linux Kernel development<a class="headerlink" href="#the-role-of-pgp-in-linux-kernel-development" title="Permalink to this headline">¶</a></h2>
<p>PGP helps ensure the integrity of the code that is produced by the Linux
kernel development community and, to a lesser degree, establish trusted
communication channels between developers via PGP-signed email exchange.</p>
<p>The Linux kernel source code is available in two main formats:</p>
<ul class="simple">
<li>Distributed source repositories (git)</li>
<li>Periodic release snapshots (tarballs)</li>
</ul>
<p>Both git repositories and tarballs carry PGP signatures of the kernel
developers who create official kernel releases. These signatures offer a
cryptographic guarantee that downloadable versions made available via
kernel.org or any other mirrors are identical to what these developers
have on their workstations. To this end:</p>
<ul class="simple">
<li>git repositories provide PGP signatures on all tags</li>
<li>tarballs provide detached PGP signatures with all downloads</li>
</ul>
<div class="section" id="trusting-the-developers-not-infrastructure">
<span id="devs-not-infra"></span><h3>Trusting the developers, not infrastructure<a class="headerlink" href="#trusting-the-developers-not-infrastructure" title="Permalink to this headline">¶</a></h3>
<p>Ever since the 2011 compromise of core kernel.org systems, the main
operating principle of the Kernel Archives project has been to assume
that any part of the infrastructure can be compromised at any time. For
this reason, the administrators have taken deliberate steps to emphasize
that trust must always be placed with developers and never with the code
hosting infrastructure, regardless of how good the security practices
for the latter may be.</p>
<p>The above guiding principle is the reason why this guide is needed. We
want to make sure that by placing trust into developers we do not simply
shift the blame for potential future security incidents to someone else.
The goal is to provide a set of guidelines developers can use to create
a secure working environment and safeguard the PGP keys used to
establish the integrity of the Linux kernel itself.</p>
</div>
</div>
<div class="section" id="pgp-tools">
<span id="id1"></span><h2>PGP tools<a class="headerlink" href="#pgp-tools" title="Permalink to this headline">¶</a></h2>
<div class="section" id="use-gnupg-v2">
<h3>Use GnuPG v2<a class="headerlink" href="#use-gnupg-v2" title="Permalink to this headline">¶</a></h3>
<p>Your distro should already have GnuPG installed by default, you just
need to verify that you are using version 2.x and not the legacy 1.4
release &#8211; many distributions still package both, with the default
<code class="docutils literal"><span class="pre">gpg</span></code> command invoking GnuPG v.1. To check, run:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --version | head -n1
</pre></div>
</div>
<p>If you see <code class="docutils literal"><span class="pre">gpg</span> <span class="pre">(GnuPG)</span> <span class="pre">1.4.x</span></code>, then you are using GnuPG v.1. Try the
<code class="docutils literal"><span class="pre">gpg2</span></code> command (if you don&#8217;t have it, you may need to install the
gnupg2 package):</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg2 --version | head -n1
</pre></div>
</div>
<p>If you see <code class="docutils literal"><span class="pre">gpg</span> <span class="pre">(GnuPG)</span> <span class="pre">2.x.x</span></code>, then you are good to go. This guide
will assume you have the version 2.2 of GnuPG (or later). If you are
using version 2.0 of GnuPG, then some of the commands in this guide will
not work, and you should consider installing the latest 2.2 version of
GnuPG. Versions of gnupg-2.1.11 and later should be compatible for the
purposes of this guide as well.</p>
<p>If you have both <code class="docutils literal"><span class="pre">gpg</span></code> and <code class="docutils literal"><span class="pre">gpg2</span></code> commands, you should make sure you
are always using GnuPG v2, not the legacy version. You can enforce this
by setting the appropriate alias:</p>
<div class="highlight-none"><div class="highlight"><pre>$ alias gpg=gpg2
</pre></div>
</div>
<p>You can put that in your <code class="docutils literal"><span class="pre">.bashrc</span></code> to make sure it&#8217;s always the case.</p>
<div class="section" id="configure-gpg-agent-options">
<h4>Configure gpg-agent options<a class="headerlink" href="#configure-gpg-agent-options" title="Permalink to this headline">¶</a></h4>
<p>The GnuPG agent is a helper tool that will start automatically whenever
you use the <code class="docutils literal"><span class="pre">gpg</span></code> command and run in the background with the purpose
of caching the private key passphrase. There are two options you should
know in order to tweak when the passphrase should be expired from cache:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">default-cache-ttl</span></code> (seconds): If you use the same key again before
the time-to-live expires, the countdown will reset for another period.
The default is 600 (10 minutes).</li>
<li><code class="docutils literal"><span class="pre">max-cache-ttl</span></code> (seconds): Regardless of how recently you&#8217;ve used
the key since initial passphrase entry, if the maximum time-to-live
countdown expires, you&#8217;ll have to enter the passphrase again. The
default is 30 minutes.</li>
</ul>
<p>If you find either of these defaults too short (or too long), you can
edit your <code class="docutils literal"><span class="pre">~/.gnupg/gpg-agent.conf</span></code> file to set your own values:</p>
<div class="highlight-none"><div class="highlight"><pre># set to 30 minutes for regular ttl, and 2 hours for max ttl
default-cache-ttl 1800
max-cache-ttl 7200
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is no longer necessary to start gpg-agent manually at the
beginning of your shell session. You may want to check your rc files
to remove anything you had in place for older versions of GnuPG, as
it may not be doing the right thing any more.</p>
</div>
</div>
<div class="section" id="set-up-a-refresh-cronjob">
<h4>Set up a refresh cronjob<a class="headerlink" href="#set-up-a-refresh-cronjob" title="Permalink to this headline">¶</a></h4>
<p>You will need to regularly refresh your keyring in order to get the
latest changes on other people&#8217;s public keys, which is best done with a
daily cronjob:</p>
<div class="highlight-none"><div class="highlight"><pre>@daily /usr/bin/gpg2 --refresh &gt;/dev/null 2&gt;&amp;1
</pre></div>
</div>
<p>Check the full path to your <code class="docutils literal"><span class="pre">gpg</span></code> or <code class="docutils literal"><span class="pre">gpg2</span></code> command and use the
<code class="docutils literal"><span class="pre">gpg2</span></code> command if regular <code class="docutils literal"><span class="pre">gpg</span></code> for you is the legacy GnuPG v.1.</p>
</div>
</div>
</div>
<div class="section" id="protect-your-master-pgp-key">
<span id="master-key"></span><h2>Protect your master PGP key<a class="headerlink" href="#protect-your-master-pgp-key" title="Permalink to this headline">¶</a></h2>
<p>This guide assumes that you already have a PGP key that you use for Linux
kernel development purposes. If you do not yet have one, please see the
&#8220;<a class="reference external" href="https://github.com/lfit/itpol/blob/master/protecting-code-integrity.md">Protecting Code Integrity</a>&#8221; document mentioned earlier for guidance
on how to create a new one.</p>
<p>You should also make a new key if your current one is weaker than 2048 bits
(RSA).</p>
<div class="section" id="master-key-vs-subkeys">
<h3>Master key vs. Subkeys<a class="headerlink" href="#master-key-vs-subkeys" title="Permalink to this headline">¶</a></h3>
<p>Subkeys are fully independent PGP keypairs that are tied to the &#8220;master&#8221;
key using certifying key signatures (certificates). It is important to
understand the following:</p>
<ol class="arabic simple">
<li>There are no technical differences between the &#8220;master key&#8221; and &#8220;subkeys.&#8221;</li>
<li>At creation time, we assign functional limitations to each key by
giving it specific capabilities.</li>
<li>A PGP key can have 4 capabilities:<ul>
<li><strong>[S]</strong> key can be used for signing</li>
<li><strong>[E]</strong> key can be used for encryption</li>
<li><strong>[A]</strong> key can be used for authentication</li>
<li><strong>[C]</strong> key can be used for certifying other keys</li>
</ul>
</li>
<li>A single key may have multiple capabilities.</li>
<li>A subkey is fully independent from the master key. A message
encrypted to a subkey cannot be decrypted with the master key. If you
lose your private subkey, it cannot be recreated from the master key
in any way.</li>
</ol>
<p>The key carrying the <strong>[C]</strong> (certify) capability is considered the
&#8220;master&#8221; key because it is the only key that can be used to indicate
relationship with other keys. Only the <strong>[C]</strong> key can be used to:</p>
<ul class="simple">
<li>add or revoke other keys (subkeys) with S/E/A capabilities</li>
<li>add, change or revoke identities (uids) associated with the key</li>
<li>add or change the expiration date on itself or any subkey</li>
<li>sign other people&#8217;s keys for web of trust purposes</li>
</ul>
<p>By default, GnuPG creates the following when generating new keys:</p>
<ul class="simple">
<li>A master key carrying both Certify and Sign capabilities (<strong>[SC]</strong>)</li>
<li>A separate subkey with the Encryption capability (<strong>[E]</strong>)</li>
</ul>
<p>If you used the default parameters when generating your key, then that
is what you will have. You can verify by running <code class="docutils literal"><span class="pre">gpg</span> <span class="pre">--list-secret-keys</span></code>,
for example:</p>
<div class="highlight-none"><div class="highlight"><pre>sec   rsa2048 2018-01-23 [SC] [expires: 2020-01-23]
      000000000000000000000000AAAABBBBCCCCDDDD
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
ssb   rsa2048 2018-01-23 [E] [expires: 2020-01-23]
</pre></div>
</div>
<p>Any key carrying the <strong>[C]</strong> capability is your master key, regardless
of any other capabilities it may have assigned to it.</p>
<p>The long line under the <code class="docutils literal"><span class="pre">sec</span></code> entry is your key fingerprint &#8211;
whenever you see <code class="docutils literal"><span class="pre">[fpr]</span></code> in the examples below, that 40-character
string is what it refers to.</p>
</div>
<div class="section" id="ensure-your-passphrase-is-strong">
<h3>Ensure your passphrase is strong<a class="headerlink" href="#ensure-your-passphrase-is-strong" title="Permalink to this headline">¶</a></h3>
<p>GnuPG uses passphrases to encrypt your private keys before storing them on
disk. This way, even if your <code class="docutils literal"><span class="pre">.gnupg</span></code> directory is leaked or stolen in
its entirety, the attackers cannot use your private keys without first
obtaining the passphrase to decrypt them.</p>
<p>It is absolutely essential that your private keys are protected by a
strong passphrase. To set it or change it, use:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --change-passphrase [fpr]
</pre></div>
</div>
</div>
<div class="section" id="create-a-separate-signing-subkey">
<h3>Create a separate Signing subkey<a class="headerlink" href="#create-a-separate-signing-subkey" title="Permalink to this headline">¶</a></h3>
<p>Our goal is to protect your master key by moving it to offline media, so
if you only have a combined <strong>[SC]</strong> key, then you should create a separate
signing subkey:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --quick-addkey [fpr] ed25519 sign
</pre></div>
</div>
<p>Remember to tell the keyservers about this change, so others can pull down
your new subkey:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --send-key [fpr]
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>ECC support in GnuPG</p>
<p>GnuPG 2.1 and later has full support for Elliptic Curve
Cryptography, with ability to combine ECC subkeys with traditional
RSA master keys. The main upside of ECC cryptography is that it is
much faster computationally and creates much smaller signatures when
compared byte for byte with 2048+ bit RSA keys. Unless you plan on
using a smartcard device that does not support ECC operations, we
recommend that you create an ECC signing subkey for your kernel
work.</p>
<p class="last">If for some reason you prefer to stay with RSA subkeys, just replace
&#8220;ed25519&#8221; with &#8220;rsa2048&#8221; in the above command.</p>
</div>
</div>
<div class="section" id="back-up-your-master-key-for-disaster-recovery">
<h3>Back up your master key for disaster recovery<a class="headerlink" href="#back-up-your-master-key-for-disaster-recovery" title="Permalink to this headline">¶</a></h3>
<p>The more signatures you have on your PGP key from other developers, the
more reasons you have to create a backup version that lives on something
other than digital media, for disaster recovery reasons.</p>
<p>The best way to create a printable hardcopy of your private key is by
using the <code class="docutils literal"><span class="pre">paperkey</span></code> software written for this very purpose. See <code class="docutils literal"><span class="pre">man</span>
<span class="pre">paperkey</span></code> for more details on the output format and its benefits over
other solutions. Paperkey should already be packaged for most
distributions.</p>
<p>Run the following command to create a hardcopy backup of your private
key:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --export-secret-key [fpr] | paperkey -o /tmp/key-backup.txt
</pre></div>
</div>
<p>Print out that file (or pipe the output straight to lpr), then take a
pen and write your passphrase on the margin of the paper. <strong>This is
strongly recommended</strong> because the key printout is still encrypted with
that passphrase, and if you ever change it you will not remember what it
used to be when you had created the backup &#8211; <em>guaranteed</em>.</p>
<p>Put the resulting printout and the hand-written passphrase into an envelope
and store in a secure and well-protected place, preferably away from your
home, such as your bank vault.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your printer is probably no longer a simple dumb device connected to
your parallel port, but since the output is still encrypted with
your passphrase, printing out even to &#8220;cloud-integrated&#8221; modern
printers should remain a relatively safe operation. One option is to
change the passphrase on your master key immediately after you are
done with paperkey.</p>
</div>
</div>
<div class="section" id="back-up-your-whole-gnupg-directory">
<h3>Back up your whole GnuPG directory<a class="headerlink" href="#back-up-your-whole-gnupg-directory" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>!!!Do not skip this step!!!</strong></p>
</div>
<p>It is important to have a readily available backup of your PGP keys
should you need to recover them. This is different from the
disaster-level preparedness we did with <code class="docutils literal"><span class="pre">paperkey</span></code>. You will also rely
on these external copies whenever you need to use your Certify key &#8211;
such as when making changes to your own key or signing other people&#8217;s
keys after conferences and summits.</p>
<p>Start by getting a small USB &#8220;thumb&#8221; drive (preferably two!) that you
will use for backup purposes. You will need to encrypt them using LUKS
&#8211; refer to your distro&#8217;s documentation on how to accomplish this.</p>
<p>For the encryption passphrase, you can use the same one as on your
master key.</p>
<p>Once the encryption process is over, re-insert the USB drive and make
sure it gets properly mounted. Copy your entire <code class="docutils literal"><span class="pre">.gnupg</span></code> directory
over to the encrypted storage:</p>
<div class="highlight-none"><div class="highlight"><pre>$ cp -a ~/.gnupg /media/disk/foo/gnupg-backup
</pre></div>
</div>
<p>You should now test to make sure everything still works:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --homedir=/media/disk/foo/gnupg-backup --list-key [fpr]
</pre></div>
</div>
<p>If you don&#8217;t get any errors, then you should be good to go. Unmount the
USB drive, distinctly label it so you don&#8217;t blow it away next time you
need to use a random USB drive, and put in a safe place &#8211; but not too
far away, because you&#8217;ll need to use it every now and again for things
like editing identities, adding or revoking subkeys, or signing other
people&#8217;s keys.</p>
</div>
<div class="section" id="remove-the-master-key-from-your-homedir">
<h3>Remove the master key from  your homedir<a class="headerlink" href="#remove-the-master-key-from-your-homedir" title="Permalink to this headline">¶</a></h3>
<p>The files in our home directory are not as well protected as we like to
think.  They can be leaked or stolen via many different means:</p>
<ul class="simple">
<li>by accident when making quick homedir copies to set up a new workstation</li>
<li>by systems administrator negligence or malice</li>
<li>via poorly secured backups</li>
<li>via malware in desktop apps (browsers, pdf viewers, etc)</li>
<li>via coercion when crossing international borders</li>
</ul>
<p>Protecting your key with a good passphrase greatly helps reduce the risk
of any of the above, but passphrases can be discovered via keyloggers,
shoulder-surfing, or any number of other means. For this reason, the
recommended setup is to remove your master key from your home directory
and store it on offline storage.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Please see the previous section and make sure you have backed up
your GnuPG directory in its entirety. What we are about to do will
render your key useless if you do not have a usable backup!</p>
</div>
<p>First, identify the keygrip of your master key:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --with-keygrip --list-key [fpr]
</pre></div>
</div>
<p>The output will be something like this:</p>
<div class="highlight-none"><div class="highlight"><pre>pub   rsa2048 2018-01-24 [SC] [expires: 2020-01-24]
      000000000000000000000000AAAABBBBCCCCDDDD
      Keygrip = 1111000000000000000000000000000000000000
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
sub   rsa2048 2018-01-24 [E] [expires: 2020-01-24]
      Keygrip = 2222000000000000000000000000000000000000
sub   ed25519 2018-01-24 [S]
      Keygrip = 3333000000000000000000000000000000000000
</pre></div>
</div>
<p>Find the keygrip entry that is beneath the <code class="docutils literal"><span class="pre">pub</span></code> line (right under the
master key fingerprint). This will correspond directly to a file in your
<code class="docutils literal"><span class="pre">~/.gnupg</span></code> directory:</p>
<div class="highlight-none"><div class="highlight"><pre>$ cd ~/.gnupg/private-keys-v1.d
$ ls
1111000000000000000000000000000000000000.key
2222000000000000000000000000000000000000.key
3333000000000000000000000000000000000000.key
</pre></div>
</div>
<p>All you have to do is simply remove the .key file that corresponds to
the master keygrip:</p>
<div class="highlight-none"><div class="highlight"><pre>$ cd ~/.gnupg/private-keys-v1.d
$ rm 1111000000000000000000000000000000000000.key
</pre></div>
</div>
<p>Now, if you issue the <code class="docutils literal"><span class="pre">--list-secret-keys</span></code> command, it will show that
the master key is missing (the <code class="docutils literal"><span class="pre">#</span></code> indicates it is not available):</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --list-secret-keys
sec#  rsa2048 2018-01-24 [SC] [expires: 2020-01-24]
      000000000000000000000000AAAABBBBCCCCDDDD
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
ssb   rsa2048 2018-01-24 [E] [expires: 2020-01-24]
ssb   ed25519 2018-01-24 [S]
</pre></div>
</div>
<p>You should also remove any <code class="docutils literal"><span class="pre">secring.gpg</span></code> files in the <code class="docutils literal"><span class="pre">~/.gnupg</span></code>
directory, which are left over from earlier versions of GnuPG.</p>
<div class="section" id="if-you-don-t-have-the-private-keys-v1-d-directory">
<h4>If you don&#8217;t have the &#8220;private-keys-v1.d&#8221; directory<a class="headerlink" href="#if-you-don-t-have-the-private-keys-v1-d-directory" title="Permalink to this headline">¶</a></h4>
<p>If you do not have a <code class="docutils literal"><span class="pre">~/.gnupg/private-keys-v1.d</span></code> directory, then your
secret keys are still stored in the legacy <code class="docutils literal"><span class="pre">secring.gpg</span></code> file used by
GnuPG v1. Making any changes to your key, such as changing the
passphrase or adding a subkey, should automatically convert the old
<code class="docutils literal"><span class="pre">secring.gpg</span></code> format to use <code class="docutils literal"><span class="pre">private-keys-v1.d</span></code> instead.</p>
<p>Once you get that done, make sure to delete the obsolete <code class="docutils literal"><span class="pre">secring.gpg</span></code>
file, which still contains your private keys.</p>
</div>
</div>
</div>
<div class="section" id="move-the-subkeys-to-a-dedicated-crypto-device">
<span id="smartcards"></span><h2>Move the subkeys to a dedicated crypto device<a class="headerlink" href="#move-the-subkeys-to-a-dedicated-crypto-device" title="Permalink to this headline">¶</a></h2>
<p>Even though the master key is now safe from being leaked or stolen, the
subkeys are still in your home directory. Anyone who manages to get
their hands on those will be able to decrypt your communication or fake
your signatures (if they know the passphrase). Furthermore, each time a
GnuPG operation is performed, the keys are loaded into system memory and
can be stolen from there by sufficiently advanced malware (think
Meltdown and Spectre).</p>
<p>The best way to completely protect your keys is to move them to a
specialized hardware device that is capable of smartcard operations.</p>
<div class="section" id="the-benefits-of-smartcards">
<h3>The benefits of smartcards<a class="headerlink" href="#the-benefits-of-smartcards" title="Permalink to this headline">¶</a></h3>
<p>A smartcard contains a cryptographic chip that is capable of storing
private keys and performing crypto operations directly on the card
itself. Because the key contents never leave the smartcard, the
operating system of the computer into which you plug in the hardware
device is not able to retrieve the private keys themselves. This is very
different from the encrypted USB storage device we used earlier for
backup purposes &#8211; while that USB device is plugged in and mounted, the
operating system is able to access the private key contents.</p>
<p>Using external encrypted USB media is not a substitute to having a
smartcard-capable device.</p>
</div>
<div class="section" id="available-smartcard-devices">
<h3>Available smartcard devices<a class="headerlink" href="#available-smartcard-devices" title="Permalink to this headline">¶</a></h3>
<p>Unless all your laptops and workstations have smartcard readers, the
easiest is to get a specialized USB device that implements smartcard
functionality.  There are several options available:</p>
<ul class="simple">
<li><a class="reference external" href="https://shop.nitrokey.com/shop/product/nitrokey-start-6">Nitrokey Start</a>: Open hardware and Free Software, based on FSI
Japan&#8217;s <a class="reference external" href="http://www.fsij.org/doc-gnuk/">Gnuk</a>. Offers support for ECC keys, but fewest security
features (such as resistance to tampering or some side-channel
attacks).</li>
<li><a class="reference external" href="https://shop.nitrokey.com/shop/product/nitrokey-pro-3">Nitrokey Pro</a>: Similar to the Nitrokey Start, but more
tamper-resistant and offers more security features, but no ECC
support.</li>
<li><a class="reference external" href="https://www.yubico.com/product/yubikey-4-series/">Yubikey 4</a>: proprietary hardware and software, but cheaper than
Nitrokey Pro and comes available in the USB-C form that is more useful
with newer laptops. Offers additional security features such as FIDO
U2F, but no ECC.</li>
</ul>
<p><a class="reference external" href="https://lwn.net/Articles/736231/">LWN has a good review</a> of some of the above models, as well as several
others. If you want to use ECC keys, your best bet among commercially
available devices is the Nitrokey Start.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are listed in MAINTAINERS or have an account at kernel.org,
you <a class="reference external" href="https://www.kernel.org/nitrokey-digital-tokens-for-kernel-developers.html">qualify for a free Nitrokey Start</a> courtesy of The Linux
Foundation.</p>
</div>
</div>
<div class="section" id="configure-your-smartcard-device">
<h3>Configure your smartcard device<a class="headerlink" href="#configure-your-smartcard-device" title="Permalink to this headline">¶</a></h3>
<p>Your smartcard device should Just Work (TM) the moment you plug it into
any modern Linux workstation. You can verify it by running:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --card-status
</pre></div>
</div>
<p>If you see full smartcard details, then you are good to go.
Unfortunately, troubleshooting all possible reasons why things may not
be working for you is way beyond the scope of this guide. If you are
having trouble getting the card to work with GnuPG, please seek help via
usual support channels.</p>
<p>To configure your smartcard, you will need to use the GnuPG menu system, as
there are no convenient command-line switches:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --card-edit
[...omitted...]
gpg/card&gt; admin
Admin commands are allowed
gpg/card&gt; passwd
</pre></div>
</div>
<p>You should set the user PIN (1), Admin PIN (3), and the Reset Code (4).
Please make sure to record and store these in a safe place &#8211; especially
the Admin PIN and the Reset Code (which allows you to completely wipe
the smartcard). You so rarely need to use the Admin PIN, that you will
inevitably forget what it is if you do not record it.</p>
<p>Getting back to the main card menu, you can also set other values (such
as name, sex, login data, etc), but it&#8217;s not necessary and will
additionally leak information about your smartcard should you lose it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Despite having the name &#8220;PIN&#8221;, neither the user PIN nor the admin
PIN on the card need to be numbers.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Some devices may require that you move the subkeys onto the device
before you can change the passphrase. Please check the documentation
provided by the device manufacturer.</p>
</div>
</div>
<div class="section" id="move-the-subkeys-to-your-smartcard">
<h3>Move the subkeys to your smartcard<a class="headerlink" href="#move-the-subkeys-to-your-smartcard" title="Permalink to this headline">¶</a></h3>
<p>Exit the card menu (using &#8220;q&#8221;) and save all changes. Next, let&#8217;s move
your subkeys onto the smartcard. You will need both your PGP key
passphrase and the admin PIN of the card for most operations:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --edit-key [fpr]

Secret subkeys are available.

pub  rsa2048/AAAABBBBCCCCDDDD
     created: 2018-01-23  expires: 2020-01-23  usage: SC
     trust: ultimate      validity: ultimate
ssb  rsa2048/1111222233334444
     created: 2018-01-23  expires: never       usage: E
ssb  ed25519/5555666677778888
     created: 2017-12-07  expires: never       usage: S
[ultimate] (1). Alice Dev &lt;adev@kernel.org&gt;

gpg&gt;
</pre></div>
</div>
<p>Using <code class="docutils literal"><span class="pre">--edit-key</span></code> puts us into the menu mode again, and you will
notice that the key listing is a little different. From here on, all
commands are done from inside this menu mode, as indicated by <code class="docutils literal"><span class="pre">gpg&gt;</span></code>.</p>
<p>First, let&#8217;s select the key we&#8217;ll be putting onto the card &#8211; you do
this by typing <code class="docutils literal"><span class="pre">key</span> <span class="pre">1</span></code> (it&#8217;s the first one in the listing, the <strong>[E]</strong>
subkey):</p>
<div class="highlight-none"><div class="highlight"><pre>gpg&gt; key 1
</pre></div>
</div>
<p>In the output, you should now see <code class="docutils literal"><span class="pre">ssb*</span></code> on the <strong>[E]</strong> key. The <code class="docutils literal"><span class="pre">*</span></code>
indicates which key is currently &#8220;selected.&#8221; It works as a <em>toggle</em>,
meaning that if you type <code class="docutils literal"><span class="pre">key</span> <span class="pre">1</span></code> again, the <code class="docutils literal"><span class="pre">*</span></code> will disappear and
the key will not be selected any more.</p>
<p>Now, let&#8217;s move that key onto the smartcard:</p>
<div class="highlight-none"><div class="highlight"><pre>gpg&gt; keytocard
Please select where to store the key:
   (2) Encryption key
Your selection? 2
</pre></div>
</div>
<p>Since it&#8217;s our <strong>[E]</strong> key, it makes sense to put it into the Encryption
slot.  When you submit your selection, you will be prompted first for
your PGP key passphrase, and then for the admin PIN. If the command
returns without an error, your key has been moved.</p>
<p><strong>Important</strong>: Now type <code class="docutils literal"><span class="pre">key</span> <span class="pre">1</span></code> again to unselect the first key, and
<code class="docutils literal"><span class="pre">key</span> <span class="pre">2</span></code> to select the <strong>[S]</strong> key:</p>
<div class="highlight-none"><div class="highlight"><pre>gpg&gt; key 1
gpg&gt; key 2
gpg&gt; keytocard
Please select where to store the key:
   (1) Signature key
   (3) Authentication key
Your selection? 1
</pre></div>
</div>
<p>You can use the <strong>[S]</strong> key both for Signature and Authentication, but
we want to make sure it&#8217;s in the Signature slot, so choose (1). Once
again, if your command returns without an error, then the operation was
successful:</p>
<div class="highlight-none"><div class="highlight"><pre>gpg&gt; q
Save changes? (y/N) y
</pre></div>
</div>
<p>Saving the changes will delete the keys you moved to the card from your
home directory (but it&#8217;s okay, because we have them in our backups
should we need to do this again for a replacement smartcard).</p>
<div class="section" id="verifying-that-the-keys-were-moved">
<h4>Verifying that the keys were moved<a class="headerlink" href="#verifying-that-the-keys-were-moved" title="Permalink to this headline">¶</a></h4>
<p>If you perform <code class="docutils literal"><span class="pre">--list-secret-keys</span></code> now, you will see a subtle
difference in the output:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --list-secret-keys
sec#  rsa2048 2018-01-24 [SC] [expires: 2020-01-24]
      000000000000000000000000AAAABBBBCCCCDDDD
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
ssb&gt;  rsa2048 2018-01-24 [E] [expires: 2020-01-24]
ssb&gt;  ed25519 2018-01-24 [S]
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&gt;</span></code> in the <code class="docutils literal"><span class="pre">ssb&gt;</span></code> output indicates that the subkey is only
available on the smartcard. If you go back into your secret keys
directory and look at the contents there, you will notice that the
<code class="docutils literal"><span class="pre">.key</span></code> files there have been replaced with stubs:</p>
<div class="highlight-none"><div class="highlight"><pre>$ cd ~/.gnupg/private-keys-v1.d
$ strings *.key | grep &#39;private-key&#39;
</pre></div>
</div>
<p>The output should contain <code class="docutils literal"><span class="pre">shadowed-private-key</span></code> to indicate that
these files are only stubs and the actual content is on the smartcard.</p>
</div>
<div class="section" id="verifying-that-the-smartcard-is-functioning">
<h4>Verifying that the smartcard is functioning<a class="headerlink" href="#verifying-that-the-smartcard-is-functioning" title="Permalink to this headline">¶</a></h4>
<p>To verify that the smartcard is working as intended, you can create a
signature:</p>
<div class="highlight-none"><div class="highlight"><pre>$ echo &quot;Hello world&quot; | gpg --clearsign &gt; /tmp/test.asc
$ gpg --verify /tmp/test.asc
</pre></div>
</div>
<p>This should ask for your smartcard PIN on your first command, and then
show &#8220;Good signature&#8221; after you run <code class="docutils literal"><span class="pre">gpg</span> <span class="pre">--verify</span></code>.</p>
<p>Congratulations, you have successfully made it extremely difficult to
steal your digital developer identity!</p>
</div>
</div>
<div class="section" id="other-common-gnupg-operations">
<h3>Other common GnuPG operations<a class="headerlink" href="#other-common-gnupg-operations" title="Permalink to this headline">¶</a></h3>
<p>Here is a quick reference for some common operations you&#8217;ll need to do
with your PGP key.</p>
<div class="section" id="mounting-your-master-key-offline-storage">
<h4>Mounting your master key offline storage<a class="headerlink" href="#mounting-your-master-key-offline-storage" title="Permalink to this headline">¶</a></h4>
<p>You will need your master key for any of the operations below, so you
will first need to mount your backup offline storage and tell GnuPG to
use it:</p>
<div class="highlight-none"><div class="highlight"><pre>$ export GNUPGHOME=/media/disk/foo/gnupg-backup
$ gpg --list-secret-keys
</pre></div>
</div>
<p>You want to make sure that you see <code class="docutils literal"><span class="pre">sec</span></code> and not <code class="docutils literal"><span class="pre">sec#</span></code> in the
output (the <code class="docutils literal"><span class="pre">#</span></code> means the key is not available and you&#8217;re still using
your regular home directory location).</p>
</div>
<div class="section" id="extending-key-expiration-date">
<h4>Extending key expiration date<a class="headerlink" href="#extending-key-expiration-date" title="Permalink to this headline">¶</a></h4>
<p>The master key has the default expiration date of 2 years from the date
of creation. This is done both for security reasons and to make obsolete
keys eventually disappear from keyservers.</p>
<p>To extend the expiration on your key by a year from current date, just
run:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --quick-set-expire [fpr] 1y
</pre></div>
</div>
<p>You can also use a specific date if that is easier to remember (e.g.
your birthday, January 1st, or Canada Day):</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --quick-set-expire [fpr] 2020-07-01
</pre></div>
</div>
<p>Remember to send the updated key back to keyservers:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --send-key [fpr]
</pre></div>
</div>
</div>
<div class="section" id="updating-your-work-directory-after-any-changes">
<h4>Updating your work directory after any changes<a class="headerlink" href="#updating-your-work-directory-after-any-changes" title="Permalink to this headline">¶</a></h4>
<p>After you make any changes to your key using the offline storage, you will
want to import these changes back into your regular working directory:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --export | gpg --homedir ~/.gnupg --import
$ unset GNUPGHOME
</pre></div>
</div>
</div>
<div class="section" id="using-gpg-agent-over-ssh">
<h4>Using gpg-agent over ssh<a class="headerlink" href="#using-gpg-agent-over-ssh" title="Permalink to this headline">¶</a></h4>
<p>You can forward your gpg-agent over ssh if you need to sign tags or
commits on a remote system. Please refer to the instructions provided
on the GnuPG wiki:</p>
<ul class="simple">
<li><a class="reference external" href="https://wiki.gnupg.org/AgentForwarding">Agent Forwarding over SSH</a></li>
</ul>
<p>It works more smoothly if you can modify the sshd server settings on the
remote end.</p>
</div>
</div>
</div>
<div class="section" id="using-pgp-with-git">
<h2>Using PGP with Git<a class="headerlink" href="#using-pgp-with-git" title="Permalink to this headline">¶</a></h2>
<p>One of the core features of Git is its decentralized nature &#8211; once a
repository is cloned to your system, you have full history of the
project, including all of its tags, commits and branches. However, with
hundreds of cloned repositories floating around, how does anyone verify
that their copy of linux.git has not been tampered with by a malicious
third party?</p>
<p>Or what happens if a backdoor is discovered in the code and the &#8220;Author&#8221;
line in the commit says it was done by you, while you&#8217;re pretty sure you
had <a class="reference external" href="https://github.com/jayphelps/git-blame-someone-else">nothing to do with it</a>?</p>
<p>To address both of these issues, Git introduced PGP integration. Signed
tags prove the repository integrity by assuring that its contents are
exactly the same as on the workstation of the developer who created the
tag, while signed commits make it nearly impossible for someone to
impersonate you without having access to your PGP keys.</p>
<div class="section" id="configure-git-to-use-your-pgp-key">
<h3>Configure git to use your PGP key<a class="headerlink" href="#configure-git-to-use-your-pgp-key" title="Permalink to this headline">¶</a></h3>
<p>If you only have one secret key in your keyring, then you don&#8217;t really
need to do anything extra, as it becomes your default key.  However, if
you happen to have multiple secret keys, you can tell git which key
should be used (<code class="docutils literal"><span class="pre">[fpr]</span></code> is the fingerprint of your key):</p>
<div class="highlight-none"><div class="highlight"><pre>$ git config --global user.signingKey [fpr]
</pre></div>
</div>
<p><strong>IMPORTANT</strong>: If you have a distinct <code class="docutils literal"><span class="pre">gpg2</span></code> command, then you should
tell git to always use it instead of the legacy <code class="docutils literal"><span class="pre">gpg</span></code> from version 1:</p>
<div class="highlight-none"><div class="highlight"><pre>$ git config --global gpg.program gpg2
$ git config --global gpgv.program gpgv2
</pre></div>
</div>
</div>
<div class="section" id="how-to-work-with-signed-tags">
<h3>How to work with signed tags<a class="headerlink" href="#how-to-work-with-signed-tags" title="Permalink to this headline">¶</a></h3>
<p>To create a signed tag, simply pass the <code class="docutils literal"><span class="pre">-s</span></code> switch to the tag
command:</p>
<div class="highlight-none"><div class="highlight"><pre>$ git tag -s [tagname]
</pre></div>
</div>
<p>Our recommendation is to always sign git tags, as this allows other
developers to ensure that the git repository they are pulling from has
not been maliciously altered.</p>
<div class="section" id="how-to-verify-signed-tags">
<h4>How to verify signed tags<a class="headerlink" href="#how-to-verify-signed-tags" title="Permalink to this headline">¶</a></h4>
<p>To verify a signed tag, simply use the <code class="docutils literal"><span class="pre">verify-tag</span></code> command:</p>
<div class="highlight-none"><div class="highlight"><pre>$ git verify-tag [tagname]
</pre></div>
</div>
<p>If you are pulling a tag from another fork of the project repository,
git should automatically verify the signature at the tip you&#8217;re pulling
and show you the results during the merge operation:</p>
<div class="highlight-none"><div class="highlight"><pre>$ git pull [url] tags/sometag
</pre></div>
</div>
<p>The merge message will contain something like this:</p>
<div class="highlight-none"><div class="highlight"><pre>Merge tag &#39;sometag&#39; of [url]

[Tag message]

# gpg: Signature made [...]
# gpg: Good signature from [...]
</pre></div>
</div>
<p>If you are verifying someone else&#8217;s git tag, then you will need to
import their PGP key. Please refer to the
&#8220;<a class="reference internal" href="#verify-identities"><span>How to verify kernel developer identities</span></a>&#8221; section below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you get &#8220;<code class="docutils literal"><span class="pre">gpg:</span> <span class="pre">Can't</span> <span class="pre">check</span> <span class="pre">signature:</span> <span class="pre">unknown</span> <span class="pre">pubkey</span>
<span class="pre">algorithm</span></code>&#8221; error, you need to tell git to use gpgv2 for
verification, so it properly processes signatures made by ECC keys.
See instructions at the start of this section.</p>
</div>
</div>
<div class="section" id="configure-git-to-always-sign-annotated-tags">
<h4>Configure git to always sign annotated tags<a class="headerlink" href="#configure-git-to-always-sign-annotated-tags" title="Permalink to this headline">¶</a></h4>
<p>Chances are, if you&#8217;re creating an annotated tag, you&#8217;ll want to sign
it. To force git to always sign annotated tags, you can set a global
configuration option:</p>
<div class="highlight-none"><div class="highlight"><pre>$ git config --global tag.forceSignAnnotated true
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-work-with-signed-commits">
<h3>How to work with signed commits<a class="headerlink" href="#how-to-work-with-signed-commits" title="Permalink to this headline">¶</a></h3>
<p>It is easy to create signed commits, but it is much more difficult to
use them in Linux kernel development, since it relies on patches sent to
the mailing list, and this workflow does not preserve PGP commit
signatures. Furthermore, when rebasing your repository to match
upstream, even your own PGP commit signatures will end up discarded. For
this reason, most kernel developers don&#8217;t bother signing their commits
and will ignore signed commits in any external repositories that they
rely upon in their work.</p>
<p>However, if you have your working git tree publicly available at some
git hosting service (kernel.org, infradead.org, ozlabs.org, or others),
then the recommendation is that you sign all your git commits even if
upstream developers do not directly benefit from this practice.</p>
<p>We recommend this for the following reasons:</p>
<ol class="arabic simple">
<li>Should there ever be a need to perform code forensics or track code
provenance, even externally maintained trees carrying PGP commit
signatures will be valuable for such purposes.</li>
<li>If you ever need to re-clone your local repository (for example,
after a disk failure), this lets you easily verify the repository
integrity before resuming your work.</li>
<li>If someone needs to cherry-pick your commits, this allows them to
quickly verify their integrity before applying them.</li>
</ol>
<div class="section" id="creating-signed-commits">
<h4>Creating signed commits<a class="headerlink" href="#creating-signed-commits" title="Permalink to this headline">¶</a></h4>
<p>To create a signed commit, you just need to pass the <code class="docutils literal"><span class="pre">-S</span></code> flag to the
<code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span></code> command (it&#8217;s capital <code class="docutils literal"><span class="pre">-S</span></code> due to collision with
another flag):</p>
<div class="highlight-none"><div class="highlight"><pre>$ git commit -S
</pre></div>
</div>
</div>
<div class="section" id="configure-git-to-always-sign-commits">
<h4>Configure git to always sign commits<a class="headerlink" href="#configure-git-to-always-sign-commits" title="Permalink to this headline">¶</a></h4>
<p>You can tell git to always sign commits:</p>
<div class="highlight-none"><div class="highlight"><pre>git config --global commit.gpgSign true
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure you configure <code class="docutils literal"><span class="pre">gpg-agent</span></code> before you turn this on.</p>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-verify-kernel-developer-identities">
<span id="verify-identities"></span><h2>How to verify kernel developer identities<a class="headerlink" href="#how-to-verify-kernel-developer-identities" title="Permalink to this headline">¶</a></h2>
<p>Signing tags and commits is easy, but how does one go about verifying
that the key used to sign something belongs to the actual kernel
developer and not to a malicious imposter?</p>
<div class="section" id="configure-auto-key-retrieval-using-wkd-and-dane">
<h3>Configure auto-key-retrieval using WKD and DANE<a class="headerlink" href="#configure-auto-key-retrieval-using-wkd-and-dane" title="Permalink to this headline">¶</a></h3>
<p>If you are not already someone with an extensive collection of other
developers&#8217; public keys, then you can jumpstart your keyring by relying
on key auto-discovery and auto-retrieval. GnuPG can piggyback on other
delegated trust technologies, namely DNSSEC and TLS, to get you going if
the prospect of starting your own Web of Trust from scratch is too
daunting.</p>
<p>Add the following to your <code class="docutils literal"><span class="pre">~/.gnupg/gpg.conf</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre>auto-key-locate wkd,dane,local
auto-key-retrieve
</pre></div>
</div>
<p>DNS-Based Authentication of Named Entities (&#8220;DANE&#8221;) is a method for
publishing public keys in DNS and securing them using DNSSEC signed
zones. Web Key Directory (&#8220;WKD&#8221;) is the alternative method that uses
https lookups for the same purpose. When using either DANE or WKD for
looking up public keys, GnuPG will validate DNSSEC or TLS certificates,
respectively, before adding auto-retrieved public keys to your local
keyring.</p>
<p>Kernel.org publishes the WKD for all developers who have kernel.org
accounts. Once you have the above changes in your <code class="docutils literal"><span class="pre">gpg.conf</span></code>, you can
auto-retrieve the keys for Linus Torvalds and Greg Kroah-Hartman (if you
don&#8217;t already have them):</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --locate-keys torvalds@kernel.org gregkh@kernel.org
</pre></div>
</div>
<p>If you have a kernel.org account, then you should <a class="reference external" href="https://korg.wiki.kernel.org/userdoc/mail#adding_a_kernelorg_uid_to_your_pgp_key">add the kernel.org
UID to your key</a> to make WKD more useful to other kernel developers.</p>
</div>
<div class="section" id="web-of-trust-wot-vs-trust-on-first-use-tofu">
<h3>Web of Trust (WOT) vs. Trust on First Use (TOFU)<a class="headerlink" href="#web-of-trust-wot-vs-trust-on-first-use-tofu" title="Permalink to this headline">¶</a></h3>
<p>PGP incorporates a trust delegation mechanism known as the &#8220;Web of
Trust.&#8221; At its core, this is an attempt to replace the need for
centralized Certification Authorities of the HTTPS/TLS world. Instead of
various software makers dictating who should be your trusted certifying
entity, PGP leaves this responsibility to each user.</p>
<p>Unfortunately, very few people understand how the Web of Trust works.
While it remains an important aspect of the OpenPGP specification,
recent versions of GnuPG (2.2 and above) have implemented an alternative
mechanism called &#8220;Trust on First Use&#8221; (TOFU). You can think of TOFU as
&#8220;the SSH-like approach to trust.&#8221; With SSH, the first time you connect
to a remote system, its key fingerprint is recorded and remembered. If
the key changes in the future, the SSH client will alert you and refuse
to connect, forcing you to make a decision on whether you choose to
trust the changed key or not. Similarly, the first time you import
someone&#8217;s PGP key, it is assumed to be valid. If at any point in the
future GnuPG comes across another key with the same identity, both the
previously imported key and the new key will be marked as invalid and
you will need to manually figure out which one to keep.</p>
<p>We recommend that you use the combined TOFU+PGP trust model (which is
the new default in GnuPG v2). To set it, add (or modify) the
<code class="docutils literal"><span class="pre">trust-model</span></code> setting in <code class="docutils literal"><span class="pre">~/.gnupg/gpg.conf</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre>trust-model tofu+pgp
</pre></div>
</div>
</div>
<div class="section" id="how-to-use-keyservers-more-safely">
<h3>How to use keyservers (more) safely<a class="headerlink" href="#how-to-use-keyservers-more-safely" title="Permalink to this headline">¶</a></h3>
<p>If you get a &#8220;No public key&#8221; error when trying to validate someone&#8217;s
tag, then you should attempt to lookup that key using a keyserver. It is
important to keep in mind that there is absolutely no guarantee that the
key you retrieve from PGP keyservers belongs to the actual person &#8211;
that much is by design. You are supposed to use the Web of Trust to
establish key validity.</p>
<p>How to properly maintain the Web of Trust is beyond the scope of this
document, simply because doing it properly requires both effort and
dedication that tends to be beyond the caring threshold of most human
beings. Here are some shortcuts that will help you reduce the risk of
importing a malicious key.</p>
<p>First, let&#8217;s say you&#8217;ve tried to run <code class="docutils literal"><span class="pre">git</span> <span class="pre">verify-tag</span></code> but it returned
an error saying the key is not found:</p>
<div class="highlight-none"><div class="highlight"><pre>$ git verify-tag sunxi-fixes-for-4.15-2
gpg: Signature made Sun 07 Jan 2018 10:51:55 PM EST
gpg:                using RSA key DA73759BF8619E484E5A3B47389A54219C0F2430
gpg:                issuer &quot;wens@...org&quot;
gpg: Can&#39;t check signature: No public key
</pre></div>
</div>
<p>Let&#8217;s query the keyserver for more info about that key fingerprint (the
fingerprint probably belongs to a subkey, so we can&#8217;t use it directly
without finding out the ID of the master key it is associated with):</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --search DA73759BF8619E484E5A3B47389A54219C0F2430
gpg: data source: hkp://keys.gnupg.net
(1) Chen-Yu Tsai &lt;wens@...org&gt;
      4096 bit RSA key C94035C21B4F2AEB, created: 2017-03-14, expires: 2019-03-15
Keys 1-1 of 1 for &quot;DA73759BF8619E484E5A3B47389A54219C0F2430&quot;.  Enter number(s), N)ext, or Q)uit &gt; q
</pre></div>
</div>
<p>Locate the ID of the master key in the output, in our example
<code class="docutils literal"><span class="pre">C94035C21B4F2AEB</span></code>. Now display the key of Linus Torvalds that you
have on your keyring:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --list-key torvalds@kernel.org
pub   rsa2048 2011-09-20 [SC]
      ABAF11C65A2970B130ABE3C479BE3E4300411886
uid           [ unknown] Linus Torvalds &lt;torvalds@kernel.org&gt;
sub   rsa2048 2011-09-20 [E]
</pre></div>
</div>
<p>Next, open the <a class="reference external" href="https://pgp.cs.uu.nl/">PGP pathfinder</a>. In the &#8220;From&#8221; field, paste the key
fingerprint of Linus Torvalds from the output above. In the &#8220;To&#8221; field,
paste they key-id you found via <code class="docutils literal"><span class="pre">gpg</span> <span class="pre">--search</span></code> of the unknown key, and
check the results:</p>
<ul class="simple">
<li><a class="reference external" href="https://pgp.cs.uu.nl/paths/79BE3E4300411886/to/C94035C21B4F2AEB.html">Finding paths to Linus</a></li>
</ul>
<p>If you get a few decent trust paths, then it&#8217;s a pretty good indication
that it is a valid key. You can add it to your keyring from the
keyserver now:</p>
<div class="highlight-none"><div class="highlight"><pre>$ gpg --recv-key C94035C21B4F2AEB
</pre></div>
</div>
<p>This process is not perfect, and you are obviously trusting the
administrators of the PGP Pathfinder service to not be malicious (in
fact, this goes against <a class="reference internal" href="#devs-not-infra"><span>Trusting the developers, not infrastructure</span></a>). However, if you
do not carefully maintain your own web of trust, then it is a marked
improvement over blindly trusting keyservers.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="email-clients.html" class="btn btn-neutral float-right" title="Email clients info for Linux" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coding-style.html" class="btn btn-neutral" title="Linux kernel coding style" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>