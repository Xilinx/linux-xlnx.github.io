

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>batman-adv &mdash; The Linux Kernel  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html"/>
        <link rel="up" title="Linux Networking Documentation" href="index.html"/>
        <link rel="next" title="SocketCAN - Controller Area Network" href="can.html"/>
        <link rel="prev" title="AF_XDP" href="af_xdp.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.19.0-xilinx-v2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user&#8217;s and administrator&#8217;s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer&#8217;s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux Networking Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="netdev-FAQ.html">netdev FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="af_xdp.html">AF_XDP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">batman-adv</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logging-debugging">Logging/Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#batctl">batctl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contact">Contact</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="dpaa2/index.html">DPAA2 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="e100.html">Linux* Base Driver for the Intel(R) PRO/100 Family of Adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="e1000.html">Linux* Base Driver for Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="z8530book.html">Z8530 Programming Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="failover.html">FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="alias.html">IP-Aliasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridge.html">Ethernet Bridging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Linux Filesystems API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Filesystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">The Linux Kernel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Linux Networking Documentation</a> &raquo;</li>
      
    <li>batman-adv</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/networking/batman-adv.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="batman-adv">
<h1>batman-adv<a class="headerlink" href="#batman-adv" title="Permalink to this headline">¶</a></h1>
<p>Batman advanced is a new approach to wireless networking which does no longer
operate on the IP basis. Unlike the batman daemon, which exchanges information
using UDP packets and sets routing tables, batman-advanced operates on ISO/OSI
Layer 2 only and uses and routes (or better: bridges) Ethernet Frames. It
emulates a virtual network switch of all nodes participating. Therefore all
nodes appear to be link local, thus all higher operating protocols won&#8217;t be
affected by any changes within the network. You can run almost any protocol
above batman advanced, prominent examples are: IPv4, IPv6, DHCP, IPX.</p>
<p>Batman advanced was implemented as a Linux kernel driver to reduce the overhead
to a minimum. It does not depend on any (other) network driver, and can be used
on wifi as well as ethernet lan, vpn, etc ... (anything with ethernet-style
layer 2).</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Load the batman-adv module into your kernel:</p>
<div class="highlight-none"><div class="highlight"><pre>$ insmod batman-adv.ko
</pre></div>
</div>
<p>The module is now waiting for activation. You must add some interfaces on which
batman can operate. After loading the module batman advanced will scan your
systems interfaces to search for compatible interfaces. Once found, it will
create subfolders in the <code class="docutils literal"><span class="pre">/sys</span></code> directories of each supported interface,
e.g.:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ls /sys/class/net/eth0/batman_adv/
elp_interval iface_status mesh_iface throughput_override
</pre></div>
</div>
<p>If an interface does not have the <code class="docutils literal"><span class="pre">batman_adv</span></code> subfolder, it probably is not
supported. Not supported interfaces are: loopback, non-ethernet and batman&#8217;s
own interfaces.</p>
<p>Note: After the module was loaded it will continuously watch for new
interfaces to verify the compatibility. There is no need to reload the module
if you plug your USB wifi adapter into your machine after batman advanced was
initially loaded.</p>
<p>The batman-adv soft-interface can be created using the iproute2 tool <code class="docutils literal"><span class="pre">ip</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ip link add name bat0 type batadv
</pre></div>
</div>
<p>To activate a given interface simply attach it to the <code class="docutils literal"><span class="pre">bat0</span></code> interface:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ip link set dev eth0 master bat0
</pre></div>
</div>
<p>Repeat this step for all interfaces you wish to add. Now batman starts
using/broadcasting on this/these interface(s).</p>
<p>By reading the &#8220;iface_status&#8221; file you can check its status:</p>
<div class="highlight-none"><div class="highlight"><pre>$ cat /sys/class/net/eth0/batman_adv/iface_status
active
</pre></div>
</div>
<p>To deactivate an interface you have to detach it from the &#8220;bat0&#8221; interface:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ip link set dev eth0 nomaster
</pre></div>
</div>
<p>All mesh wide settings can be found in batman&#8217;s own interface folder:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ls /sys/class/net/bat0/mesh/
aggregated_ogms       fragmentation isolation_mark routing_algo
ap_isolation          gw_bandwidth  log_level      vlan0
bonding               gw_mode       multicast_mode
bridge_loop_avoidance gw_sel_class  network_coding
distributed_arp_table hop_penalty   orig_interval
</pre></div>
</div>
<p>There is a special folder for debugging information:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ls /sys/kernel/debug/batman_adv/bat0/
bla_backbone_table log         neighbors         transtable_local
bla_claim_table    mcast_flags originators
dat_cache          nc          socket
gateways           nc_nodes    transtable_global
</pre></div>
</div>
<p>Some of the files contain all sort of status information regarding the mesh
network. For example, you can view the table of originators (mesh
participants) with:</p>
<div class="highlight-none"><div class="highlight"><pre>$ cat /sys/kernel/debug/batman_adv/bat0/originators
</pre></div>
</div>
<p>Other files allow to change batman&#8217;s behaviour to better fit your requirements.
For instance, you can check the current originator interval (value in
milliseconds which determines how often batman sends its broadcast packets):</p>
<div class="highlight-none"><div class="highlight"><pre>$ cat /sys/class/net/bat0/mesh/orig_interval
1000
</pre></div>
</div>
<p>and also change its value:</p>
<div class="highlight-none"><div class="highlight"><pre>$ echo 3000 &gt; /sys/class/net/bat0/mesh/orig_interval
</pre></div>
</div>
<p>In very mobile scenarios, you might want to adjust the originator interval to a
lower value. This will make the mesh more responsive to topology changes, but
will also increase the overhead.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>To make use of your newly created mesh, batman advanced provides a new
interface &#8220;bat0&#8221; which you should use from this point on. All interfaces added
to batman advanced are not relevant any longer because batman handles them for
you. Basically, one &#8220;hands over&#8221; the data by using the batman interface and
batman will make sure it reaches its destination.</p>
<p>The &#8220;bat0&#8221; interface can be used like any other regular interface. It needs an
IP address which can be either statically configured or dynamically (by using
DHCP or similar services):</p>
<div class="highlight-none"><div class="highlight"><pre>NodeA: ip link set up dev bat0
NodeA: ip addr add 192.168.0.1/24 dev bat0

NodeB: ip link set up dev bat0
NodeB: ip addr add 192.168.0.2/24 dev bat0
NodeB: ping 192.168.0.1
</pre></div>
</div>
<p>Note: In order to avoid problems remove all IP addresses previously assigned to
interfaces now used by batman advanced, e.g.:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ip addr flush dev eth0
</pre></div>
</div>
</div>
<div class="section" id="logging-debugging">
<h2>Logging/Debugging<a class="headerlink" href="#logging-debugging" title="Permalink to this headline">¶</a></h2>
<p>All error messages, warnings and information messages are sent to the kernel
log. Depending on your operating system distribution this can be read in one of
a number of ways. Try using the commands: <code class="docutils literal"><span class="pre">dmesg</span></code>, <code class="docutils literal"><span class="pre">logread</span></code>, or looking in
the files <code class="docutils literal"><span class="pre">/var/log/kern.log</span></code> or <code class="docutils literal"><span class="pre">/var/log/syslog</span></code>. All batman-adv messages
are prefixed with &#8220;batman-adv:&#8221; So to see just these messages try:</p>
<div class="highlight-none"><div class="highlight"><pre>$ dmesg | grep batman-adv
</pre></div>
</div>
<p>When investigating problems with your mesh network, it is sometimes necessary to
see more detail debug messages. This must be enabled when compiling the
batman-adv module. When building batman-adv as part of kernel, use &#8220;make
menuconfig&#8221; and enable the option <code class="docutils literal"><span class="pre">B.A.T.M.A.N.</span> <span class="pre">debugging</span></code>
(<code class="docutils literal"><span class="pre">CONFIG_BATMAN_ADV_DEBUG=y</span></code>).</p>
<p>Those additional debug messages can be accessed using a special file in
debugfs:</p>
<div class="highlight-none"><div class="highlight"><pre>$ cat /sys/kernel/debug/batman_adv/bat0/log
</pre></div>
</div>
<p>The additional debug output is by default disabled. It can be enabled during
run time. Following log_levels are defined:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>0</td>
<td>All debug output disabled</td>
</tr>
<tr class="row-even"><td>1</td>
<td>Enable messages related to routing / flooding / broadcasting</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Enable messages related to route added / changed / deleted</td>
</tr>
<tr class="row-even"><td>4</td>
<td>Enable messages related to translation table operations</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>Enable messages related to bridge loop avoidance</td>
</tr>
<tr class="row-even"><td>16</td>
<td>Enable messages related to DAT, ARP snooping and parsing</td>
</tr>
<tr class="row-odd"><td>32</td>
<td>Enable messages related to network coding</td>
</tr>
<tr class="row-even"><td>64</td>
<td>Enable messages related to multicast</td>
</tr>
<tr class="row-odd"><td>128</td>
<td>Enable messages related to throughput meter</td>
</tr>
<tr class="row-even"><td>255</td>
<td>Enable all messages</td>
</tr>
</tbody>
</table>
<p>The debug output can be changed at runtime using the file
<code class="docutils literal"><span class="pre">/sys/class/net/bat0/mesh/log_level</span></code>. e.g.:</p>
<div class="highlight-none"><div class="highlight"><pre>$ echo 6 &gt; /sys/class/net/bat0/mesh/log_level
</pre></div>
</div>
<p>will enable debug messages for when routes change.</p>
<p>Counters for different types of packets entering and leaving the batman-adv
module are available through ethtool:</p>
<div class="highlight-none"><div class="highlight"><pre>$ ethtool --statistics bat0
</pre></div>
</div>
</div>
<div class="section" id="batctl">
<h2>batctl<a class="headerlink" href="#batctl" title="Permalink to this headline">¶</a></h2>
<p>As batman advanced operates on layer 2, all hosts participating in the virtual
switch are completely transparent for all protocols above layer 2. Therefore
the common diagnosis tools do not work as expected. To overcome these problems,
batctl was created. At the moment the batctl contains ping, traceroute, tcpdump
and interfaces to the kernel module settings.</p>
<p>For more information, please see the manpage (<code class="docutils literal"><span class="pre">man</span> <span class="pre">batctl</span></code>).</p>
<p>batctl is available on <a class="reference external" href="https://www.open-mesh.org/">https://www.open-mesh.org/</a></p>
</div>
<div class="section" id="contact">
<h2>Contact<a class="headerlink" href="#contact" title="Permalink to this headline">¶</a></h2>
<p>Please send us comments, experiences, questions, anything :)</p>
<dl class="docutils">
<dt>IRC:</dt>
<dd>#batman on irc.freenode.org</dd>
<dt>Mailing-list:</dt>
<dd><a class="reference external" href="mailto:b&#46;a&#46;t&#46;m&#46;a&#46;n&#37;&#52;&#48;open-mesh&#46;org">b<span>&#46;</span>a<span>&#46;</span>t<span>&#46;</span>m<span>&#46;</span>a<span>&#46;</span>n<span>&#64;</span>open-mesh<span>&#46;</span>org</a> (optional subscription at
<a class="reference external" href="https://lists.open-mesh.org/mm/listinfo/b.a.t.m.a.n">https://lists.open-mesh.org/mm/listinfo/b.a.t.m.a.n</a>)</dd>
</dl>
<p>You can also contact the Authors:</p>
<ul class="simple">
<li>Marek Lindner &lt;<a class="reference external" href="mailto:mareklindner&#37;&#52;&#48;neomailbox&#46;ch">mareklindner<span>&#64;</span>neomailbox<span>&#46;</span>ch</a>&gt;</li>
<li>Simon Wunderlich &lt;<a class="reference external" href="mailto:sw&#37;&#52;&#48;simonwunderlich&#46;de">sw<span>&#64;</span>simonwunderlich<span>&#46;</span>de</a>&gt;</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="can.html" class="btn btn-neutral float-right" title="SocketCAN - Controller Area Network" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="af_xdp.html" class="btn btn-neutral" title="AF_XDP" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>