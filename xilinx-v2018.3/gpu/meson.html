

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>drm/meson AmLogic Meson Video Processing Unit &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="drm/pl111 ARM PrimeCell PL111 CLCD Driver" href="pl111.html" />
    <link rel="prev" title="drm/i915 Intel GFX Driver" href="i915.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.14.0-xilinx-v2018.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux GPU Driver Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-internals.html">DRM Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-mm.html">DRM Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms.html">Kernel Mode Setting (KMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms-helpers.html">Mode Setting Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-uapi.html">Userland interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="i915.html">drm/i915 Intel GFX Driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">drm/meson AmLogic Meson Video Processing Unit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#video-processing-unit">Video Processing Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#video-input-unit">Video Input Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#video-post-processing">Video Post Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#video-encoder">Video Encoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#video-canvas-management">Video Canvas Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#video-clocks">Video Clocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hdmi-video-output">HDMI Video Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pl111.html">drm/pl111 ARM PrimeCell PL111 CLCD Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="tegra.html">drm/tegra NVIDIA Tegra GPU and display driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="tinydrm.html">drm/tinydrm Driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="vc4.html">drm/vc4 Broadcom VC4 Graphics Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-switcheroo.html">VGA Switcheroo</a></li>
<li class="toctree-l2"><a class="reference internal" href="vgaarbiter.html">VGA Arbiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridge/dw-hdmi.html">drm/bridge/dw-hdmi Synopsys DesignWare HDMI Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="todo.html">TODO list</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Linux Filesystems API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/ja_JP/index.html">Japanese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Linux GPU Driver Developer’s Guide</a> &raquo;</li>
        
      <li>drm/meson AmLogic Meson Video Processing Unit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gpu/meson.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="drm-meson-amlogic-meson-video-processing-unit">
<h1>drm/meson AmLogic Meson Video Processing Unit<a class="headerlink" href="#drm-meson-amlogic-meson-video-processing-unit" title="Permalink to this headline">¶</a></h1>
<p>VPU Handles the Global Video Processing, it includes management of the
clocks gates, blocks reset lines and power domains.</p>
<p>What is missing :</p>
<ul class="simple">
<li>Full reset of entire video processing HW blocks</li>
<li>Scaling and setup of the VPU clock</li>
<li>Bus clock gates</li>
<li>Powering up video processing HW blocks</li>
<li>Powering Up HDMI controller and PHY</li>
</ul>
<div class="section" id="video-processing-unit">
<h2>Video Processing Unit<a class="headerlink" href="#video-processing-unit" title="Permalink to this headline">¶</a></h2>
<p>The Amlogic Meson Display controller is composed of several components
that are going to be documented below:</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>DMC|---------------VPU (Video Processing Unit)----------------|------HHI------|
   | vd1   _______     _____________    _________________     |               |
D  |-------|      |----|            |   |                |    |   HDMI PLL    |
D  | vd2   | VIU  |    | Video Post |   | Video Encoders |&lt;---|-----VCLK      |
R  |-------|      |----| Processing |   |                |    |               |
   | osd2  |      |    |            |---| Enci ----------|----|-----VDAC------|
R  |-------| CSC  |----| Scalers    |   | Encp ----------|----|----HDMI-TX----|
A  | osd1  |      |    | Blenders   |   | Encl ----------|----|---------------|
M  |-------|______|----|____________|   |________________|    |               |
___|__________________________________________________________|_______________|
</pre></div>
</div>
</div>
<div class="section" id="video-input-unit">
<h2>Video Input Unit<a class="headerlink" href="#video-input-unit" title="Permalink to this headline">¶</a></h2>
<p>VIU Handles the Pixel scanout and the basic Colorspace conversions
We handle the following features :</p>
<ul class="simple">
<li>OSD1 RGB565/RGB888/xRGB8888 scanout</li>
<li>RGB conversion to x/cb/cr</li>
<li>Progressive or Interlace buffer scanout</li>
<li>OSD1 Commit on Vsync</li>
<li>HDR OSD matrix for GXL/GXM</li>
</ul>
<p>What is missing :</p>
<ul class="simple">
<li>BGR888/xBGR8888/BGRx8888/BGRx8888 modes</li>
<li>YUV4:2:2 Y0CbY1Cr scanout</li>
<li>Conversion to YUV 4:4:4 from 4:2:2 input</li>
<li>Colorkey Alpha matching</li>
<li>Big endian scanout</li>
<li>X/Y reverse scanout</li>
<li>Global alpha setup</li>
<li>OSD2 support, would need interlace switching on vsync</li>
<li>OSD1 full scaling to support TV overscan</li>
</ul>
</div>
<div class="section" id="video-post-processing">
<h2>Video Post Processing<a class="headerlink" href="#video-post-processing" title="Permalink to this headline">¶</a></h2>
<p>VPP Handles all the Post Processing after the Scanout from the VIU
We handle the following post processings :</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Postblend, Blends the OSD1 only</dt>
<dd>We exclude OSD2, VS1, VS1 and Preblend output</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Vertical OSD Scaler for OSD1 only, we disable vertical scaler and</dt>
<dd>use it only for interlace scanout</dd>
</dl>
</li>
<li>Intermediate FIFO with default Amlogic values</li>
</ul>
<p>What is missing :</p>
<ul class="simple">
<li>Preblend for video overlay pre-scaling</li>
<li>OSD2 support for cursor framebuffer</li>
<li>Video pre-scaling before postblend</li>
<li>Full Vertical/Horizontal OSD scaling to support TV overscan</li>
<li>HDR conversion</li>
</ul>
</div>
<div class="section" id="video-encoder">
<h2>Video Encoder<a class="headerlink" href="#video-encoder" title="Permalink to this headline">¶</a></h2>
<p>VENC Handle the pixels encoding to the output formats.
We handle the following encodings :</p>
<ul class="simple">
<li>CVBS Encoding via the ENCI encoder and VDAC digital to analog converter</li>
<li>TMDS/HDMI Encoding via ENCI_DIV and ENCP</li>
<li>Setup of more clock rates for HDMI modes</li>
</ul>
<p>What is missing :</p>
<ul class="simple">
<li>LCD Panel encoding via ENCL</li>
<li>TV Panel encoding via ENCT</li>
</ul>
<p>VENC paths :</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>       _____   _____   ____________________
vd1---|     |-|     | | VENC     /---------|----VDAC
vd2---| VIU |-| VPP |-|-----ENCI/-ENCI_DVI-|-|
osd1--|     |-|     | | \                  | X--HDMI-TX
osd2--|_____|-|_____| |  |\-ENCP--ENCP_DVI-|-|
                      |  |                 |
                      |  \--ENCL-----------|----LVDS
                      |____________________|
</pre></div>
</div>
<p>The ENCI is designed for PAl or NTSC encoding and can go through the VDAC
directly for CVBS encoding or through the ENCI_DVI encoder for HDMI.
The ENCP is designed for Progressive encoding but can also generate
1080i interlaced pixels, and was initialy desined to encode pixels for
VDAC to output RGB ou YUV analog outputs.
It’s output is only used through the ENCP_DVI encoder for HDMI.
The ENCL LVDS encoder is not implemented.</p>
<p>The ENCI and ENCP encoders needs specially defined parameters for each
supported mode and thus cannot be determined from standard video timings.</p>
<p>The ENCI end ENCP DVI encoders are more generic and can generate any timings
from the pixel data generated by ENCI or ENCP, so can use the standard video
timings are source for HW parameters.</p>
</div>
<div class="section" id="video-canvas-management">
<h2>Video Canvas Management<a class="headerlink" href="#video-canvas-management" title="Permalink to this headline">¶</a></h2>
<p>CANVAS is a memory zone where physical memory frames information
are stored for the VIU to scanout.</p>
</div>
<div class="section" id="video-clocks">
<h2>Video Clocks<a class="headerlink" href="#video-clocks" title="Permalink to this headline">¶</a></h2>
<p>VCLK is the “Pixel Clock” frequency generator from a dedicated PLL.
We handle the following encodings :</p>
<ul class="simple">
<li>CVBS 27MHz generator via the VCLK2 to the VENCI and VDAC blocks</li>
<li>HDMI Pixel Clocks generation</li>
</ul>
<p>What is missing :</p>
<ul class="simple">
<li>Genenate Pixel clocks for 2K/4K 10bit formats</li>
</ul>
<p>Clock generator scheme :</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span> __________   _________            _____
|          | |         |          |     |--ENCI
| HDMI PLL |-| PLL_DIV |--- VCLK--|     |--ENCL
|__________| |_________| \        | MUX |--ENCP
                          --VCLK2-|     |--VDAC
                                  |_____|--HDMI-TX
</pre></div>
</div>
<p>Final clocks can take input for either VCLK or VCLK2, but
VCLK is the preferred path for HDMI clocking and VCLK2 is the
preferred path for CVBS VDAC clocking.</p>
<p>VCLK and VCLK2 have fixed divided clocks paths for /1, /2, /4, /6 or /12.</p>
<p>The PLL_DIV can achieve an additional fractional dividing like
1.5, 3.5, 3.75… to generate special 2K and 4K 10bit clocks.</p>
</div>
<div class="section" id="hdmi-video-output">
<h2>HDMI Video Output<a class="headerlink" href="#hdmi-video-output" title="Permalink to this headline">¶</a></h2>
<p>HDMI Output is composed of :</p>
<ul class="simple">
<li>A Synopsys DesignWare HDMI Controller IP</li>
<li>A TOP control block controlling the Clocks and PHY</li>
<li>A custom HDMI PHY in order convert video to TMDS signal</li>
</ul>
<div class="code highlight-none"><div class="highlight"><pre><span></span> ___________________________________
|            HDMI TOP               |&lt;= HPD
|___________________________________|
|                  |                |
|  Synopsys HDMI   |   HDMI PHY     |=&gt; TMDS
|    Controller    |________________|
|___________________________________|&lt;=&gt; DDC
</pre></div>
</div>
<p>The HDMI TOP block only supports HPD sensing.
The Synopsys HDMI Controller interrupt is routed
through the TOP Block interrupt.
Communication to the TOP Block and the Synopsys
HDMI Controller is done a pair of addr+read/write
registers.
The HDMI PHY is configured by registers in the
HHI register block.</p>
<p>Pixel data arrives in 4:4:4 format from the VENC
block and the VPU HDMI mux selects either the ENCI
encoder for the 576i or 480i formats or the ENCP
encoder for all the other formats including
interlaced HD formats.
The VENC uses a DVI encoder on top of the ENCI
or ENCP encoders to generate DVI timings for the
HDMI controller.</p>
<p>GXBB, GXL and GXM embeds the Synopsys DesignWare
HDMI TX IP version 2.01a with HDCP and I2C &amp; S/PDIF
audio source interfaces.</p>
<p>We handle the following features :</p>
<ul class="simple">
<li>HPD Rise &amp; Fall interrupt</li>
<li>HDMI Controller Interrupt</li>
<li>HDMI PHY Init for 480i to 1080p60</li>
<li>VENC &amp; HDMI Clock setup for 480i to 1080p60</li>
<li>VENC Mode setup for 480i to 1080p60</li>
</ul>
<p>What is missing :</p>
<ul class="simple">
<li>PHY, Clock and Mode setup for 2k &amp;&amp; 4k modes</li>
<li>SDDC Scrambling mode for HDMI 2.0a</li>
<li>HDCP Setup</li>
<li>CEC Management</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pl111.html" class="btn btn-neutral float-right" title="drm/pl111 ARM PrimeCell PL111 CLCD Driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="i915.html" class="btn btn-neutral" title="drm/i915 Intel GFX Driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>