

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.3. ioctl VIDIOC_CREATE_BUFS &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="7.4. ioctl VIDIOC_CROPCAP" href="vidioc-cropcap.html" />
    <link rel="prev" title="7.2. V4L2 ioctl()" href="func-ioctl.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.14.0-xilinx-v2018.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../media_uapi.html">Linux Media Infrastructure userspace API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="v4l2.html">Part I - Video for Linux API</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="common.html">1. Common API Elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="pixfmt.html">2. Image Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html">3. Input/Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="devices.html">4. Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="libv4l.html">5. Libv4l Userspace Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="compat.html">6. Changes</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="user-func.html">7. Function Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="common-defs.html">8. Common definitions for V4L2 and V4L2 subdev interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="videodev.html">9. Video For Linux Two Header File</a></li>
<li class="toctree-l4"><a class="reference internal" href="capture-example.html">10. Video Capture Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2grab-example.html">11. Video Grabber example using libv4l</a></li>
<li class="toctree-l4"><a class="reference internal" href="biblio.html">12. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2.html#revision-and-copyright">Revision and Copyright</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2.html#revision-history">Revision History</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dvb/dvbapi.html">Part II - Digital TV API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rc/remote_controllers.html">Part III - Remote Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mediactl/media-controller.html">Part IV - Media Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cec/cec-api.html">Part V - Consumer Electronics Control API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gen-errors.html">Generic Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fdl-appendix.html">GNU Free Documentation License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Linux Filesystems API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/ja_JP/index.html">Japanese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="../../media_uapi.html">Linux Media Infrastructure userspace API</a> &raquo;</li>
        
          <li><a href="v4l2.html">Part I - Video for Linux API</a> &raquo;</li>
        
          <li><a href="user-func.html">7. Function Reference</a> &raquo;</li>
        
      <li>7.3. ioctl VIDIOC_CREATE_BUFS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/media/uapi/v4l/vidioc-create-bufs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ioctl-vidioc-create-bufs">
<span id="vidioc-create-bufs"></span><h1>7.3. ioctl VIDIOC_CREATE_BUFS<a class="headerlink" href="#ioctl-vidioc-create-bufs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="name">
<h2>7.3.1. Name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<p>VIDIOC_CREATE_BUFS - Create buffers for Memory Mapped or User Pointer or DMA Buffer I/O</p>
</div>
<div class="section" id="synopsis">
<h2>7.3.2. Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.VIDIOC_CREATE_BUFS">
int <code class="descname">ioctl</code><span class="sig-paren">(</span>int<em>&nbsp;fd</em>, <a class="reference internal" href="#c.VIDIOC_CREATE_BUFS" title="VIDIOC_CREATE_BUFS">VIDIOC_CREATE_BUFS</a>, struct <a class="reference internal" href="#c.v4l2_create_buffers" title="v4l2_create_buffers">v4l2_create_buffers</a><em>&nbsp;*argp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.VIDIOC_CREATE_BUFS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="arguments">
<h2>7.3.3. Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">fd</span></code></dt>
<dd>File descriptor returned by <a class="reference internal" href="func-open.html#func-open"><span class="std std-ref">open()</span></a>.</dd>
<dt><code class="docutils literal"><span class="pre">argp</span></code></dt>
<dd>Pointer to struct <a class="reference internal" href="#c.v4l2_create_buffers" title="v4l2_create_buffers"><code class="xref c c-type docutils literal"><span class="pre">v4l2_create_buffers</span></code></a>.</dd>
</dl>
</div>
<div class="section" id="description">
<h2>7.3.4. Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This ioctl is used to create buffers for <a class="reference internal" href="mmap.html#mmap"><span class="std std-ref">memory mapped</span></a>
or <a class="reference internal" href="userp.html#userp"><span class="std std-ref">user pointer</span></a> or <a class="reference internal" href="dmabuf.html#dmabuf"><span class="std std-ref">DMA buffer</span></a> I/O. It
can be used as an alternative or in addition to the
<a class="reference internal" href="vidioc-reqbufs.html#vidioc-reqbufs"><span class="std std-ref">ioctl VIDIOC_REQBUFS</span></a> ioctl, when a tighter control
over buffers is required. This ioctl can be called multiple times to
create buffers of different sizes.</p>
<p>To allocate the device buffers applications must initialize the relevant
fields of the struct <a class="reference internal" href="#c.v4l2_create_buffers" title="v4l2_create_buffers"><code class="xref c c-type docutils literal"><span class="pre">v4l2_create_buffers</span></code></a> structure. The
<code class="docutils literal"><span class="pre">count</span></code> field must be set to the number of requested buffers, the
<code class="docutils literal"><span class="pre">memory</span></code> field specifies the requested I/O method and the <code class="docutils literal"><span class="pre">reserved</span></code>
array must be zeroed.</p>
<p>The <code class="docutils literal"><span class="pre">format</span></code> field specifies the image format that the buffers must be
able to handle. The application has to fill in this struct
<a class="reference internal" href="vidioc-g-fmt.html#c.v4l2_format" title="v4l2_format"><code class="xref c c-type docutils literal"><span class="pre">v4l2_format</span></code></a>. Usually this will be done using the
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_TRY_FMT</span></a> or
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_G_FMT</span></a> ioctls to ensure that the
requested format is supported by the driver. Based on the format’s
<code class="docutils literal"><span class="pre">type</span></code> field the requested buffer size (for single-planar) or plane
sizes (for multi-planar formats) will be used for the allocated buffers.
The driver may return an error if the size(s) are not supported by the
hardware (usually because they are too small).</p>
<p>The buffers created by this ioctl will have as minimum size the size
defined by the <code class="docutils literal"><span class="pre">format.pix.sizeimage</span></code> field (or the corresponding
fields for other format types). Usually if the <code class="docutils literal"><span class="pre">format.pix.sizeimage</span></code>
field is less than the minimum required for the given format, then an
error will be returned since drivers will typically not allow this. If
it is larger, then the value will be used as-is. In other words, the
driver may reject the requested size, but if it is accepted the driver
will use it unchanged.</p>
<p>When the ioctl is called with a pointer to this structure the driver
will attempt to allocate up to the requested number of buffers and store
the actual number allocated and the starting index in the <code class="docutils literal"><span class="pre">count</span></code> and
the <code class="docutils literal"><span class="pre">index</span></code> fields respectively. On return <code class="docutils literal"><span class="pre">count</span></code> can be smaller
than the number requested.</p>
<dl class="type">
<dt id="c.v4l2_create_buffers">
<code class="descname">v4l2_create_buffers</code><a class="headerlink" href="#c.v4l2_create_buffers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">struct v4l2_create_buffers</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>__u32</td>
<td><code class="docutils literal"><span class="pre">index</span></code></td>
<td>The starting buffer index, returned by the driver.</td>
</tr>
<tr class="row-even"><td>__u32</td>
<td><code class="docutils literal"><span class="pre">count</span></code></td>
<td>The number of buffers requested or granted. If count == 0, then
<a class="reference internal" href="#vidioc-create-bufs"><span class="std std-ref">ioctl VIDIOC_CREATE_BUFS</span></a> will set <code class="docutils literal"><span class="pre">index</span></code> to the current number of
created buffers, and it will check the validity of <code class="docutils literal"><span class="pre">memory</span></code> and
<code class="docutils literal"><span class="pre">format.type</span></code>. If those are invalid -1 is returned and errno is
set to <code class="docutils literal"><span class="pre">EINVAL</span></code> error code, otherwise <a class="reference internal" href="#vidioc-create-bufs"><span class="std std-ref">ioctl VIDIOC_CREATE_BUFS</span></a> returns
0. It will never set errno to <code class="docutils literal"><span class="pre">EBUSY</span></code> error code in this particular
case.</td>
</tr>
<tr class="row-odd"><td>__u32</td>
<td><code class="docutils literal"><span class="pre">memory</span></code></td>
<td>Applications set this field to <code class="docutils literal"><span class="pre">V4L2_MEMORY_MMAP</span></code>,
<code class="docutils literal"><span class="pre">V4L2_MEMORY_DMABUF</span></code> or <code class="docutils literal"><span class="pre">V4L2_MEMORY_USERPTR</span></code>. See
<a class="reference internal" href="buffer.html#c.v4l2_memory" title="v4l2_memory"><code class="xref c c-type docutils literal"><span class="pre">v4l2_memory</span></code></a></td>
</tr>
<tr class="row-even"><td>struct <a class="reference internal" href="vidioc-g-fmt.html#c.v4l2_format" title="v4l2_format"><code class="xref c c-type docutils literal"><span class="pre">v4l2_format</span></code></a></td>
<td><code class="docutils literal"><span class="pre">format</span></code></td>
<td>Filled in by the application, preserved by the driver.</td>
</tr>
<tr class="row-odd"><td>__u32</td>
<td><code class="docutils literal"><span class="pre">reserved</span></code>[8]</td>
<td>A place holder for future extensions. Drivers and applications
must set the array to zero.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="return-value">
<h2>7.3.5. Return Value<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h2>
<p>On success 0 is returned, on error -1 and the <code class="docutils literal"><span class="pre">errno</span></code> variable is set
appropriately. The generic error codes are described at the
<a class="reference internal" href="../gen-errors.html#id1"><span class="std std-ref">Generic Error Codes</span></a> chapter.</p>
<dl class="docutils">
<dt>ENOMEM</dt>
<dd>No memory to allocate buffers for <a class="reference internal" href="mmap.html#mmap"><span class="std std-ref">memory mapped</span></a> I/O.</dd>
<dt>EINVAL</dt>
<dd>The buffer type (<code class="docutils literal"><span class="pre">format.type</span></code> field), requested I/O method
(<code class="docutils literal"><span class="pre">memory</span></code>) or format (<code class="docutils literal"><span class="pre">format</span></code> field) is not valid.</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vidioc-cropcap.html" class="btn btn-neutral float-right" title="7.4. ioctl VIDIOC_CROPCAP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="func-ioctl.html" class="btn btn-neutral" title="7.2. V4L2 ioctl()" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>