

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. Examples &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="8. Digital TV uAPI header files" href="headers.html" />
    <link rel="prev" title="6.3.2.23. AUDIO_SET_KARAOKE" href="audio-set-karaoke.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.14.0-xilinx-v2018.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../media_uapi.html">Linux Media Infrastructure userspace API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../v4l/v4l2.html">Part I - Video for Linux API</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="dvbapi.html">Part II - Digital TV API</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="frontend.html">2. Digital TV Frontend API</a></li>
<li class="toctree-l4"><a class="reference internal" href="demux.html">3. Digital TV Demux Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="ca.html">4. Digital TV CA Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="net.html">5. Digital TV Network API</a></li>
<li class="toctree-l4"><a class="reference internal" href="legacy_dvb_apis.html">6. Digital TV Deprecated APIs</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">7. Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="headers.html">8. Digital TV uAPI header files</a></li>
<li class="toctree-l4"><a class="reference internal" href="dvbapi.html#revision-and-copyright">Revision and Copyright</a></li>
<li class="toctree-l4"><a class="reference internal" href="dvbapi.html#revision-history">Revision History</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rc/remote_controllers.html">Part III - Remote Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mediactl/media-controller.html">Part IV - Media Controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cec/cec-api.html">Part V - Consumer Electronics Control API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gen-errors.html">Generic Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fdl-appendix.html">GNU Free Documentation License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Linux Filesystems API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/ja_JP/index.html">Japanese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="../../media_uapi.html">Linux Media Infrastructure userspace API</a> &raquo;</li>
        
          <li><a href="dvbapi.html">Part II - Digital TV API</a> &raquo;</li>
        
      <li>7. Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/media/uapi/dvb/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<span id="dvb-examples"></span><h1>7. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>In this section we would like to present some examples for using the Digital
TV API.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is out of date, and the code below won’t even
compile. Please refer to the
<a class="reference external" href="https://linuxtv.org/docs/libdvbv5/index.html">libdvbv5</a> for
updated/recommended examples.</p>
</div>
<div class="section" id="example-tuning">
<span id="tuning"></span><h2>7.1. Example: Tuning<a class="headerlink" href="#example-tuning" title="Permalink to this headline">¶</a></h2>
<p>We will start with a generic tuning subroutine that uses the frontend
and SEC, as well as the demux devices. The example is given for QPSK
tuners, but can easily be adjusted for QAM.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;sys/ioctl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;linux/dvb/dmx.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;linux/dvb/frontend.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;linux/dvb/sec.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/poll.h&gt;</span><span class="cp"></span>

<span class="cp">#define DMX &quot;/dev/dvb/adapter0/demux1&quot;</span>
<span class="cp">#define FRONT &quot;/dev/dvb/adapter0/frontend1&quot;</span>
<span class="cp">#define SEC &quot;/dev/dvb/adapter0/sec1&quot;</span>

<span class="cm">/* routine for checking if we have a signal and other status information*/</span>
<span class="kt">int</span> <span class="nf">FEReadStatus</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fe_status_t</span> <span class="o">*</span><span class="n">stat</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ans</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">ans</span> <span class="o">=</span> <span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">FE_READ_STATUS</span><span class="p">,</span><span class="n">stat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;FE READ STATUS: &quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">stat</span> <span class="o">&amp;</span> <span class="n">FE_HAS_POWER</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;FE HAS POWER</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">stat</span> <span class="o">&amp;</span> <span class="n">FE_HAS_SIGNAL</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;FE HAS SIGNAL</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">stat</span> <span class="o">&amp;</span> <span class="n">FE_SPECTRUM_INV</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;SPEKTRUM INV</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* tune qpsk */</span>
<span class="cm">/* freq:             frequency of transponder                      */</span>
<span class="cm">/* vpid, apid, tpid: PIDs of video, audio and teletext TS packets  */</span>
<span class="cm">/* diseqc:           DiSEqC address of the used LNB                */</span>
<span class="cm">/* pol:              Polarisation                                  */</span>
<span class="cm">/* srate:            Symbol Rate                                   */</span>
<span class="cm">/* fec.              FEC                                           */</span>
<span class="cm">/* lnb_lof1:         local frequency of lower LNB band             */</span>
<span class="cm">/* lnb_lof2:         local frequency of upper LNB band             */</span>
<span class="cm">/* lnb_slof:         switch frequency of LNB                       */</span>

<span class="kt">int</span> <span class="nf">set_qpsk_channel</span><span class="p">(</span><span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vpid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">apid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tpid</span><span class="p">,</span>
        <span class="kt">int</span> <span class="n">diseqc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">srate</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lnb_lof1</span><span class="p">,</span>
        <span class="kt">int</span> <span class="n">lnb_lof2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lnb_slof</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">secCommand</span> <span class="n">scmd</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">secCmdSequence</span> <span class="n">scmds</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">dmx_pes_filter_params</span> <span class="n">pesFilterParams</span><span class="p">;</span>
    <span class="n">FrontendParameters</span> <span class="n">frp</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">pollfd</span> <span class="n">pfd</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">FrontendEvent</span> <span class="n">event</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">demux1</span><span class="p">,</span> <span class="n">demux2</span><span class="p">,</span> <span class="n">demux3</span><span class="p">,</span> <span class="n">front</span><span class="p">;</span>

    <span class="n">frequency</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">freq</span><span class="p">;</span>
    <span class="n">symbolrate</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">srate</span><span class="p">;</span>

    <span class="k">if</span><span class="p">((</span><span class="n">front</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">FRONT</span><span class="p">,</span><span class="n">O_RDWR</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;FRONTEND DEVICE: &quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">((</span><span class="n">sec</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">SEC</span><span class="p">,</span><span class="n">O_RDWR</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;SEC DEVICE: &quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">demux1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">demux1</span><span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="n">DMX</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">))</span>
            <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DEMUX DEVICE: &quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">demux2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">demux2</span><span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="n">DMX</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">))</span>
            <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DEMUX DEVICE: &quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">demux3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">demux3</span><span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="n">DMX</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">))</span>
            <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DEMUX DEVICE: &quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&lt;</span> <span class="n">lnb_slof</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">frp</span><span class="p">.</span><span class="n">Frequency</span> <span class="o">=</span> <span class="p">(</span><span class="n">freq</span> <span class="o">-</span> <span class="n">lnb_lof1</span><span class="p">);</span>
        <span class="n">scmds</span><span class="p">.</span><span class="n">continuousTone</span> <span class="o">=</span> <span class="n">SEC_TONE_OFF</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">frp</span><span class="p">.</span><span class="n">Frequency</span> <span class="o">=</span> <span class="p">(</span><span class="n">freq</span> <span class="o">-</span> <span class="n">lnb_lof2</span><span class="p">);</span>
        <span class="n">scmds</span><span class="p">.</span><span class="n">continuousTone</span> <span class="o">=</span> <span class="n">SEC_TONE_ON</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">frp</span><span class="p">.</span><span class="n">Inversion</span> <span class="o">=</span> <span class="n">INVERSION_AUTO</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pol</span><span class="p">)</span> <span class="n">scmds</span><span class="p">.</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">SEC_VOLTAGE_18</span><span class="p">;</span>
    <span class="k">else</span> <span class="n">scmds</span><span class="p">.</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">SEC_VOLTAGE_13</span><span class="p">;</span>

    <span class="n">scmd</span><span class="p">.</span><span class="n">type</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">scmd</span><span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">diseqc</span><span class="p">.</span><span class="n">addr</span><span class="o">=</span><span class="mh">0x10</span><span class="p">;</span>
    <span class="n">scmd</span><span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">diseqc</span><span class="p">.</span><span class="n">cmd</span><span class="o">=</span><span class="mh">0x38</span><span class="p">;</span>
    <span class="n">scmd</span><span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">diseqc</span><span class="p">.</span><span class="n">numParams</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">scmd</span><span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">diseqc</span><span class="p">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xF0</span> <span class="o">|</span> <span class="p">((</span><span class="n">diseqc</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">scmds</span><span class="p">.</span><span class="n">continuousTone</span> <span class="o">==</span> <span class="n">SEC_TONE_ON</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">scmds</span><span class="p">.</span><span class="n">voltage</span><span class="o">==</span><span class="n">SEC_VOLTAGE_18</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">scmds</span><span class="p">.</span><span class="n">miniCommand</span><span class="o">=</span><span class="n">SEC_MINI_NONE</span><span class="p">;</span>
    <span class="n">scmds</span><span class="p">.</span><span class="n">numCommands</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">scmds</span><span class="p">.</span><span class="n">commands</span><span class="o">=&amp;</span><span class="n">scmd</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">SEC_SEND_SEQUENCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">scmds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;SEC SEND: &quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">SEC_SEND_SEQUENCE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">scmds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;SEC SEND: &quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">frp</span><span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">qpsk</span><span class="p">.</span><span class="n">SymbolRate</span> <span class="o">=</span> <span class="n">srate</span><span class="p">;</span>
    <span class="n">frp</span><span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">qpsk</span><span class="p">.</span><span class="n">FEC_inner</span> <span class="o">=</span> <span class="n">fec</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">FE_SET_FRONTEND</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;QPSK TUNE: &quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">pfd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fd</span> <span class="o">=</span> <span class="n">front</span><span class="p">;</span>
    <span class="n">pfd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">events</span> <span class="o">=</span> <span class="n">POLLIN</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">poll</span><span class="p">(</span><span class="n">pfd</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3000</span><span class="p">)){</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pfd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">revents</span> <span class="o">&amp;</span> <span class="n">POLLIN</span><span class="p">){</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Getting QPSK event</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">ioctl</span><span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">FE_GET_EVENT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">)</span>

                 <span class="o">==</span> <span class="o">-</span><span class="n">EOVERFLOW</span><span class="p">){</span>
                <span class="n">perror</span><span class="p">(</span><span class="s">&quot;qpsk get event&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Received &quot;</span><span class="p">);</span>
            <span class="k">switch</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">type</span><span class="p">){</span>
            <span class="k">case</span> <span class="nl">FE_UNEXPECTED_EV</span><span class="p">:</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;unexpected event</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">case</span> <span class="nl">FE_FAILURE_EV</span><span class="p">:</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;failure event</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

            <span class="k">case</span> <span class="nl">FE_COMPLETION_EV</span><span class="p">:</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;completion event</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pid</span>     <span class="o">=</span> <span class="n">vpid</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">input</span>   <span class="o">=</span> <span class="n">DMX_IN_FRONTEND</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">output</span>  <span class="o">=</span> <span class="n">DMX_OUT_DECODER</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pes_type</span> <span class="o">=</span> <span class="n">DMX_PES_VIDEO</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">flags</span>   <span class="o">=</span> <span class="n">DMX_IMMEDIATE_START</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">demux1</span><span class="p">,</span> <span class="n">DMX_SET_PES_FILTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pesFilterParams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;set_vpid&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pid</span>     <span class="o">=</span> <span class="n">apid</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">input</span>   <span class="o">=</span> <span class="n">DMX_IN_FRONTEND</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">output</span>  <span class="o">=</span> <span class="n">DMX_OUT_DECODER</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pes_type</span> <span class="o">=</span> <span class="n">DMX_PES_AUDIO</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">flags</span>   <span class="o">=</span> <span class="n">DMX_IMMEDIATE_START</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">demux2</span><span class="p">,</span> <span class="n">DMX_SET_PES_FILTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pesFilterParams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;set_apid&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pid</span>     <span class="o">=</span> <span class="n">tpid</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">input</span>   <span class="o">=</span> <span class="n">DMX_IN_FRONTEND</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">output</span>  <span class="o">=</span> <span class="n">DMX_OUT_DECODER</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pes_type</span> <span class="o">=</span> <span class="n">DMX_PES_TELETEXT</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">flags</span>   <span class="o">=</span> <span class="n">DMX_IMMEDIATE_START</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">demux3</span><span class="p">,</span> <span class="n">DMX_SET_PES_FILTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pesFilterParams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;set_tpid&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">has_signal</span><span class="p">(</span><span class="n">fds</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The program assumes that you are using a universal LNB and a standard
DiSEqC switch with up to 4 addresses. Of course, you could build in some
more checking if tuning was successful and maybe try to repeat the
tuning process. Depending on the external hardware, i.e. LNB and DiSEqC
switch, and weather conditions this may be necessary.</p>
</div>
<div class="section" id="example-the-dvr-device">
<span id="the-dvr-device"></span><h2>7.2. Example: The DVR device<a class="headerlink" href="#example-the-dvr-device" title="Permalink to this headline">¶</a></h2>
<p>The following program code shows how to use the DVR device for
recording.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;sys/ioctl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;linux/dvb/dmx.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;linux/dvb/video.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/poll.h&gt;</span><span class="cp"></span>
<span class="cp">#define DVR &quot;/dev/dvb/adapter0/dvr1&quot;</span>
<span class="cp">#define AUDIO &quot;/dev/dvb/adapter0/audio1&quot;</span>
<span class="cp">#define VIDEO &quot;/dev/dvb/adapter0/video1&quot;</span>

<span class="cp">#define BUFFY (188*20)</span>
<span class="cp">#define MAX_LENGTH (1024*1024*5) </span><span class="cm">/* record 5MB */</span><span class="cp"></span>


<span class="cm">/* switch the demuxes to recording, assuming the transponder is tuned */</span>

<span class="cm">/* demux1, demux2: file descriptor of video and audio filters */</span>
<span class="cm">/* vpid, apid:     PIDs of video and audio channels           */</span>

<span class="kt">int</span> <span class="nf">switch_to_record</span><span class="p">(</span><span class="kt">int</span> <span class="n">demux1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">demux2</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">vpid</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">apid</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">dmx_pes_filter_params</span> <span class="n">pesFilterParams</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">demux1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">demux1</span><span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="n">DMX</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">))</span>
            <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DEMUX DEVICE: &quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">demux2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">demux2</span><span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="n">DMX</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">))</span>
            <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DEMUX DEVICE: &quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">vpid</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">DMX_IN_FRONTEND</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">DMX_OUT_TS_TAP</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pes_type</span> <span class="o">=</span> <span class="n">DMX_PES_VIDEO</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">DMX_IMMEDIATE_START</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">demux1</span><span class="p">,</span> <span class="n">DMX_SET_PES_FILTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pesFilterParams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DEMUX DEVICE&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">apid</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">DMX_IN_FRONTEND</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">DMX_OUT_TS_TAP</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">pes_type</span> <span class="o">=</span> <span class="n">DMX_PES_AUDIO</span><span class="p">;</span>
    <span class="n">pesFilterParams</span><span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">DMX_IMMEDIATE_START</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">demux2</span><span class="p">,</span> <span class="n">DMX_SET_PES_FILTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pesFilterParams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DEMUX DEVICE&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* start recording MAX_LENGTH , assuming the transponder is tuned */</span>

<span class="cm">/* demux1, demux2: file descriptor of video and audio filters */</span>
<span class="cm">/* vpid, apid:     PIDs of video and audio channels           */</span>
<span class="kt">int</span> <span class="nf">record_dvr</span><span class="p">(</span><span class="kt">int</span> <span class="n">demux1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">demux2</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">vpid</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">apid</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">written</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFFY</span><span class="p">];</span>
    <span class="kt">uint64_t</span> <span class="n">length</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">pollfd</span> <span class="n">pfd</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">dvr</span><span class="p">,</span> <span class="n">dvr_out</span><span class="p">;</span>

    <span class="cm">/* open dvr device */</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">dvr</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">DVR</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="o">|</span><span class="n">O_NONBLOCK</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">&quot;DVR DEVICE&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* switch video and audio demuxes to dvr */</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Switching dvr on</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">switch_to_record</span><span class="p">(</span><span class="n">demux1</span><span class="p">,</span> <span class="n">demux2</span><span class="p">,</span> <span class="n">vpid</span><span class="p">,</span> <span class="n">apid</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;finished: &quot;</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Recording %2.0f MB of test file in TS format</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span>
       <span class="n">MAX_LENGTH</span><span class="o">/</span><span class="p">(</span><span class="mf">1024.0</span><span class="o">*</span><span class="mf">1024.0</span><span class="p">));</span>
    <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/* open output file */</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">dvr_out</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">DVR_FILE</span><span class="p">,</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_CREAT</span>
                 <span class="o">|</span><span class="n">O_TRUNC</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="o">|</span><span class="n">S_IWUSR</span>
                 <span class="o">|</span><span class="n">S_IRGRP</span><span class="o">|</span><span class="n">S_IWGRP</span><span class="o">|</span><span class="n">S_IROTH</span><span class="o">|</span>
                 <span class="n">S_IWOTH</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;Can&#39;t open file for dvr test&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">pfd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fd</span> <span class="o">=</span> <span class="n">dvr</span><span class="p">;</span>
    <span class="n">pfd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">events</span> <span class="o">=</span> <span class="n">POLLIN</span><span class="p">;</span>

    <span class="cm">/* poll for dvr data and write to file */</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">MAX_LENGTH</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">poll</span><span class="p">(</span><span class="n">pfd</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pfd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">revents</span> <span class="o">&amp;</span> <span class="n">POLLIN</span><span class="p">){</span>
                <span class="n">len</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">dvr</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUFFY</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">perror</span><span class="p">(</span><span class="s">&quot;recording&quot;</span><span class="p">);</span>
                    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="n">written</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">written</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">)</span>
                        <span class="n">written</span> <span class="o">+=</span>
                            <span class="n">write</span> <span class="p">(</span><span class="n">dvr_out</span><span class="p">,</span>
                               <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
                    <span class="n">length</span> <span class="o">+=</span> <span class="n">len</span><span class="p">;</span>
                    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;written %2.0f MB</span><span class="se">\\</span><span class="s">r&quot;</span><span class="p">,</span>
                       <span class="n">length</span><span class="o">/</span><span class="mf">1024.</span><span class="o">/</span><span class="mf">1024.</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="headers.html" class="btn btn-neutral float-right" title="8. Digital TV uAPI header files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="audio-set-karaoke.html" class="btn btn-neutral" title="6.3.2.23. AUDIO_SET_KARAOKE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>