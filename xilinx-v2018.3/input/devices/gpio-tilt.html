

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10. Driver for tilt-switches connected via GPIOs &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11. Iforce Protocol" href="iforce-protocol.html" />
    <link rel="prev" title="9. Elantech Touchpad Driver" href="elantech.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.14.0-xilinx-v2018.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux Input Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../input_uapi.html">Linux Input Subsystem userspace API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input_kapi.html">Linux Input Subsystem kernel API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Driver-specific documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="alps.html">1. ALPS Touchpad Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="amijoy.html">2. Amiga joystick extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="appletouch.html">3. Apple Touchpad Driver (appletouch)</a></li>
<li class="toctree-l3"><a class="reference internal" href="atarikbd.html">4. Intelligent Keyboard (ikbd) Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="bcm5974.html">5. BCM5974 Driver (bcm5974)</a></li>
<li class="toctree-l3"><a class="reference internal" href="cma3000_d0x.html">6. CMA3000-D0x Accelerometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="cs461x.html">7. Crystal SoundFusion CS4610/CS4612/CS461 joystick</a></li>
<li class="toctree-l3"><a class="reference internal" href="edt-ft5x06.html">8. EDT ft5x06 based Polytouch devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="elantech.html">9. Elantech Touchpad Driver</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">10. Driver for tilt-switches connected via GPIOs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-structures">10.1. Data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">10.2. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="iforce-protocol.html">11. Iforce Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="joystick-parport.html">12. Parallel Port Joystick Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntrig.html">13. N-Trig touchscreen Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="rotary-encoder.html">14. rotary-encoder - a generic driver for GPIO connected devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="sentelic.html">15. Sentelic Touchpad</a></li>
<li class="toctree-l3"><a class="reference internal" href="walkera0701.html">16. Walkera WK-0701 transmitter</a></li>
<li class="toctree-l3"><a class="reference internal" href="xpad.html">17. xpad - Linux USB driver for Xbox compatible controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="yealink.html">18. Driver documentation for yealink usb-p1k phones</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Linux Filesystems API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/ja_JP/index.html">Japanese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">The Linux Input Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Driver-specific documentation</a> &raquo;</li>
        
      <li>10. Driver for tilt-switches connected via GPIOs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/input/devices/gpio-tilt.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="driver-for-tilt-switches-connected-via-gpios">
<h1>10. Driver for tilt-switches connected via GPIOs<a class="headerlink" href="#driver-for-tilt-switches-connected-via-gpios" title="Permalink to this headline">¶</a></h1>
<p>Generic driver to read data from tilt switches connected via gpios.
Orientation can be provided by one or more than one tilt switches,
i.e. each tilt switch providing one axis, and the number of axes
is also not limited.</p>
<div class="section" id="data-structures">
<h2>10.1. Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h2>
<p>The array of struct gpio in the gpios field is used to list the gpios
that represent the current tilt state.</p>
<p>The array of struct gpio_tilt_axis describes the axes that are reported
to the input system. The values set therein are used for the
input_set_abs_params calls needed to init the axes.</p>
<p>The array of struct gpio_tilt_state maps gpio states to the corresponding
values to report. The gpio state is represented as a bitfield where the
bit-index corresponds to the index of the gpio in the struct gpio array.
In the same manner the values stored in the axes array correspond to
the elements of the gpio_tilt_axis-array.</p>
</div>
<div class="section" id="example">
<h2>10.2. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Example configuration for a single TS1003 tilt switch that rotates around
one axis in 4 steps and emits the current tilt via two GPIOs:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>static int sg060_tilt_enable(struct device *dev) {
        /* code to enable the sensors */
};

static void sg060_tilt_disable(struct device *dev) {
        /* code to disable the sensors */
};

static struct gpio sg060_tilt_gpios[] = {
        { SG060_TILT_GPIO_SENSOR1, GPIOF_IN, &quot;tilt_sensor1&quot; },
        { SG060_TILT_GPIO_SENSOR2, GPIOF_IN, &quot;tilt_sensor2&quot; },
};

static struct gpio_tilt_state sg060_tilt_states[] = {
        {
                .gpios = (0 &lt;&lt; 1) | (0 &lt;&lt; 0),
                .axes = (int[]) {
                        0,
                },
        }, {
                .gpios = (0 &lt;&lt; 1) | (1 &lt;&lt; 0),
                .axes = (int[]) {
                        1, /* 90 degrees */
                },
        }, {
                .gpios = (1 &lt;&lt; 1) | (1 &lt;&lt; 0),
                .axes = (int[]) {
                        2, /* 180 degrees */
                },
        }, {
                .gpios = (1 &lt;&lt; 1) | (0 &lt;&lt; 0),
                .axes = (int[]) {
                        3, /* 270 degrees */
                },
        },
};

static struct gpio_tilt_axis sg060_tilt_axes[] = {
        {
                .axis = ABS_RY,
                .min = 0,
                .max = 3,
                .fuzz = 0,
                .flat = 0,
        },
};

static struct gpio_tilt_platform_data sg060_tilt_pdata= {
        .gpios = sg060_tilt_gpios,
        .nr_gpios = ARRAY_SIZE(sg060_tilt_gpios),

        .axes = sg060_tilt_axes,
        .nr_axes = ARRAY_SIZE(sg060_tilt_axes),

        .states = sg060_tilt_states,
        .nr_states = ARRAY_SIZE(sg060_tilt_states),

        .debounce_interval = 100,

        .poll_interval = 1000,
        .enable = sg060_tilt_enable,
        .disable = sg060_tilt_disable,
};

static struct platform_device sg060_device_tilt = {
        .name = &quot;gpio-tilt-polled&quot;,
        .id = -1,
        .dev = {
                .platform_data = &amp;sg060_tilt_pdata,
        },
};
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="iforce-protocol.html" class="btn btn-neutral float-right" title="11. Iforce Protocol" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="elantech.html" class="btn btn-neutral" title="9. Elantech Touchpad Driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>