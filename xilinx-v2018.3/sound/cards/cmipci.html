

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Brief Notes on C-Media 8338/8738/8768/8770 Driver &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sound Blaster Live mixer / default DSP code" href="sb-live-mixer.html" />
    <link rel="prev" title="Analog Joystick Support on ALSA Drivers" href="joystick.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                4.14.0-xilinx-v2018.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Sound Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../kernel-api/index.html">ALSA Kernel API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../designs/index.html">Designs and Implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../soc/index.html">ALSA SoC Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alsa-configuration.html">Advanced Linux Sound Architecture - Driver Configuration guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hd-audio/index.html">HD-Audio</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Card-Specific Information</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="joystick.html">Analog Joystick Support on ALSA Drivers</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Brief Notes on C-Media 8338/8738/8768/8770 Driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#front-rear-multi-channel-playback">Front/Rear Multi-channel Playback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-channel-playback">4/6 Multi-Channel Playback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#digital-i-o">Digital I/O</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-ac3-raw-digital-output">The AC3 (RAW DIGITAL) OUTPUT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analog-mixer-interface">ANALOG MIXER INTERFACE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#midi-controller">MIDI CONTROLLER</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fm-opl-3-synth">FM OPL/3 Synth</a></li>
<li class="toctree-l4"><a class="reference internal" href="#joystick-and-modem">Joystick and Modem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging-information">Debugging Information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sb-live-mixer.html">Sound Blaster Live mixer / default DSP code</a></li>
<li class="toctree-l3"><a class="reference internal" href="audigy-mixer.html">Sound Blaster Audigy mixer / default DSP code</a></li>
<li class="toctree-l3"><a class="reference internal" href="emu10k1-jack.html">Low latency, multichannel audio with JACK and the emu10k1/emu10k2</a></li>
<li class="toctree-l3"><a class="reference internal" href="via82xx-mixer.html">VIA82xx mixer</a></li>
<li class="toctree-l3"><a class="reference internal" href="audiophile-usb.html">Guide to using M-Audio Audiophile USB with ALSA and Jack</a></li>
<li class="toctree-l3"><a class="reference internal" href="mixart.html">Alsa driver for Digigram miXart8 and miXart8AES/EBU soundcards</a></li>
<li class="toctree-l3"><a class="reference internal" href="bt87x.html">ALSA BT87x Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="maya44.html">Notes on Maya44 USB Audio Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="hdspm.html">Software Interface ALSA-DSP MADI Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="serial-u16550.html">Serial UART 16450/16550 MIDI driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="img-spdif-in.html">Imagination Technologies SPDIF Input Controllers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Linux Filesystems API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/ko_KR/index.html">Korean translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/zh_CN/index.html">Chinese translations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/ja_JP/index.html">Japanese translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Sound Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Card-Specific Information</a> &raquo;</li>
        
      <li>Brief Notes on C-Media 8338/8738/8768/8770 Driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/sound/cards/cmipci.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="brief-notes-on-c-media-8338-8738-8768-8770-driver">
<h1>Brief Notes on C-Media 8338/8738/8768/8770 Driver<a class="headerlink" href="#brief-notes-on-c-media-8338-8738-8768-8770-driver" title="Permalink to this headline">¶</a></h1>
<p>Takashi Iwai &lt;<a class="reference external" href="mailto:tiwai&#37;&#52;&#48;suse&#46;de">tiwai<span>&#64;</span>suse<span>&#46;</span>de</a>&gt;</p>
<div class="section" id="front-rear-multi-channel-playback">
<h2>Front/Rear Multi-channel Playback<a class="headerlink" href="#front-rear-multi-channel-playback" title="Permalink to this headline">¶</a></h2>
<p>CM8x38 chip can use ADC as the second DAC so that two different stereo
channels can be used for front/rear playbacks.  Since there are two
DACs, both streams are handled independently unlike the 4/6ch multi-
channel playbacks in the section below.</p>
<p>As default, ALSA driver assigns the first PCM device (i.e. hw:0,0 for
card#0) for front and 4/6ch playbacks, while the second PCM device
(hw:0,1) is assigned to the second DAC for rear playback.</p>
<p>There are slight differences between the two DACs:</p>
<ul class="simple">
<li>The first DAC supports U8 and S16LE formats, while the second DAC
supports only S16LE.</li>
<li>The second DAC supports only two channel stereo.</li>
</ul>
<p>Please note that the CM8x38 DAC doesn’t support continuous playback
rate but only fixed rates: 5512, 8000, 11025, 16000, 22050, 32000,
44100 and 48000 Hz.</p>
<p>The rear output can be heard only when “Four Channel Mode” switch is
disabled.  Otherwise no signal will be routed to the rear speakers.
As default it’s turned on.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When “Four Channel Mode” switch is off, the output from rear speakers
will be FULL VOLUME regardless of Master and PCM volumes <a class="footnote-reference" href="#id2" id="id1">[1]</a>.
This might damage your audio equipment.  Please disconnect speakers
before your turn off this switch.</p>
</div>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Well.. I once got the output with correct volume (i.e. same with the
front one) and was so excited.  It was even with “Four Channel” bit
on and “double DAC” mode.  Actually I could hear separate 4 channels
from front and rear speakers!  But.. after reboot, all was gone.
It’s a very pity that I didn’t save the register dump at that
time..  Maybe there is an unknown register to achieve this…</td></tr>
</tbody>
</table>
<p>If your card has an extra output jack for the rear output, the rear
playback should be routed there as default.  If not, there is a
control switch in the driver “Line-In As Rear”, which you can change
via alsamixer or somewhat else.  When this switch is on, line-in jack
is used as rear output.</p>
<p>There are two more controls regarding to the rear output.
The “Exchange DAC” switch is used to exchange front and rear playback
routes, i.e. the 2nd DAC is output from front output.</p>
</div>
<div class="section" id="multi-channel-playback">
<h2>4/6 Multi-Channel Playback<a class="headerlink" href="#multi-channel-playback" title="Permalink to this headline">¶</a></h2>
<p>The recent CM8738 chips support for the 4/6 multi-channel playback
function.  This is useful especially for AC3 decoding.</p>
<p>When the multi-channel is supported, the driver name has a suffix
“-MC” such like “CMI8738-MC6”.  You can check this name from
/proc/asound/cards.</p>
<p>When the 4/6-ch output is enabled, the second DAC accepts up to 6 (or
4) channels.  While the dual DAC supports two different rates or
formats, the 4/6-ch playback supports only the same condition for all
channels.  Since the multi-channel playback mode uses both DACs, you
cannot operate with full-duplex.</p>
<p>The 4.0 and 5.1 modes are defined as the pcm “surround40” and “surround51”
in alsa-lib.  For example, you can play a WAV file with 6 channels like</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>% aplay -Dsurround51 sixchannels.wav
</pre></div>
</div>
<p>For programming the 4/6 channel playback, you need to specify the PCM
channels as you like and set the format S16LE.  For example, for playback
with 4 channels,</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>snd_pcm_hw_params_set_access(pcm, hw, SND_PCM_ACCESS_RW_INTERLEAVED);
    // or mmap if you like
snd_pcm_hw_params_set_format(pcm, hw, SND_PCM_FORMAT_S16_LE);
snd_pcm_hw_params_set_channels(pcm, hw, 4);
</pre></div>
</div>
<p>and use the interleaved 4 channel data.</p>
<p>There are some control switches affecting to the speaker connections:</p>
<dl class="docutils">
<dt>Line-In Mode</dt>
<dd>an enum control to change the behavior of line-in
jack.  Either “Line-In”, “Rear Output” or “Bass Output” can
be selected.  The last item is available only with model 039
or newer.
When “Rear Output” is chosen, the surround channels 3 and 4
are output to line-in jack.</dd>
<dt>Mic-In Mode</dt>
<dd>an enum control to change the behavior of mic-in
jack.  Either “Mic-In” or “Center/LFE Output” can be
selected.
When “Center/LFE Output” is chosen, the center and bass
channels (channels 5 and 6) are output to mic-in jack.</dd>
</dl>
</div>
<div class="section" id="digital-i-o">
<h2>Digital I/O<a class="headerlink" href="#digital-i-o" title="Permalink to this headline">¶</a></h2>
<p>The CM8x38 provides the excellent SPDIF capability with very cheap
price (yes, that’s the reason I bought the card :)</p>
<p>The SPDIF playback and capture are done via the third PCM device
(hw:0,2).  Usually this is assigned to the PCM device “spdif”.
The available rates are 44100 and 48000 Hz.
For playback with aplay, you can run like below:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>% aplay -Dhw:0,2 foo.wav
</pre></div>
</div>
<p>or</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>% aplay -Dspdif foo.wav
</pre></div>
</div>
<p>24bit format is also supported experimentally.</p>
<p>The playback and capture over SPDIF use normal DAC and ADC,
respectively, so you cannot playback both analog and digital streams
simultaneously.</p>
<p>To enable SPDIF output, you need to turn on “IEC958 Output Switch”
control via mixer or alsactl (“IEC958” is the official name of
so-called S/PDIF).  Then you’ll see the red light on from the card so
you know that’s working obviously :)
The SPDIF input is always enabled, so you can hear SPDIF input data
from line-out with “IEC958 In Monitor” switch at any time (see
below).</p>
<p>You can play via SPDIF even with the first device (hw:0,0),
but SPDIF is enabled only when the proper format (S16LE), sample rate
(441100 or 48000) and channels (2) are used.  Otherwise it’s turned
off.  (Also don’t forget to turn on “IEC958 Output Switch”, too.)</p>
<p>Additionally there are relevant control switches:</p>
<dl class="docutils">
<dt>IEC958 Mix Analog</dt>
<dd><p class="first">Mix analog PCM playback and FM-OPL/3 streams and
output through SPDIF.  This switch appears only on old chip
models (CM8738 033 and 037).</p>
<p class="last">Note: without this control you can output PCM to SPDIF.
This is “mixing” of streams, so e.g. it’s not for AC3 output
(see the next section).</p>
</dd>
<dt>IEC958 In Select</dt>
<dd>Select SPDIF input, the internal CD-in (false)
and the external input (true).</dd>
<dt>IEC958 Loop</dt>
<dd>SPDIF input data is loop back into SPDIF
output (aka bypass)</dd>
<dt>IEC958 Copyright</dt>
<dd>Set the copyright bit.</dd>
<dt>IEC958 5V</dt>
<dd>Select 0.5V (coax) or 5V (optical) interface.
On some cards this doesn’t work and you need to change the
configuration with hardware dip-switch.</dd>
<dt>IEC958 In Monitor</dt>
<dd>SPDIF input is routed to DAC.</dd>
<dt>IEC958 In Phase Inverse</dt>
<dd>Set SPDIF input format as inverse.
[FIXME: this doesn’t work on all chips..]</dd>
<dt>IEC958 In Valid</dt>
<dd>Set input validity flag detection.</dd>
</dl>
<p>Note: When “PCM Playback Switch” is on, you’ll hear the digital output
stream through analog line-out.</p>
</div>
<div class="section" id="the-ac3-raw-digital-output">
<h2>The AC3 (RAW DIGITAL) OUTPUT<a class="headerlink" href="#the-ac3-raw-digital-output" title="Permalink to this headline">¶</a></h2>
<p>The driver supports raw digital (typically AC3) i/o over SPDIF.  This
can be toggled via IEC958 playback control, but usually you need to
access it via alsa-lib.  See alsa-lib documents for more details.</p>
<p>On the raw digital mode, the “PCM Playback Switch” is automatically
turned off so that non-audio data is heard from the analog line-out.
Similarly the following switches are off: “IEC958 Mix Analog” and
“IEC958 Loop”.  The switches are resumed after closing the SPDIF PCM
device automatically to the previous state.</p>
<p>On the model 033, AC3 is implemented by the software conversion in
the alsa-lib.  If you need to bypass the software conversion of IEC958
subframes, pass the “soft_ac3=0” module option.  This doesn’t matter
on the newer models.</p>
</div>
<div class="section" id="analog-mixer-interface">
<h2>ANALOG MIXER INTERFACE<a class="headerlink" href="#analog-mixer-interface" title="Permalink to this headline">¶</a></h2>
<p>The mixer interface on CM8x38 is similar to SB16.
There are Master, PCM, Synth, CD, Line, Mic and PC Speaker playback
volumes.  Synth, CD, Line and Mic have playback and capture switches,
too, as well as SB16.</p>
<p>In addition to the standard SB mixer, CM8x38 provides more functions.
- PCM playback switch
- PCM capture switch (to capture the data sent to DAC)
- Mic Boost switch
- Mic capture volume
- Aux playback volume/switch and capture switch
- 3D control switch</p>
</div>
<div class="section" id="midi-controller">
<h2>MIDI CONTROLLER<a class="headerlink" href="#midi-controller" title="Permalink to this headline">¶</a></h2>
<p>With CMI8338 chips, the MPU401-UART interface is disabled as default.
You need to set the module option “mpu_port” to a valid I/O port address
to enable MIDI support.  Valid I/O ports are 0x300, 0x310, 0x320 and
0x330.  Choose a value that doesn’t conflict with other cards.</p>
<p>With CMI8738 and newer chips, the MIDI interface is enabled by default
and the driver automatically chooses a port address.</p>
<p>There is <em>no</em> hardware wavetable function on this chip (except for
OPL3 synth below).
What’s said as MIDI synth on Windows is a software synthesizer
emulation.  On Linux use TiMidity or other softsynth program for
playing MIDI music.</p>
</div>
<div class="section" id="fm-opl-3-synth">
<h2>FM OPL/3 Synth<a class="headerlink" href="#fm-opl-3-synth" title="Permalink to this headline">¶</a></h2>
<p>The FM OPL/3 is also enabled as default only for the first card.
Set “fm_port” module option for more cards.</p>
<p>The output quality of FM OPL/3 is, however, very weird.
I don’t know why..</p>
<p>CMI8768 and newer chips do not have the FM synth.</p>
</div>
<div class="section" id="joystick-and-modem">
<h2>Joystick and Modem<a class="headerlink" href="#joystick-and-modem" title="Permalink to this headline">¶</a></h2>
<p>The legacy joystick is supported.  To enable the joystick support, pass
joystick_port=1 module option.  The value 1 means the auto-detection.
If the auto-detection fails, try to pass the exact I/O address.</p>
<p>The modem is enabled dynamically via a card control switch “Modem”.</p>
</div>
<div class="section" id="debugging-information">
<h2>Debugging Information<a class="headerlink" href="#debugging-information" title="Permalink to this headline">¶</a></h2>
<p>The registers are shown in /proc/asound/cardX/cmipci.  If you have any
problem (especially unexpected behavior of mixer), please attach the
output of this proc file together with the bug report.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sb-live-mixer.html" class="btn btn-neutral float-right" title="Sound Blaster Live mixer / default DSP code" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="joystick.html" class="btn btn-neutral" title="Analog Joystick Support on ALSA Drivers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>